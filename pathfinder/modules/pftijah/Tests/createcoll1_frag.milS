module(pathfinder);
module(unix);

# should run if you set TSTTRGDIR to pwd
var path:=getenv("TSTSRCDIR");

var coll_opt := new(str,str);
coll_opt.insert("stemmer","snowball-english");
coll_opt.insert("fragmentSize","10");

# index collection at once
var docs := new(str,str);
docs.insert(path+"/xml-docs/dilbert.xml","dilbert.xml");
docs.insert(path+"/xml-docs/dilbert2.xml","dilbert2.xml");
docs.insert(path+"/xml-docs/special.xml","special.xml");
tj_init_collection_base("coll1_frag", coll_opt);
tj_add2collection_frag("coll1_frag",docs,true);

# index collection incrementally
tj_init_collection_base("coll2_frag", coll_opt);
tj_add2collection_frag("coll2_frag",path+"/xml-docs/dilbert.xml","dilbert.xml",true);
tj_add2collection_frag("coll2_frag",path+"/xml-docs/dilbert2.xml","dilbert2.xml",true);
tj_add2collection_frag("coll2_frag",path+"/xml-docs/special.xml","special.xml",true);

coll_opt.replace("fragmentSize","60");

# index collection at once
tj_init_collection_base("coll1_frag100", coll_opt);
tj_add2collection_frag("coll1_frag100",docs,true);

# index collection incrementally
tj_init_collection_base("coll2_frag100", coll_opt);
tj_add2collection_frag("coll2_frag100",path+"/xml-docs/dilbert.xml","dilbert.xml",true);
tj_add2collection_frag("coll2_frag100",path+"/xml-docs/dilbert2.xml","dilbert2.xml",true);
tj_add2collection_frag("coll2_frag100",path+"/xml-docs/special.xml","special.xml",true);

# compare indexed collections

var coll1 := bat("tj_coll1_frag_termfreq");
var coll2 := bat("tj_coll2_frag_termfreq");
var coll3 := bat("tj_coll1_frag100_termfreq");
var coll4 := bat("tj_coll2_frag100_termfreq");

diff(coll1,coll2).print();
diff(coll2,coll3).print();
diff(coll3,coll4).print();
