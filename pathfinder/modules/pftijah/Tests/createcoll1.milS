module(pathfinder);
module(unix);

# should run if you set TSTTRGDIR to pwd
var path:=getenv("TSTSRCDIR");

# index collection at once
tj_init_collection("testcoll1", new(str,str).insert("stemmer","snowball-english"));
var docs := new(str,str);
docs.insert(path+"/xml-docs/dilbert.xml","dilbert.xml");
docs.insert(path+"/xml-docs/dilbert2.xml","dilbert2.xml");
docs.insert(path+"/xml-docs/special.xml","special.xml");
tj_add2collection("testcoll1",docs,true);

# index collection incrementally
tj_init_collection("testcoll2", new(str,str).insert("stemmer","snowball-english"));
tj_add2collection("testcoll2",path+"/xml-docs/dilbert.xml","dilbert.xml",true);
tj_add2collection("testcoll2",path+"/xml-docs/dilbert2.xml","dilbert2.xml",true);
tj_add2collection("testcoll2",path+"/xml-docs/special.xml","special.xml",true);

# compare indexed collections
var tids1 := bat(_tj_TermBat("testcoll1")).reverse().tsort();
var tids2 := bat(_tj_TermBat("testcoll2")).reverse().tsort();
var coll1 := indexfetchjoin(tids1, bat("tj_testcoll1_TermIndex"), bat("tj_testcoll1_Terms"));
var coll2 := indexfetchjoin(tids2, bat("tj_testcoll2_TermIndex"), bat("tj_testcoll2_Terms"));
diff(coll1,coll2).print();

tids1 := bat(_tj_TagBat("testcoll1")).reverse().tsort();
tids2 := bat(_tj_TagBat("testcoll2")).reverse().tsort();
coll1 := indexfetchjoin(tids1, bat("tj_testcoll1_TagIndex"), bat("tj_testcoll1_Tags"));
coll2 := indexfetchjoin(tids2, bat("tj_testcoll2_TagIndex"), bat("tj_testcoll2_Tags"));
diff(coll1,coll2).print();
