
# Copyright Notice:
# -----------------
#
# The contents of this file are subject to the Pathfinder Public License
# Version 1.1 (the "License"); you may not use this file except in
# compliance with the License.  You may obtain a copy of the License at
# http://monetdb.cwi.nl/Legal/PathfinderLicense-1.1.html
#
# Software distributed under the License is distributed on an "AS IS"
# basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.  See
# the License for the specific language governing rights and limitations
# under the License.
#
# The Original Code is the Pathfinder system.
#
# The Original Code has initially been developed by the Database &
# Information Systems Group at the University of Konstanz, Germany and
# is now maintained by the Database Systems Group at the Technische
# Universitaet Muenchen, Germany.  Portions created by the University of
# Konstanz and the Technische Universitaet Muenchen are Copyright (C)
# 2000-2005 University of Konstanz and (C) 2005-2007 Technische
# Universitaet Muenchen, respectively.  All Rights Reserved.
#

SUBDIRS = xrpc

EXTRA_DIST_DIR = Tests

INCLUDES = $(MONETDB_INCS) $(MONETDB4_INCS) $(LIBXML2_CFLAGS) ../compiler/include
PF_LIBS = $(LIBXML2_LDADD) $(LIBXML2_LIBS) $(DL_LIBS)

# these defines are needed to get shttpd to compile in the right way
CFLAGS = -DEMBEDDED -DMT -DNO_CGI -DNO_AUTH -DIO_MAX=10240

lib_serialize_null = {
	NOINST
	SOURCES = serialize_null.mx
}

lib__pf_support = {
        DIR = libdir/MonetDB4
        SOURCES = \
                pf_support.mx \
                staircasejoin.mx \
                ll_staircasejoin.mx \
                ll_upwards.mx \
                prec_foll.mx \
                levelsteps.mx \
                shredder.mx \
                serialize.mx \
                serialize_dflt.mx \
                serialize_sax.mx 

        LIBS = \
                libserialize_null $(PF_LIBS) \
                $(MONETDB_LIBS) -lbat -lstream $(MONETDB4_LIBS) -lmonet $(PTHREAD_LIBS) \
                $(MONETDB4_MODS) -l_lock -l_monettime -l_streams -l_builtin -l_ascii_io -l_algebra -l_constant
}

lib__pf_standoff = {
        DIR = libdir/MonetDB4
        SOURCES = \
                pf_standoff.mx 

        LIBS = \
                $(PF_LIBS) \
                $(MONETDB_LIBS) -lbat -lstream $(MONETDB4_LIBS) -lmonet \
                $(MONETDB4_MODS) -l_streams -l_builtin -l_ascii_io -l_algebra -l_sys -l_constant 
}

lib__pathfinder = {
        DIR = libdir/MonetDB4
        SOURCES = \
                pathfinder.mx

        LIBS = \
                ../compiler/libcompiler1 \
                ../compiler/schema/libschema \
                ../compiler/debug/libdebug \
                ../compiler/parser/libparser \
                ../compiler/semantics/libsemantics \
                ../compiler/core/libcore \
                ../compiler/algebra/libalgebra \
                ../compiler/algebra/map/libmap \
                ../compiler/algebra/prop/libprop \
                ../compiler/algebra/opt/libopt \
                ../compiler/mil/libmil \
                ../compiler/mem/libmem_embedded \
                ../compiler/libcompiler2 \
                ../compiler/sql/libsql \
                $(PF_LIBS) \
                $(MONETDB_LIBS) -lbat -lstream $(MONETDB4_LIBS) -lmonet $(PTHREAD_LIBS) \
                $(MONETDB4_MODS) -l_streams -l_builtin -l_ascii_io -l_algebra -l_sys -l_constant -l_mapi 
}

lib__xrpc_client = {
        DIR = libdir/MonetDB4
        SOURCES = xrpc_client.mx
        LIBS = \
			   $(PF_LIBS) $(SOCKET_LIBS) ./lib_pf_support ./lib_pathfinder \
			   $(MONETDB_LIBS) -lbat -lstream $(MONETDB4_LIBS) -lmonet -lpthread \
			   $(MONETDB4_MODS) -l_streams -l_builtin -l_ascii_io
}

lib__xrpc_server = {
        DIR = libdir/MonetDB4
        SOURCES = \
				  shttpd.c shttpd.h \
				  xrpc_server.mx
        LIBS = \
			   $(PF_LIBS) $(SOCKET_LIBS) ./lib_pf_support ./lib_pathfinder \
			   $(MONETDB_LIBS) -lbat -lstream $(MONETDB4_LIBS) -lmonet -lpthread \
			   $(MONETDB4_MODS) -l_streams -l_builtin -l_ascii_io
}

scripts_mil = {
        DIR = libdir/MonetDB4
        SOURCES = pathfinder.mx pf_support.mx pf_standoff.mx xrpc_client.mx xrpc_server.mx
}
