(:
  1. show current documents in DB
  2. backup current DB
  3. delete all documents in DB
  4. restore backup

  Test the following admin functions:
  - adm:add-doc()
  - adm:documents()
  - adm:backup()
  - adm:backup-col()
  - adm:del-col()
  - adm:del-doc()
  - adm:restore()
  - adm:restore-col()
:)
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
(adm:add-doc("http://$HOST:$XRPCPORT/admin/xmark1.xml", "xmark1.xml", "xmark", 10),
 adm:add-doc("http://$HOST:$XRPCPORT/admin/xmark2.xml", "xmark2.xml", "xmark", 10)
)
<>
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
(
text {"&#10;  "},
<db-before-backup>{
    let $docs := adm:documents() return
        for $d in $docs return
            ( text { "&#10;    " },
              element document {
                element updatable {string($d/@updatable)},
                element collection {string($d/@collection)},
                $d/text() } ),
    text { "&#10;  "}
}</db-before-backup>,
text {"&#10;"}
)
<>
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
adm:backup("test")
<>
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
adm:del-col("xmark")
<>
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
<db-after-del>{ adm:collections() }</db-after-del>
<>
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
adm:restore("test", 10)
<>
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
(
text {"&#10;  "},
<db-after-restore>{
    let $docs := adm:documents() return
        for $d in $docs return
            ( text { "&#10;    " },
              element document {
                element updatable {string($d/@updatable)},
                element collection {string($d/@collection)},
                element uri {string($d/@uri)},
                $d/text() } ),
    text { "&#10;  "}
}</db-after-restore>,
text {"&#10;"}
)
<>
(: clean DB at the end of the test :)
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
adm:del-col("xmark")
<>
import module namespace adm = "http://monetdb.cwi.nl/XQuery/admin/"
                        at "http://$HOST:$XRPCPORT/admin/admin.xq";
<db-after-cleanup>
{ adm:documents() }
</db-after-cleanup>

