@echo off

if not "%1"=="" goto skip
call %0 -r
goto end

:skip

setlocal

set monetdb4_prefix=@XMONETDB4_PREFIX@
set builddir=@XPATHFINDER_BUILD@
set srcdir=@XPATHFINDER_SOURCE@

set MOD_PATH=%builddir%\runtime\.libs;%builddir%\runtime;%builddir%\modules\pftijah\.libs;%builddir%\modules\pftijah;%monetdb4_prefix%\lib\MonetDB4;%monetdb4_prefix%\lib\MonetDB4\lib;%monetdb4_prefix%\lib\MonetDB4\bin

set PATH=%builddir%\compiler;%PATH%
set PATH=%MOD_PATH%;%PATH%

REM execute Mtest.py in the source directory
pushd %srcdir%

call Mtest.py "--config=%monetdb4_prefix%\etc\MonetDB.conf" "--monet_mod_path=%MOD_PATH%" "--dbfarm=%builddir%\dbfarm" "--sql_logdir=%builddir%\sql_logs" "--xquery_logdir=%builddir%\xquery_logs" "--TSTSRCBASE=%srcdir%" "--TSTBLDBASE=%builddir%" "--TSTTRGBASE=%builddir%" %*

popd
endlocal

:end
