@echo off

if not "%1"=="" goto skip
call %0 -rq
goto :EOF

:skip

setlocal

set pkg=pathfinder
set buildbase=@XBUILD@
set srcdir=@XSOURCE@

rem binaries (.exe)
set PATH=%buildbase%\clients\examples\C;%PATH%
set PATH=%buildbase%\clients\mapiclient;%PATH%
set PATH=%buildbase%\clients\odbc\samples;%PATH%
set PATH=%buildbase%\testing;%PATH%
set PATH=%buildbase%\monetdb4\tools;%PATH%

rem libraries (.dll)
set PATH=%buildbase%\clients\mapilib;%PATH%
set PATH=%buildbase%\clients\perl\Cimpl;%PATH%
set PATH=%buildbase%\common\stream;%PATH%
set PATH=%buildbase%\gdk;%PATH%
set PATH=%buildbase%\monetdb4\monet;%PATH%

rem modules (lib_*.dll and *.mal)
set MOD_PATH=%buildbase%\geom\monetdb4
set MOD_PATH=%buildbase%\monetdb4\modules\contrib;%MOD_PATH%
set MOD_PATH=%buildbase%\monetdb4\modules\mapi;%MOD_PATH%
set MOD_PATH=%buildbase%\monetdb4\modules\plain;%MOD_PATH%
set MOD_PATH=%buildbase%\monetdb4\scripts\tools;%MOD_PATH%
set MOD_PATH=%buildbase%\pathfinder\modules\pftijah;%MOD_PATH%
set MOD_PATH=%buildbase%\pathfinder\modules\probxml;%MOD_PATH%
set MOD_PATH=%buildbase%\pathfinder\runtime;%MOD_PATH%

set PATH=%MOD_PATH%;%PATH%

set cfg=%buildbase%\monetdb4\conf\MonetDB.conf

set PYTHONPATH=%buildbase%\clients\python\build\lib;%buildbase%\testing;%srcdir%\testing;%PYTHONPATH%

set CLASSPATH=%buildbase%\java;%buildbase%\java\tests;%CLASSPATH%

set perlib=%buildbase%\clients\perl;%srcdir%\clients\perl
set PERLLIB=%perlib%;%PERLLIB%
set PERL5LIB=%perlib%;%PERL5LIB%

rem execute Mtest.py in the source directory
pushd "%srcdir%"

call "%buildbase%\testing\Mtest.py" "--config=%cfg%" "--package=%pkg%" "--monet_mod_path=%MOD_PATH%" "--dbfarm=%buildbase%\%pkg%\dbfarm" "--TSTTRGBASE=%buildbase%\%pkg%" %1 %2 %3 %4 %5 %6 %7 %8 %9

popd
endlocal
