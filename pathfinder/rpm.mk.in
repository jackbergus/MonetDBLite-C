# The contents of this file are subject to the Pathfinder Public License
# Version 1.1 (the "License"); you may not use this file except in
# compliance with the License.  You may obtain a copy of the License at
# http://monetdb.cwi.nl/Legal/PathfinderLicense-1.1.html
#
# Software distributed under the License is distributed on an "AS IS"
# basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.  See
# the License for the specific language governing rights and limitations
# under the License.
#
# The Original Code is the Pathfinder system.
#
# The Initial Developer of the Original Code is the Database &
# Information Systems Group at the University of Konstanz, Germany.
# Portions created by the University of Konstanz are Copyright (C)
# 2000-2006 University of Konstanz.  All Rights Reserved.

# make rules to generate MonetDB RPMs (works on RedHat Linux, only)

rpmtopdir = $(shell cd $(top_builddir) && pwd)/rpm

$(top_builddir)/$(distdir).tar.gz:
	$(MAKE) $(AM_MAKEFLAGS) dist

rpm:	MonetDB-XQuery.spec $(top_builddir)/$(distdir).tar.gz

	mkdir -p $(rpmtopdir)/RPMS
	mkdir -p $(rpmtopdir)/SRPMS
	mkdir -p $(rpmtopdir)/SPECS
	mkdir -p $(rpmtopdir)/BUILD
	mkdir -p $(rpmtopdir)/INSTALL

	echo "macrofiles: /usr/lib/rpm/macros:/usr/lib/rpm/%{_target}/macros:/etc/rpm/macros.specspo:/etc/rpm/macros.prelink:/etc/rpm/macros.solve:/etc/rpm/macros.up2date:/etc/rpm/macros:/etc/rpm/%{_target}/macros:$(rpmtopdir)/rpmmacros" > $(rpmtopdir)/rpmrc

	echo "%_tmppath          /tmp"                >  $(rpmtopdir)/rpmmacros
	echo "%_topdir           $(rpmtopdir)"        >> $(rpmtopdir)/rpmmacros
	echo "%tmpdir            %{_tmppath}"         >> $(rpmtopdir)/rpmmacros
	echo "%rpmcflags         -O2 "                >> $(rpmtopdir)/rpmmacros
	echo "#%top_builddirroot %{_topdir}/INSTALL/" >> $(rpmtopdir)/rpmmacros
	#( if [ "@DOCTOOLS_TRUE@" = "#" ] ; then \
	#	echo "%builddoc  0"                   >> $(rpmtopdir)/rpmmacros ; \
	# else \
	#	echo "%builddoc  1"                   >> $(rpmtopdir)/rpmmacros ; \
	#fi )
	( if [ "@HAVE_JAVA_TRUE@" = "#" ] ; then \
		echo "%buildjava  0"                   >> $(rpmtopdir)/rpmmacros ; \
	 else \
		echo "%buildjava  1"                   >> $(rpmtopdir)/rpmmacros ; \
	fi )
	echo "%comp_cc  $(CC)"                 	       >> $(rpmtopdir)/rpmmacros ; 
	echo "%buildsystem 1"                	       >> $(rpmtopdir)/rpmmacros ; 


	$(RPMBUILD) --target `uname -m` --rcfile $(rpmtopdir)/rpmrc -ta $(top_builddir)/$(distdir).tar.gz

	rm -rf $(rpmtopdir)/BUILD
