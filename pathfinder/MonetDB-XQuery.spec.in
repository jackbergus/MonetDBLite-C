%define name MonetDB4-XQuery
%define version @VERSION@
%define release 1_@LINUX_DIST@.oid@oids@

%define prefix /usr

Name: %{name}
Version: %{version}
Release: %{release}
Summary: MonetDB XQuery - Monet Database Management System
Group: System
Source: pathfinder-%{version}.tar.gz
BuildRoot: /var/tmp/%{name}-root
Packager: Niels Nes <Niels.Nes@cwi.nl>
License:   MPL - http://monetdb.cwi.nl/Legal/MonetDBLicense-1.1.html
Requires: MonetDB4-server >= 4.18
#                            ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.

%{!?buildsystem: %define buildsystem 0}
%if !%{?buildsystem}
BuildRequires: MonetDB-devel >= 1.18
#                               ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.
BuildRequires: MonetDB4-server-devel >= 4.18
#                                       ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.
%endif
BuildRequires: libxml2-devel

# groups of related archs
%define all_x86 i386 i586 i686

%ifarch %{all_x86}
%define bits 32
%else
%define bits 64
%endif

%description
MonetDB is a database management system that is developed from a
main-memory perspective with use of a fully decomposed storage model,
automatic index management, extensibility of data types and search
accellerators, SQL- and XQuery- frontends.

%package devel
Summary: MonetDB XQuery development package 
Group: System 
Requires: %{name} = %{version}-%{release}
Requires: MonetDB-devel >= 1.18
#                          ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.
Requires: MonetDB4-server-devel >= 4.18
#                                  ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.

%description devel
Add the MonetDB devel description here

%prep
rm -rf $RPM_BUILD_ROOT

%setup -q -n pathfinder-%{version}

%build

./configure \
	--enable-assert=no \
	--enable-optimize \
	--enable-bits=%{bits} \
	%{?comp_cc:CC="%{comp_cc}"} \
	--prefix=%{prefix} \
	--libdir=%{_libdir} \
	--with-monet=%{prefix}

make

%install
rm -rf $RPM_BUILD_ROOT

make install \
	DESTDIR=$RPM_BUILD_ROOT 

#find $RPM_BUILD_ROOT -name .incs.in | xargs rm
find $RPM_BUILD_ROOT -name \*.la | xargs rm -f

# cleanup stuff we don't want to install
rm -rf $RPM_BUILD_ROOT%{_libdir}/MonetDB5
rm -rf $RPM_BUILD_ROOT%{prefix}/bin/monetdb-xquery-config.bat

# Fixes monet config script
#perl -p -i -e "s|$RPM_BUILD_ROOT||" $RPM_BUILD_ROOT%{prefix}/bin/monet_config

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root) 
%{prefix}/bin/pf
%{_libdir}/MonetDB4/lib/lib_*
%{_libdir}/MonetDB4/*.mil
%{prefix}/bin/Mbeddedxq
%{_libdir}/libembeddedxq.so.*
%{_datadir}/doc/MonetDB-XQuery-%{version}/*
#%{_datadir}/doc/%{name}-%{version}/*
%{_datadir}/MonetDB/xrpc/admin/*
%{_datadir}/MonetDB/xrpc/export/*

%files devel
%defattr(-,root,root) 
%{prefix}/include/pathfinder/*.h
%{_libdir}/libembeddedxq.so
%{prefix}/bin/monetdb-xquery-config

%changelog
* Mon Jun 25 2007 Sjoerd Mullender <sjoerd@acm.org> - @VERSION@-1
- Built.

