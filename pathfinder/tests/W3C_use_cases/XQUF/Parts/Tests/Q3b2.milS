module(ascii_io);
module(unix);
module(pathfinder);
var TSTSRCDIR := getenv("TSTSRCDIR");
shred_doc(TSTSRCDIR+"/part-list.xml", "part-list.xml", "Parts", 9LL);
shred_doc(TSTSRCDIR+"/part-tree.xml", "part-tree.xml", "Parts", 9LL);

xquery("xml","
declare updating function
             local:delete-subtree($p as element(part))
  {
      for $child in doc(\"part-list.xml\")//part
      where $p/@partid eq $child/@partof
      return local:delete-subtree($child)
      ,
      do delete $p
  "+"};"+"

for $p in doc(\"part-tree.xml\")//part[@name=\"car\"]/part
return
  local:delete-subtree($p)
").printf();
fflush(stdout());
fflush(stderr());

xquery("xml","
doc(\"part-list.xml\")
").printf();
fflush(stdout());
fflush(stderr());

xquery("xml","
doc(\"part-tree.xml\")
").printf();
fflush(stdout());
fflush(stderr());

delete_doc("part-list.xml");
delete_doc("part-tree.xml");
