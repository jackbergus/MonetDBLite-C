module(ascii_io);
module(unix);
module(pathfinder);
var TSTSRCDIR := getenv("TSTSRCDIR");
shred_doc(TSTSRCDIR+"/part-list.xml", "part-list.xml", "Parts", 9LL);
shred_doc(TSTSRCDIR+"/part-tree.xml", "part-tree.xml", "Parts", 9LL);

xquery("xml","
let $next := max(doc(\"part-tree.xml\")//@partid) + 1
  return
    do insert <part partid=\"{$next}\" name=\"radio\"/>
       as first into
       exactly-one(for $p in doc(\"part-tree.xml\")//part where $p/@partid=0 and $p/@name=\"car\" return $p)
").printf();
fflush(stdout());
fflush(stderr());

xquery("xml","
doc(\"part-list.xml\")
").printf();
fflush(stdout());
fflush(stderr());

xquery("xml","
doc(\"part-tree.xml\")
").printf();
fflush(stdout());
fflush(stderr());

delete_doc("part-list.xml");
delete_doc("part-tree.xml");
