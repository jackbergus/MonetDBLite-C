module("pathfinder");
xquery("xml","\
let $bib := \n\
<bib>\n\
  <book>\n\
    <title>TCP/IP Illustrated</title>\n\
    <author>Stevens</author>\n\
    <publisher>Addison-Wesley</publisher>\n\
  </book>\n\
  <book>\n\
    <title>Advanced Programming\n\
           in the Unix Environment</title>\n\
    <author>Stevens</author>\n\
    <publisher>Addison-Wesley</publisher>\n\
  </book>\n\
  <book>\n\
    <title>Data on the Web</title>\n\
    <author>Abiteboul</author>\n\
    <author>Buneman</author>\n\
    <author>Suciu</author>\n\
  </book>\n\
</bib>\n\
return \n\
<authlist>\n\
 {\n\
   for $a in fn:distinct-values($bib/book/author)\n\
   order by $a\n\
   return\n\
     <author>\n\
        <name> {$a} </name>\n\
        <books>\n\
          {\n\
            for $b in $bib/book[author = $a]\n\
            order by fn:zero-or-one($b/title)\n\
            return $b/title \n\
          }\n\
        </books>\n\
     </author>\n\
 }\n\
</authlist>\n\
").printf();
quit();
