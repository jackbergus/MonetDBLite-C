pf:add-doc("$TSTSRCDIR/compilation_error.SF-2860574.xml","view-defs.xml",10)
<>
doc("view-defs.xml")
<>

declare function add-int-attr($element as element()
,$val as xs:integer?)
as element()?
{
element {$element/name()} {
attribute { 'seq' } { $val },
$element/@*,
$element/node()
}
};


declare updating function save-view($savedoc as xs:string
,$name as xs:string
,$user as xs:string
,$view as element())
{
let $doc := doc($savedoc)
let $save := $doc/views/active/view[@name eq $name and @user eq $user]
return
if (empty($save))
then
let $v := $view
return do insert $v as last into $doc/views/active
else (
let $v := $view
return (
do replace $save with $v,
do insert $save as last into $doc/views/archive
)
)
};


save-view("view-defs.xml", "zambon", "axel", <view now='1253179900.00036'
name='zambon' prevseq='0' user='axel'><select allany='' inex='include'
><cond cmp='eq' field='creators_family'>zambon</cond></select></view>)

<>
doc("view-defs.xml")
<>
pf:del-doc("view-defs.xml")
