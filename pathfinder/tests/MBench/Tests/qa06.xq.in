declare namespace my='my-functions';
declare function my:depth($e as node()*) as xs:integer
{ 
if (empty($e/eNest)) then 1 else max(my:depth($e/eNest)) + 1 
};

for $e in doc("$TSTTRGDIR/sf0.1.xml")//eNest[@aLevel=7] 
return
<eNest aUnique1="{$e/@aUnique1}" aLevel="{$e/@aLevel}" depth="{my:depth($e)}">
</eNest>
