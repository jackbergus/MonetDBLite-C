# ChangeLog file for sql/src/backends/monet5/merovingian
# This file is updated with mchangelog

  16 Jul 2010; Fabian Groffen <fabian@cwi.nl> merovingian.c,
  merovingian_forkmserver.c, monetdb.1.in, properties.c:
  Remove references to master/slave settings, since replication isn't yet
  fully implemented in Jun2010 branch.

*Jun2010-SP1

  01 Jul 2010; Fabian Groffen <fabian@cwi.nl> merovingian.c:
  When a startup failure causes a shutdown, make sure we log this
  incident in the logfile, together with a message that the deamon was
  shut down due to this fatal condition.

*Jun2010

  01 Jun 2010; Fabian Groffen <fabian@cwi.nl> merovingian.c, utils.c:
  Fixed an issue where Merovingian's strict umask was applied too early
  causing files to be inaccessible.  Now the .merovingian_control socket
  file is accessible to both user and group of the merovingian process,
  and the .mapi_socket file is accessible to everyone like a TCP socket
  is.  Fixes bug #2550.

  01 Jun 2010; Fabian Groffen <fabian@cwi.nl> merovingian.c:
  Properly clean up .merovingian_control file in dbfarm.

  01 Jun 2010; Fabian Groffen <fabian@cwi.nl> merovingian.1.in,
  merovingian.c:
  Removed database pre-starting (mis-)feature, any argument to
  merovingian now yields in a version message followed by a server exit.

  07 Apr 2010; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  Sort output returned by discover, status and get commands based on url
  or dbname.

  24 Mar 2010; Fabian Groffen <fabian@cwi.nl> merovingian.c,
  merovingian_client.c:
  Implemented UNIX domain socket listener for Merovingian, found as
  mapi_socket in the dbfarm.  Client connections can be made over it
  like normal TCP connections.

  17 Mar 2010; Fabian Groffen <fabian@cwi.nl> merovingian_proxy.c:
  When a proxy connection is made to a local UNIX domain socket, pass
  on the filedescriptor instead of proxying.

  16 Mar 2010; Fabian Groffen <fabian@cwi.nl>
  merovingian_forkmserver.c, merovingian_proxy.c:
  Use mserver5's UNIX domain socket support when Merovingian is supposed
  to proxy the connection to the database.

  16 Mar 2010; Fabian Groffen <fabian@cwi.nl>
  merovingian_controlrunner.c:
  Enlarged buffer to avoid incomplete output being sent to monetdb(1),
  causing commands like status and get to fail on certain
  configurations.

  05 Mar 2010; Fabian Groffen <fabian@cwi.nl> merovingian_client.c:
  Avoid running over the allocated buffer space resulting in crashes
  when a client connects which IP address cannot be resolved into a
  hostname, bug #2964247

*Feb2010-SP1
*Feb2010
*Nov2009-SP2

  21 Jan 2010; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  Changed wording of monetdb status -l for last crash to indicate the time
  reported is not the crash time, but the time the server was started which
  eventually crashed, bug #2900355

  13 Jan 2010; Fabian Groffen <fabian@cwi.nl> merovingian.c:
  Strip trailing newlines from the control channel password, bug #2931392

*Nov2009-SP1

  11 Dec 2009; Fabian Groffen <fabian@cwi.nl> merovingian_forkmserver.c,
  monetdb.1, properties.c:
  The master property of a database now contains an id that is used to
  identify the master to the slaves. The id can be given using monetdb set, or
  one is generated when no id is supplied (when just setting it to 'yes')

*Nov2009

  26 Oct 2009; Fabian Groffen <fabian@cwi.nl> utils.c
  Fix bug that caused monetdb status to list an incorrect uptime in
  cases where the uptime was longer than 7 days.

  08 Oct 2009; Fabian Groffen <fabian@cwi.nl> merovingian.c,
  merovingian_forkmserver.c, monetdb.c, properties.c:
  Add optpipe setting to control the SQL optimiser pipeline, useful for
  experimentation per database

  08 Oct 2009; Fabian Groffen <fabian@cwi.nl> merovingian_forkmserver.c:
  Export the URI the database is reachable from remotely to the database via
  merovingian_uri GDKenvironment setting. This can be used by applications
  inside the database that need to give a pointer back to themselves.

  30 Sep 2009; Fabian Groffen <fabian@cwi.nl> merovingian.c,
  merovingian_forkmserver.c, monetdb.c, properties.c, utils.c, utils.h:
  Add slave property for databases

  25 Sep 2009; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  Implemented global -q option to monetdb to suppress status messages when
  performing commands

  25 Sep 2009; Fabian Groffen <fabian@cwi.nl> glob.c:
  Improved globbing to support escapes, such that the literal asterisk symbol
  can be matched using \*

  25 Sep 2009; Fabian Groffen <fabian@cwi.nl> merovingian_discoveryrunner.c,
  monetdb.1:
  Remote controllable merovingians now announce their controlport. These
  control entries show up in monetdb discover output marked with an asterisk.

  23 Sep 2009; Fabian Groffen <fabian@cwi.nl> monetdb.1, monetdb.c,
  merovingian.1, merovingian.c, merovingian_controlrunner.c:
  Implemented Feature Request #2830754. monetdb can now control a remote
  merovingian using the -h -p and -P global options to monetdb. The password
  used is stored at the merovingian site in the .merovingian_pass file in the
  controlled dbfarm.

  18 Sep 2009; Fabian Groffen <fabian@cwi.nl> monetdb.c, monetdb.1:
  monetdb now requires merovingian to be running to perform any
  operation

  09 Sep 2009; Fabian Groffen <fabian@cwi.nl> merovingian_discoveryrunner.c:
  No longer announce databases that are under maintenance, this allows them to
  be pulled out of the cluster easily

  04 Sep 2009; Fabian Groffen <fabian@cwi.nl> merovingian_forkmserver.c,
  monetdb.c, monetdb_get.c, properties.c:
  Add master property of boolean value that translates into
  replication_master for mserver5 to trigger storing replication logs

  20 Aug 2009; Fabian Groffen <fabian@cwi.nl> database.c, database.h,
  monetdb.c, monetdb.1:
  Always put created databases under maintenance, they have to be explicitly
  released after creating and performing the initialisation steps by the DBA

*Aug2009-SP2
*Aug2009-SP1

  25 Aug 2009; Fabian Groffen <fabian@cwi.nl> merovingian.c:
  Properly recognise mero_port option from config file, bug #2844202

*Aug2009

  31 Jul 2009; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  monetdb destroy now allows to remove a database under maintenance. This way
  an administrator can prevent users connecting to the database and hence
  starting it on demand, which in turn prevents removal of the database.

  21 Jul 2009; Fabian Groffen <fabian@cwi.nl> merovingian.1,
  merovingian.c, monetdb.1, monetdb.c:
  Implemented sharing of databases with tags. Using these tags, extra
  information is available on a remote merovingian to select a database during
  connect. For this, a client can now connect to a database using a glob
  expression, which is matched on the database plus tag.  When multiple
  databases match such expression, a load-balancing technique is
  applied.

  02 Jul 2009; Fabian Groffen <fabian@cwi.nl> monetdb.1, monetdb.c:
  Allow expression matches for 'monetdb status' command.

  01 Jul 2009; Fabian Groffen <fabian@cwi.nl> monetdb.1, monetdb.c:
  Allow an expression to be used to match against the list of discovered
  databases for future convenience.

  19 Jun 2009; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  Allow setting the name of a database (a.k.a. renaming it), doing all the
  logic to keep the logdir aligned in case it's absolute.

  19 Jun 2009; Fabian Groffen <fabian@cwi.nl> merovingian.c,
  merovingian.1:
  Increase the default mero_exittimeout from 7 to 60 seconds.

  19 Jun 2009; Fabian Groffen <fabian@cwi.nl> monetdb.1, monetdb.c:
  Restrict database names created by monetdb to the pattern [A-Za-z0-9-_]+.

  17 Jun 2009; Fabian Groffen <fabian@cwi.nl> merovingian.1,
  merovingian.c, monetdb.1, monetdb.c, +utils.c, +utils.h,
  +properties.c, +properties.h:
  Implemented full per-database property support.  monetdb now can
  manage the following per-database properties: logdir, forward, shared,
  nthreads.  Feature Request #1837591.

  16 Jun 2009; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  Fixed bug where destroying multiple databases without -f would abort after
  the first database.

  08 Jun 2009; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  Avoid multiple questions by merging them into a single confirmation for the
  destroy command.  This accidently fixes a bug where a response such as 'yes'
  would abort the next database removal.

  04 Jun 2009; Fabian Groffen <fabian@cwi.nl> merovingian.1, merovingian.c:
  Implemented a configurable port for the neighbour discovery service. This
  also allows to entirely disable neighbour discovery by setting
  mero_discoveryport to 0.  Feature request #2800964

  02 Jun 2009; Fabian Groffen <fabian@cwi.nl> monetdb.c:
  Implemented dynamic width of monetdb status output. If a database name is
  wider than 14 chars, the name column is made wider as long as the
  terminal window allows.  If a column cannot be made any wider this
  way, it is abbreviated as before.

*May2009

  15 May 2009; Fabian Groffen <fabian@cwi.nl> merovingian.1, merovingian.mx:
  Implemented Feature Request #2705670.  Reopen logfiles when SIGHUP is
  received.

  13 May 2009; Fabian Groffen <fabian@cwi.nl> merovingian.1, merovingian.mx:
  Implemented Feature Request #2782776. All logged messages are now prefixed
  with a timestamp.

*Feb2009-SP2

  21 Apr 2009; Fabian Groffen <fabian@cwi.nl> merovingian.mx, monetdb.1:
  Instead of sending SIGTERM and immediately returning, call the
  terminateProcess function such that we nicely wait for the process to have
  died, and eventually send a SIGKILL if that fails. Fixes bug #2747661

  30 Mar 2009; Sjoerd Mullender <sjoerd@cwi.nl> monetdb.mx:
  If the logdir argument to logger_create is a relative path name, the
  logdir will be located inside the dbfarm/dbname directory.  If it is
  an absolute path name, that path is used.  Fixed monetdb destroy with
  regard to this new behaviour.

*Feb2009-SP1

  23 Mar 2009; Fabian Groffen <fabian@cwi.nl> merovingian.mx:
  Remove the pid file upon shutdown, fixes bug #2705666

  02 Mar 2009; Fabian Groffen <fabian@cwi.nl> monetdb.mx:
  Small cosmetic fix not to overflow the uptime in monetdb status display

  23 Feb 2009; Fabian Groffen <fabian@cwi.nl> ChangeLog:
  Fix hang on Linux when shutting down. select() calls are not interrupted on
  Linux, so make sure they time out. Fixes bug #2623838

  19 Feb 2009; Fabian Groffen <fabian@cwi.nl> merovingian.mx:
  Fixed crash of merovingian when a to be started database terminates
  immediately after startup (such as when it crashes)

  16 Feb 2009; Fabian Groffen <fabian@cwi.nl> merovingian.mx:
  Protect shared linked list structures from being accessed and/or modified by
  two or more threads concurrently. This resolves random crashes. Fixes bug
  #2605706

  16 Feb 2009; Fabian Groffen <fabian@cwi.nl> monetdb.mx:
  Fixed crash when using monetdb stop on a non-started database.  Bug #2605105

  02 Feb 2009; Fabian Groffen <fabian@cwi.nl> merovingian.mx:
  Create logfiles when they do not exist.  Bug #2556973

*Feb2009

  28 Dec 2008; Fabian Groffen <fabian@cwi.nl> merovingian.mx:
  Switched internally to select() calls instead of non-blocking IO loops. This
  reduces the CPU usage in idlestate considerably.

  28 Dec 2008; Fabian Groffen <fabian@cwi.nl> merovingian.mx:
  Properly handle SIGHUP, such that merovingian does not silently terminate

  08 Dec 2008; Fabian Groffen <fabian@cwi.nl> merovingian.1:
  Fix manpage header

