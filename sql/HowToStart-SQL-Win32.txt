This document will help you compile and install the MonetDB SQL front end
"MonetDB/SQL".

In case you prefer to install a pre-compiled binary distribution, please
check-out http://sourceforge.net/project/showfiles.php?group_id=56967 .

This document assumes that you have installed MonetDB on a native
Windows system (NT, 2000, XP), and that you are planning to compile and
install the MonetDB SQL front end on the same system.
For compilation and installation on a Unix system (e.g., Linux, IRIX,
Solaris, AIX, MacOS X/Darwin, or CYGWIN) see the instructions in the
file 'HowToStart-SQL'.


Prerequisites:
==============

CVS
	You need to have a working CVS. Several solutions are
	available. We use internally WinCVS (http://www.wincvs.org)
	and CVS under Cygwin (http://www.cygwin.com)
	For general information about the sourceforge repository, see
	http://sourceforge.net/docman/?group_id=1 and look under the
	heading CVS Instructions.  Pointers to CVS implementations 
	for Windows can be found at e.g.:
	http://www.cvshome.org/cyclic/cvs/windows.html
	http://www.wincvs.org/
	http://www.componentsoftware.com/products/CVS/

Python
	MonetDB/SQL uses Python (version 2.0.0 or better) during
	configuration of the software.  See http://www.python.org/ for
	more information.

Pthreads for Win32
	(ftp://sources.redhat.com/pub/pthreads-win32/)
	Pthreads should be installed to C:\Pthreads, otherwise you need
	to patch the "PTHREAD = C:\Pthreads" line in "NT\rules.msc"
	according to your setup. Newer versions of Pthreads seem to
	have the "include" & "lib" directory not in C:\Pthreads, but in
	C:\Pthreads\prebuilt. In that case, you either have to move the
	"include" & "lib" directory from C:\Pthreads\prebuilt to 
	C:\Pthreads, or set "PTHREAD = C:\Pthreads\prebuilt" in
	"NT\rules.msc".

UnxUtils for Win32
	(http://UnxUtils.sourceforge.net/)
	UnxUtils must be installed in the root directory ("\", i.e.,
	without the default "\UnxUtils\" prefix) of the drive where you
	want to compile MonetDB/SQL.
	The same drive is required, as the UnxUtils do not know about
	drive letters, and hence absolute paths start with "\" (i.e.,
	without a leading "C:", "D:", ...).  The default "\UnxUtils\"
	prefix has to be omitted, as other the UnxUtils' "bison" does
	not find its own "bison.simple" file, which it expects to be in
	"/usr/share/bison/bison.simple" (aka. 
	"\usr\share\bison\bison.simple").
	Next to some tools used by Mtest.py for testing MonetDB/SQL (see
	below), UnxUtils provide the lexical analyzer generator "flex"
	and the parser generator "bison", which are required to compile
	MonetDB/SQL.
	Note: You have to install the UnxUtils using the original .zip
	file (http://UnxUtils.sourceforge.net/UnxUtils.zip). With the
	third-party executable installer
	(http://www.braindonors.net/products/unxutils.asp), choosing
	another than the default installation directory doesn't seem to
	work...
	
Microsoft Visual C++
	You need Microsoft Visual C++ 5 or higher.

	Notice that if you do not own Microsoft Visual C++, you can
	still compile on Windows using the Cygnus Posix-emulation
	environment "CYGWIN" (http://www.cygwin.com). In that case, you
	should follow the standard instructions in the file
	'HowToStart-SQL'. Alternatively, it might be possible to use the
	free WIN32-GNU compilers (http://www.mingw.org/index.shtml) as a
	drop-in replacement for the Microsoft tools, but we have not
	tried this yet.

disk space
	After downloading, MonetDB/SQL takes up about 75 MB of disk space;
	compilation adds another 13 MB.  Testing takes about 155 MB, and
	the installation about 3 MB (not including any databases).


Getting the Software:
=====================

This command should be done once.  It records a password on the local
machine to be used for all subsequent CVS accesses with this server.

 cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/monetdb login

Just type RETURN when asked for the password. The actual steps depend on
your CVS tool, e.g. in WinCVS you have to set the Admin preferences.
Then get the software by using the command:

 cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/monetdb checkout sql

This will create a directory 'sql' in your current working directory.

Also see http://sourceforge.net/cvs/?group_id=56967 for more
information.


Compiling:
==========
Open a Windows command shell or a UnxUtils shell and go to the 
top-level directory of sql.

Make sure that the proper environment for MSVC++ is set,
otherwise call the corresponding BAT file.
(see C:\Program Files\Microsoft Visual Studio\VC98\Bin\VCVARS32.BAT).

Make sure that Python, C:\Pthreads\lib (or wherever you installed
Pthreads), and \usr\local\wbin are in the PATH of your command shell.

Further, create an enviroment variable MONETDB_PREFIX that contains the
absolute path of the directory where your installed MonetDB, e.g.,

 set MONETDB_PREFIX=<monet-source>\NT

and make sure that %MONETDB_PREFIX%\bin, %MONETDB_PREFIX%\lib, and
%MONETDB_PREFIX%\lib\MonetDB are in your PATH.

When all prerequisites have been satisfied, you type

 cd NT
 nmake

to compile the source code.


Testing the Build:
==================

If nmake went successfully, you can try

 nmake check

This will do a lot of tests, some are unfortunately still expected to
fail, but most should go successfully.  At the end of the output there
is a reference to an HTML file which is created by the test process and
shows the test results.  An explanation of the test results can be found
in XXX--to be filled in.

Testing takes about 155 MB of disk space in the build directory.


Installing:
===========

Give the command

 nmake install

By default this will install MonetDB/SQL to <sql-source>\NT\ where
<sql-source> is the top-level directory of MonetDB/SQL source tree.
The current version does not provide any means to change this default.


Testing the Installation:
=========================

Make sure that <sql-source>\NT\bin, <sql-source>\NT\lib, and
<sql-source>\NT\lib\MonetDB are in your PATH.

In the sql top-level directory issue the command

 Mtest.py --monet_mod_path=<monet-source>\NT\lib\MonetDB;<sql-source>\NT\lib\MonetDB --SQL_PREFIX=<sql-source>\NT --TSTSRCBASE=<sql-source> --TSTBLDBASE=<sql-source>\NT --TSTTRGBASE=<sql-source>\NT -r

This should produce much the same output as nmake check above, but uses
the installed version of MonetDB/SQL.


Usage:
======

To use the MonetDB SQL front end interactively, you first need to start
an MonetDB server ("Mserver") with sql support. To do so, first make
sure, that your environment is set as described in "Compiling" and
"Testing the Installation" above.

In case the install (i.e., prefix) directories of MonetDB and
MonetDB/SQL are identical, simply call

 Mserver --dbinit="module(sql_server); sql_server_start();"

In case you use different install (i.e., prefix) directories of MonetDB
and MonetDB/SQL, call

 Mserver --set monet_mod_path=<monet-prefix>\lib\MonetDB;<sql-prefix>\lib\MonetDB --dbinit="module(sql_server); sql_server_start();"

To change the location of the log-files, add the following option to Mserver:
 
 --set sql_logdir=<logdir>

Then, in a second Windows command shell, set up the same environment
and start the MonetDB SQL front end by calling

 MapiClient -lsql -umonetdb -Pmonetdb


Documentation:
==============

Some initial documention of the MonetDB SQL front end is available in
SQLfeatures.tex and SQLsessionDemo.html.

