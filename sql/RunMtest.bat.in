@echo off

if not "%1"=="" goto skip
call %0 -rq
goto end

:skip

setlocal

set monetdb4_prefix=@MONETDB4_PREFIX@
set builddir=@SQL_BUILD@
set srcdir=@SQL_SOURCE@

set MOD_PATH=%builddir%\src\backends\monet4\.libs
set MOD_PATH=%MOD_PATH%;%sqldir%\src\backends\monet4
set MOD_PATH=%MOD_PATH%;%monetdb4_prefix%\lib\MonetDB4
set MOD_PATH=%MOD_PATH%;%monetdb4_prefix%\lib\MonetDB4\lib
set MOD_PATH=%MOD_PATH%;%monetdb4_prefix%\lib\MonetDB4\bin

set PATH=@XCLIENTS_PREFIX@\lib\MonetDB\Tests;%PATH%
set PATH=@XMONETDB5_PREFIX@\bin;%PATH%
set PATH=@XMONETDB4_PREFIX@\bin;%PATH%
set PATH=@XCLIENTS_PREFIX@\bin;%PATH%
set PATH=@XMONETDB_PREFIX@\bin;%PATH%
set PATH=%MOD_PATH%;%PATH%
set PATH=%builddir%\src\server;%PATH%
set PATH=%builddir%\src\storage\bat;%PATH%
set PATH=%builddir%\src\common;%PATH%
set PATH=%builddir%\src\tools;%PATH%

set PYTHONPATH=@XMONETDB_PREFIX@\share\MonetDB\python;%PYTHONPATH%
set PYTHONPATH=@XCLIENTS_PREFIX@\share\MonetDB\python;%PYTHONPATH%
set PYTHONPATH=%builddir%\src\tools;%PYTHONPATH%

REM execute Mtest.py in the source directory
pushd %srcdir%

call Mtest.py "--config=%monetdb4_prefix%\etc\MonetDB.conf" "--monet_mod_path=%MOD_PATH%" "--dbfarm=%builddir%\dbfarm" "--sql_logdir=%builddir%\sql_logs" "--xquery_logdir=%builddir%\xquery_logs" "--TSTSRCBASE=%srcdir%" "--TSTBLDBASE=%builddir%" "--TSTTRGBASE=%builddir%" %*
REM "--SQL_PREFIX=%builddir%\src\tools"

popd
endlocal

:end
