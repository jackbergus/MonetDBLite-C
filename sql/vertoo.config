# -*- mode: python -*-
addScheme('normal', '%major.%minor.%release')
addScheme('winrc', '%major,%minor,%release,%build')
#addScheme('jdbc_full', '%major.%minor (%suffix)')

main = addModule('sql')
monetdb = addModule('MonetDB')
#jdbc = addModule('jdbc')

main.setVersionFormat('@normal%[rc?_rc%build:]')

# %v - unadorned version number
# %q - version number surrounded by single quotes
# %Q - version number surrounded by double quotes
main.addAnchor("src/odbc/winsetup/MonetDB-ODBC-Installer/MonetDB-ODBC-Installer.vdproj",
               arguments(pattern = '"ProductVersion" = "8:%v"',
                         format = '@normal'))
main.addAnchors("src/odbc/winsetup/setup.rc",
                'VALUE "FileVersion", "%v\\0"',
                'VALUE "ProductVersion", "%v\\0"',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchors("src/odbc/driver/driver.rc",
                'VALUE "FileVersion", "%v\\0"',
                'VALUE "ProductVersion", "%v\\0"',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchor("NT/rules.msc", "VERSION = %v")
main.addAnchor("NT/configure.py", "'@VERSION@',                r%q")
main.addAnchor("configure.ag", '"sql", %v,')
main.addAnchor("VERSION", "%v")

monetdb.setVersionFormat('%major.%minor.%release')
monetdb.addAnchor("configure.ag", "req_monetdb_ver=%q")
monetdb.addAnchor("MonetDB-SQL.pc.in", "Requires: MonetDB >= %v")

#jdbc.setVersionFormat('%major.%minor (%suffix)')
#jdbc.addAnchors("src/jdbc/build.properties",
#               	arguments(pattern = "JDBC_MAJOR=%v", format = "%major"),
#                arguments(pattern = "JDBC_MINOR=%v", format = "%minor"),
#                arguments(pattern = "JDBC_VER_SUFFIX=%v", format = "%suffix"))
#jdbc.addAnchors("configure.ag",
#                arguments(pattern = "JDBC_MAJOR=%v", format = "%major"),
#                arguments(pattern = "JDBC_MINOR=%v", format = "%minor"),
#                arguments(pattern = "JDBC_VER_SUFFIX=%v", format = "%suffix"))
#jdbc.addAnchors("NT/configure.py",
#                arguments(pattern = "'@JDBC_MAJOR@',        %q",
#                          format = "%major"),
#                arguments(pattern = "'@JDBC_MINOR@',        %q",
#                          format = "%minor"),
#                arguments(pattern = "'@JDBC_VER_SUFFIX@',   %q",
#                          format = "%suffix"))
#jdbc.addAnchor("src/jdbc/release.txt", "MonetDB JDBC driver version %v")
