# -*- mode: python -*-
addScheme('normal', '%major.%minor.%release')
#addScheme('jdbc_full', '%major.%minor (%suffix)')

main = addModule('sql')
monetdb = addModule('MonetDB')
clients = addModule('clients')
monetdb4 = addModule('MonetDB4')
monetdb5 = addModule('MonetDB5')
#jdbc = addModule('jdbc')

# %v - unadorned version number
# %q - version number surrounded by single quotes
# %Q - version number surrounded by double quotes

main.setVersionFormat('@normal%[rc?%rc%build:]')
main.addAnchor("VERSION", "%v")
main.addAnchor("configure.ag", '"sql", %v,')
main.addAnchor("NT/rules.msc", "VERSION = %v")
main.addAnchors("NT/MonetDB4-SQL/MonetDB4-Installer.vdproj",
                    arguments(pattern = "MonetDB-SQL-%v",
                              format = '@normal'))
main.addAnchors("NT/MonetDB5-SQL/MonetDB5-Installer.vdproj",
                    arguments(pattern = "MonetDB-SQL-%v",
                              format = '@normal'))

monetdb.setVersionFormat('@normal%[rc?%rc%build:]')
monetdb.addAnchor("configure.ag", "req_monetdb_ver=%q")
monetdb.addAnchors("MonetDB-SQL.spec.in",
                   arguments(pattern = "BuildRequires: MonetDB-devel = %v",
                             format = "%major.%minor"))

clients.setVersionFormat('@normal%[rc?%rc%build:]')
clients.addAnchor("configure.ag", "req_clients_ver=%q")
clients.addAnchors("MonetDB-SQL.spec.in",
                   arguments(pattern = "BuildRequires: MonetDB-client-devel = %v",
                             format = "%major.%minor"))

monetdb4.setVersionFormat('@normal%[rc?%rc%build:]')
monetdb4.addAnchor("configure.ag", "req_monetdb4_ver=%q")
monetdb4.addAnchor("MonetDB-SQL.pc.in", "Requires: MonetDB = %v")
monetdb4.addAnchors("NT/MonetDB4-SQL/MonetDB4-Installer.vdproj",
                    arguments(pattern = "\"ProductVersion\" = \"8:%v\"",
                              format = '@normal'))
monetdb4.addAnchors("MonetDB-SQL.spec.in",
                    arguments(pattern = "Requires: MonetDB4-server = %v",
                              format = "%major.%minor"),
                    arguments(pattern = "BuildRequires: MonetDB4-server-devel = %v",
                              format = "%major.%minor"))

monetdb5.setVersionFormat('@normal%[rc?%rc%build:]')
monetdb5.addAnchor("configure.ag", "req_monetdb5_ver=%q")
monetdb5.addAnchors("NT/MonetDB5-SQL/MonetDB5-Installer.vdproj",
                    arguments(pattern = "\"ProductVersion\" = \"8:%v\"",
                              format = '@normal'))
monetdb5.addAnchors("MonetDB-SQL.spec.in",
                    arguments(pattern = "Requires: MonetDB5-server = %v",
                              format = "%major.%minor"),
                    arguments(pattern = "BuildRequires: MonetDB5-server-devel = %v",
                              format = "%major.%minor"))

#jdbc.setVersionFormat('%major.%minor (%suffix)')
#jdbc.addAnchors("src/jdbc/build.properties",
#               	arguments(pattern = "JDBC_MAJOR=%v", format = "%major"),
#                arguments(pattern = "JDBC_MINOR=%v", format = "%minor"),
#                arguments(pattern = "JDBC_VER_SUFFIX=%v", format = "%suffix"))
#jdbc.addAnchors("configure.ag",
#                arguments(pattern = "JDBC_MAJOR=%v", format = "%major"),
#                arguments(pattern = "JDBC_MINOR=%v", format = "%minor"),
#                arguments(pattern = "JDBC_VER_SUFFIX=%v", format = "%suffix"))
#jdbc.addAnchors("NT/configure.py",
#                arguments(pattern = "'@JDBC_MAJOR@',        %q",
#                          format = "%major"),
#                arguments(pattern = "'@JDBC_MINOR@',        %q",
#                          format = "%minor"),
#                arguments(pattern = "'@JDBC_VER_SUFFIX@',   %q",
#                          format = "%suffix"))
#jdbc.addAnchor("src/jdbc/release.txt", "MonetDB JDBC driver version %v")
