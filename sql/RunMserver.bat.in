@echo off

setlocal

rem default back end is MonetDB4
set V=4
if "%1" == "-4" set V=4 & shift
if "%1" == "-5" set V=5 & shift

set monetdb4_prefix=@XMONETDB4_PREFIX@
set monetdb5_prefix=@XMONETDB5_PREFIX@

if %V% == 4 call "%monetdb4_prefix%\bin\monetdb4-config.bat" --internal
if %V% == 5 call "%monetdb5_prefix%\bin\monetdb5-config.bat" --internal

set builddir=@XSQL_BUILD@

set MOD_PATH=%modpath%
set MOD_PATH=%builddir%\src\backends\monet%V%\.libs;%MOD_PATH%

set PATH=%MOD_PATH%;%PATH%
set PATH=%builddir%\src\server;%PATH%
set PATH=%builddir%\src\storage\bat;%PATH%
set PATH=%builddir%\src\common;%PATH%
set PATH=%builddir%\src\backends\monet%V%;%PATH%
set PATH=%builddir%\conf;%PATH%

if %V% == 4 set mserver=Mserver.exe
if %V% == 5 set mserver=mserver5.exe

%mserver% --set "monet_mod_path=%MOD_PATH%" "--dbfarm=%builddir%\dbfarm" %*

endlocal
