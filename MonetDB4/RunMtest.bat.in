@echo off

if not "%1"=="" goto skip
call %0 -rq
goto end

:skip

setlocal

set pkg=monetdb4
set builddir=@XMONETDB4_BUILD@
set srcdir=@XMONETDB4_SOURCE@

set MOD_PATH=%builddir%\src\modules\plain\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\plain
set MOD_PATH=%MOD_PATH%;%srcdir%\src\modules\plain
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\contrib\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\contrib
set MOD_PATH=%MOD_PATH%;%srcdir%\src\modules\contrib
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\calibrator\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\calibrator
set MOD_PATH=%MOD_PATH%;%srcdir%\src\modules\calibrator
set MOD_PATH=%MOD_PATH%;%builddir%\src\mapi\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\mapi
set MOD_PATH=%MOD_PATH%;%srcdir%\src\mapi
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\mnetcdf\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\mnetcdf
set MOD_PATH=%MOD_PATH%;%srcdir%\src\modules\mnetcdf
set MOD_PATH=%MOD_PATH%;%srcdir%\scripts\tools

set PATH=%MOD_PATH%;%PATH%
set PATH=%builddir%\src\monet;%PATH%
set PATH=%builddir%\src\tools;%PATH%
set PATH=%builddir%\conf;%PATH%

REM execute Mtest.py in the source directory
pushd %srcdir%

call Mtest.py "--config=%builddir%\conf\MonetDB.conf" --package=%pkg% "--monet_mod_path=%MOD_PATH%" "--dbfarm=%builddir%\dbfarm" "--sql_logdir=%builddir%\sql_logs" "--xquery_logdir=%builddir%\xquery_logs" "--TSTTRGBASE=%builddir%" %*

popd
endlocal

:end
