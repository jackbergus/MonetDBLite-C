module("unix");module("str");module("ascii_io");

var ttd := getenv("TSTTRGDIR");

printf("> var _MMnilcast_5 := new(oid,oid).import(ttd+\"/BATkey.x.data\").rename(\"_MMnilcast_5\"); \n");
	  var _MMnilcast_5 := new(oid,oid).import(ttd+"/BATkey.x.data").rename("_MMnilcast_5");
printf("> var indexList1 := new(oid,oid).import(ttd+\"/BATkey.y.data\").rename(\"indexList1\"); \n");
	  var indexList1 := new(oid,oid).import(ttd+"/BATkey.y.data").rename("indexList1");
printf("> _MMnilcast_5.print(); \n");
	  _MMnilcast_5.print();
printf("> indexList1.print(); \n");
	  indexList1.print();
printf("> var _MMjoin_13 := join(_MMnilcast_5,indexList1).rename(\"_MMjoin_13\"); \n");
	  var _MMjoin_13 := join(_MMnilcast_5,indexList1).rename("_MMjoin_13");
printf("> _MMjoin_13.print(); \n");
	  _MMjoin_13.print();
printf("> var _MMcastnil_14 := _MMjoin_13.mark(0@0).rename(\"_MMcastnil_14\"); \n");
	  var _MMcastnil_14 := _MMjoin_13.mark(0@0).rename("_MMcastnil_14");
printf("> _MMcastnil_14.print(); \n");
	  _MMcastnil_14.print();
printf("> var _MMnilcast_15 := _MMjoin_13.reverse().mark(0@0).reverse().rename(\"_MMnilcast_15\"); \n");
	  var _MMnilcast_15 := _MMjoin_13.reverse().mark(0@0).reverse().rename("_MMnilcast_15");
printf("# Here, _MMnilcast_15 gets incorrectly marked haligned with it parent _MMjoin_13.\n");
printf("> _MMnilcast_15.print(); \n");
	  _MMnilcast_15.print();
printf("> orderList1 := new(oid,int).import(ttd+\"/BATkey.z.data\").rename(\"orderList1\"); \n");
	  var orderList1 := new(oid,int).import(ttd+"/BATkey.z.data").rename("orderList1");
printf("> orderList1.print(); \n");
	  orderList1.print();
printf("> var _MMjoin_44 := join(_MMnilcast_15,orderList1).rename(\"_MMjoin_44\"); \n");
	  var _MMjoin_44 := join(_MMnilcast_15,orderList1).rename("_MMjoin_44");
printf("# Due to the erroneous halign setting, BATkey(_MMnilcast_15,TRUE) is wrongly propagated to _MMjoin_13.\n");
printf("> _MMjoin_44.print();  \n");
	  _MMjoin_44.print(); 
printf("> _MMcastnil_14.print(); \n");
	  _MMcastnil_14.print();
printf("> var _MMreverse_49 := reverse(_MMcastnil_14).rename(\"_MMreverse_49\"); \n");
	  var _MMreverse_49 := reverse(_MMcastnil_14).rename("_MMreverse_49");
printf("# _MMcastnil_14 is correctly marked haligned with _MMjoin_13, hence BATpropcheck\n");
printf("# (correctly) propagates the (wrong) key property from _MMjoin_13 to _MMcastnil_14.\n");
printf("# Finally, BATpropcheck (correctly) detects that _MMcastnil_14 is \"incorrectly marked keyed\".\n");
printf("> _MMreverse_49.print();  \n");
	  _MMreverse_49.print(); 
	  
quit();
