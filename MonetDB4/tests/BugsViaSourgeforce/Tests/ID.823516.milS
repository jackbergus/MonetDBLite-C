module(xtables);

var b := new(oid, int).rename("b");
b.insert(oid(1), 1);
b.insert(oid(2), 2);
b.insert(oid(3), 3);
b.access(BAT_READ);

# Create a view bat
var c := b.select(int(nil), int(nil)).rename("c");

# print(b.info(),c.info());

# save the list of BATs
var pre  := view_bbp_name().copy().rename("pre");

# build a histogram (accellerator) 
# on both the original BAT and the view BAT
b.histogram().print();
c.histogram().print();

# remove both the view BAT and the original BAT
c := 0;
b := 0;

# check which BATs still exist
var post := view_bbp_name().copy().rename("post");

# both the original BAT and the view BAT
# are gone. correct.
kdiff(pre,post).reverse().project(nil).sort().reverse().print();

# the post BAT is new. correct.
# the histogram-accellerator BAT of the view 
# didn't get removed and is still there. Wrong!
kdiff(post,pre).reverse().project(nil).sort().reverse().print();
