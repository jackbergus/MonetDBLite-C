module(unix);
module(ascii_io);
module(enum);

var TSTSRCDIR := getenv("TSTSRCDIR");

var entities := new(void,str).import(TSTSRCDIR+"/empty_enum.SF-1401528.txt").seqbase(0@0);

var enum_entities:=enum_create("enum_entities",entities);

enum_table(enum_entities).print();

encode(enum_entities,"p").print();
# This produces, the expected: [ p ]
decode(enum_entities,encode(enum_entities,"p")).print();

encode(enum_entities,"p0").print();
# This produces, an empty representation,
# as expected (p0 is not in the table): [ ]
decode(enum_entities,encode(enum_entities,"p0")).print();

encode(enum_entities,"p1").print();
# But, this also produces an empty representation,
# while "p1" is in the table: [ ]
decode(enum_entities,encode(enum_entities,"p1")).print();

var codes := new(void,enum_entities,count(entities)).seqbase(0@0);
var values := new(void,str,count(entities)).seqbase(0@0);
entities@batloop() {
	var code := encode(enum_entities,$t);
	codes.append(code);
	values.append(decode(enum_entities,code));
}
print(entities,codes,values);
