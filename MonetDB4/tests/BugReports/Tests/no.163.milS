
# >Number:         163
# >Category:       MIL
# >Synopsis:       multi[lex bug
# >Confidential:   no
# >Severity:       serious
# >Priority:       medium
# >Responsible:    boncz (Peter Boncz)
# >State:          open
# >Class:          sw-bug
# >Submitter-Id:   unknown
# >Arrival-Date:   Mon Jul 20 09:56:02 1998
# >Originator:     manegold@cwi.nl
# >Organization:
# >Release:        980101
# >Environment:
# any
# >Description:
# Tim Ruhl (DDi) reported this bug:
# 
# The following script fails with "GDKmalloc called with size 0".
# (cf. output below)
# 
# -8<-----
# 
# proc tst(BAT[any, int] b) : bat
# {  
#   var i;
# 
#   i := 0;
#   while (i < 2) {
#     b := [+](b, 1);
#     i := i + 1;
#   }
# 
#   return b;
# }
# 
# b1 := new(int, int);
# b1.insert(0, 0);
# b1.insert(0, 1);
# 
# bn := tst(b1);
# bn.print;
# 
# quit;
# 
# -8<-----
# 
# # Monet Database Server V4.0 (IRIX5.3/32bit) of Fri Jul 17 21:30:49 MET DST 1998
# # Copyright (c) 1993-1998, CWI & SION. All rights reserved.
# #script:../tim.mil
# 
# loaded;
# #---------------------------------#
# # module        | usage_count     #
# #---------------------------------#
# [ "kernel",       1               ]
# [ "arith",        1               ]
# [ "bat",          1               ]
# [ "algebra",      1               ]
# [ "sys",          1               ]
# [ "trans",        1               ]
# 
# Try: modules;                - for other modules.
#      ls;                     - for persistent bat listing.
#      sigs("<module>")        - for available commands per module.
#      help("<command>")       - for help one-liner for a command.
# 
# #You are system administrator (adm)!
#  
# proc tst(BAT[any, int] b) : bat
# {
#   var i;
# 
#   i := 0;
#   while (i < 2) {
#     b := [+](b, 1);
#     i := i + 1;
#   }
# 
#   return b;
# }
# 
# b1 := new(int, int);
# b1.insert(0, 0);
# b1.insert(0, 1);
# 
# bn := tst(b1);
# GDKmalloc called with size 0
# 
# -8<-----
# 
# As Tim sais, it has probably to do with rewriting the
# MIL parse tree after the first iteration of the while loop.
# 
# ========
# 
# As I just noticed, similar (the same?) bugs have already been
# reported in bug reports #117 & #156.
# 
#		Stefan

setoid(oid(20000000));

proc tst(BAT[any, int] b) : bat
{  
  var i;

  i := 0;
  while (i < 2) {
    b := [+](b, 1);
    i := i + 1;
  }

  return b;
}

var b1 := new(int, int);
b1.insert(0, 0);
b1.insert(0, 1);

var bn := tst(b1);  
bn.print();

quit();

