# >Number:         147
# >Category:       Module_sys
# >Synopsis:       view_gdk_thread() crashes
# >Confidential:   no
# >Severity:       serious
# >Priority:       medium
# >Responsible:    mk (Martin Kersten)
# >State:          closed
# >Class:          sw-bug
# >Submitter-Id:   unknown
# >Arrival-Date:   Mon Mar  9 16:10:23 1998
# >Originator:     manegold@cwi.nl
# >Organization:
# >Release:        980101
# >Environment:
# SunOS5.6 (GNU=OFF) & SunOS5.5 (GNU=ON)
# >Description:
# ================
# Test script:
# ----------------
# threads();
# view_gdk_thread().print();
# #1
# threadcnt(1);
# threads();
# view_gdk_thread().print();
# #2
# threadcnt(1);
# threads();
# view_gdk_thread().print();
# #3
# threadcnt(1);
# threads();
# view_gdk_thread().print();
# #4
# threadcnt(1);
# threads();
# view_gdk_thread().print();
# #5
# threadcnt(1);
# threads();
# view_gdk_thread().print();
# quit;
# 
# ================
# output
# ----------------
# [...]#You are system administrator (adm)!
# threads();
# #---------------------------------#
# # int   | thread                  #
# #---------------------------------#
# [ 1,      "Server"                ]
# [ 4,      "Interpreter"           ]
# [ 5,      "InternetServer"        ]
# view_gdk_thread().print();
# #---------------------------------#
# # int   | thread                  #
# #---------------------------------#
# [ 1,      "Server"                ]
# [ 4,      "Interpreter"           ]
# [ 5,      "InternetServer"        ]
# #1
# threadcnt(1);
# threads();
# #---------------------------------#
# # int   | thread                  #
# #---------------------------------#
# [ 1,      "Server"                ]
# [ 4,      "Interpreter"           ]
# [ 5,      "InternetServer"        ]
# view_gdk_thread().print();
# #---------------------------------#
# # int   | thread                  #
# #---------------------------------#
# [ 1,      "Server"                ]
# [ 4,      "Interpreter"           ]
# [ 5,      "InternetServer"        ]
# [ 7,      "Interpreter"           ]
# #2
# threadcnt(1);
# !ERROR: thisRequest: could not find itself
# Segmentation Fault (core dumped)
# 
# ================
# Discription:
# ----------------
# The error does not occur deterministically. Sometimes
# it takes more than 2 'threadcnt(1)` calls, until the
# error occurs. Sometimes the error does not occur at all.
# The error may also occur after a single 'threadcnt(x)`
# call with x>1.
# In general, the error occurs less often on SunS5.5 (GNU=ON)
# than on SunOS5.6 (GNU=OFF).
# 
# 	stefan

setoid(oid(2000000));
module(alarm);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#1
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#2
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#3
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#4
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#5
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#6
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#7
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#8
threadcnt(1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#9
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#8
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#7
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#6
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#5
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#4
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#3
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
#2
threadcnt(-1);
sleep(1);
printf("#~BeginVariableOutput~#\n");threads();printf("#~EndVariableOutput~#\n");
printf("#~BeginVariableOutput~#\n");view_gdk_thread().print();printf("#~EndVariableOutput~#\n");
quit();
