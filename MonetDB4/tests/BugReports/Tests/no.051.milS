# >Number:         51
# >Category:       MIL
# >Synopsis:       returns from within a batloop
# >Confidential:   no
# >Severity:       serious
# >Priority:       medium
# >Responsible:    boncz
# >State:          closed
# >Class:          sw-bug
# >Submitter-Id:   unknown
# >Arrival-Date:   Wed Oct 15 13:50:27 1997
# >Originator:     niels
# >Organization:
# >Release:        971007
# >Environment:
# SOLARIS 2.5.1
# >Description:
# When a bat is returned from with a batloop the return value
# is incorrect. 
# proc create(b) : bat {
#         var a := new (oid,flt);
#         b@batloop(){
#                 if (a.count = 0)
#                         return a;
#         }
#         return a;
# }
# 
# b := new (oid,flt);
# b.insert(oid(1),flt(2));
# var c := create(b);
# b.semijoin(c).print;
# #output
# !WARNING: BATdescriptor: range error
# !ERROR: interpret command/proc: 2nd param: invalid BAT.
# [ nil ]

proc create(bat b) : bat {
        var a := new (oid,flt);
        b@batloop(){
                if (a.count() = 0)
                        return a;
        }
        return a;
}

var b := new (oid,flt);
b.insert(oid(1),flt(2));
b.print();
var c := create(b);
b.print();
c.print();
b.semijoin(c).print();

quit();
