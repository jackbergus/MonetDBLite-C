proc genbat(int size, int perc) : bat[void,oid] {
    var b := new(void, oid, size);
    var t := new(void, oid, 100);
    var i := 0;
    while(i < 100) {
        if (i < perc) {
            t.insert(nil,oid(nil));
        } else {
            t.insert(nil,oid(i));
        }
        i :+= 1;
    }
    i := size / 100;
    while((i :-= 1) >= 0) {
	b.insert(t);
    }
    return b.seqbase(0@0);
}

var size := 10000;

while(size <= 1000000) {
    var perc := 0;
    while(perc <= 100) {
	  var m := debugmask();
 	  debugmask(2);
          var b := genbat(size, perc);
          debugmask(m);
          kdiff(b,b.uselect(oid(nil))).count().print(); 
          printf("kdiff(b,b.uselect(oid(nil))) size=%d perc=%d\n", size, perc);
          [ifelse]([isnil](b), b).count().print(); 
          printf("[ifelse]([isnil](b),b) size=%d perc=%d\n", size, perc);
          perc :+= 10;
    }
    size :*= 10;
}

quit();
