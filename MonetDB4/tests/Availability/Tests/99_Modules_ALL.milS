setoid(oid(20000000));

var MODULES:=bat("MODULES");

PROC mmn() : BAT[oid,str] {
	 return(monet_mod_nme.kdiff(monet_mod_nme.[startsWith]("_").uselect(true)));
}

#All_mods:=MODULES.sort().copy();
# # module(Meta);
var All_mods:=MODULES.sort().copy().access(BAT_WRITE).revert();
All_mods@batloop() {
	printf("%9s: ",$h);
	if (not(monet_mod_nme.reverse().exist($h))) {
		printf("loading... ");
		module($h);
		printf("done.\n");
	} else {
		printf("loaded.\n");
	}
}

table(mmn().reverse().sort().reverse().col_name(sprintf("%i modules",mmn().count())));

##Fname:=new(oid,str);Fname.col_name("function");
##FnameS:=new(oid,str);FnameS.col_name("function");
##Ftype:=new(oid,str);Ftype.col_name("type");
##Fmod:=new(oid,str);Fmod.col_name("module");
##FmodS:=new(oid,str);FmodS.col_name("module");
##Fsig:=new(oid,str);Fsig.col_name("signature");
##Fhelp:=new(oid,str);Fhelp.col_name("help");
##Fntms:=new(oid,str);
##Fmnts:=new(oid,str);

##monet_fcntbl@batloop() {
##	Tname:=$h;
##	Ttype:=help_tpe(monet_fcn_tpe.find($t));
##	Tmod:="";
##	if (monet_fcn_mid.exist($t)) {
##		Tmod:=monet_mod_nme.find(monet_fcn_mid.find($t));
##	} else {
##		Tmod:="";
##	}
##	Tsig:=format_fcn_sig($t);
##	Thelp:="";
##	if (monet_fcn_dsc.exist($t)) {
##		Thelp:=monet_fcn_dsc.find($t);
##	} else {
##		Thelp:="not available";
##	}
##	Fname.insert($t,Tname);
##	Ftype.insert($t,Ttype);
##	Fmod.insert($t,Tmod);
##	Fsig.insert($t,Tsig);
##	Fhelp.insert($t,Thelp);
##	Fntms.insert($t,sprintf("%s %s %s %s",Tname,Ttype,Tmod,Tsig));
##	Fmnts.insert($t,sprintf("%s %s %s %s",Tmod,Tname,Ttype,Tsig));
##}

##Fntms.count.print;
##Fntms.reverse.sort.reverse@batloop() {
##	FnameS.insert($h,Fname.find($h));
##}
##FnameS.count.print; table(1,FnameS,Ftype,Fmod,Fsig,Fhelp);

##Fmnts.count.print;
##Fmnts.reverse.sort.reverse@batloop() {
##	FmodS.insert($h,Fmod.find($h));
##}
##FmodS.count.print; table(1,FmodS,Fname,Ftype,Fsig,Fhelp);

quit();
