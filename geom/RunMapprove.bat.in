@echo off

setlocal

set tests=%1
if not "%tests%"=="" goto tests_set
	rem Ask which tests to approve
	echo Which tests do you want to approve?
	echo   "[<dir> ]<tests> | <dirs> | -r | <Enter> for default | -? for help"
	echo   add -f option to force approval of error messages
	set /p tests="Mapprove> "
:tests_set

set prefix=@MONETDB_PREFIX@
set builddir=@XMONETDB_BUILD@
set srcdir=@XMONETDB_SOURCE@

set PATH=%prefix%\src\testing;%prefix%\src\tools;%prefix%\src\mapi\clients\C;%prefix%\src\mapi\clients\python;%PATH%
set PYTHONPATH=%prefix%\src\testing;%srcdir%\src\testing;%prefix%\src\common;%srcdir%\src\mapi\clients\python
set PATH=%prefix%\src\common;%prefix%\src\gdk;%prefix%\src\mapi\clients\C;%prefix%\src\modules\plain\stream;%prefix%\src\monet;%PATH%

REM execute Mapprove.py in the source directory
pushd %srcdir%\src

call python "%prefix%\src\testing\Mapprove.py" "--config=%prefix%\conf\MonetDB.conf" "--TSTSRCBASE=%srcdir%" "--TSTBLDBASE=%builddir%" "--TSTTRGBASE=%builddir%" %tests%

popd
endlocal

:end
