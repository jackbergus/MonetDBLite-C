%define name MonetDB-client
%define version @VERSION@
%define release 1_@LINUX_DIST@.oid@oids@

%define prefix /usr

Name: %{name}
Version: %{version}
Release: %{release}
Summary: MonetDB - Monet Database Management System
Group: System
Source: clients-%{version}.tar.gz
BuildRoot: /var/tmp/%{name}-root
Packager: Niels Nes <Niels.Nes@cwi.nl>
License:   MPL - http://monetdb.cwi.nl/Legal/MonetDBLicense-1.1.html
BuildRequires: python
Requires: MonetDB >= 1.18
#                    ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.

%{!?_with_php: %{!?_without_php: %define _with_php --with-php}}
%{!?_with_python: %{!?_without_python: %define _with_python --with-python}}
%{!?_with_perl: %{!?_without_perl: %define _with_perl --with-perl}}
%{!?_with_java: %{!?_without_java: %define _with_java --with-java}}
%{!?buildsystem: %define buildsystem 0}
%define comp_cc @CC@
%define builddoc 0

# groups of related archs
%define all_x86 i386 i586 i686

%ifarch %{all_x86}
%define bits 32
%else
%define bits 64
%endif

%if !%{?buildsystem}
BuildRequires: MonetDB-devel >= 1.18
#                               ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.
%endif

%package devel
Summary: MonetDB Client development package
Group: System
Requires: %{name} = %{version}-%{release}
Requires: MonetDB-devel >= 1.18
#                          ^^^^
# Maintained via vertoo. Please don't modify by hand!
# Contact MonetDB-developers@lists.sourceforge.net for details and/or assistance.

%package odbc
Summary: MonetDB SQL odbc
Group: System
Requires: %{name} = %{version}-%{release}

%if %{?_with_php:1}%{!?_with_php:0}
%package php
Summary: MonetDB php interface
Group: System
Requires: %{name} = %{version}-%{release}
Requires: php
%define php_extensiondir %(php-config --extension-dir)
%if !%{?buildsystem}
BuildRequires: php, php-devel
%endif
%endif

%if %{?_with_python:1}%{!?_with_python:0}
%package python
Summary: MonetDB python interface
Group: System
Requires: %{name} = %{version}-%{release}
Requires: python = @PYTHON_VERSION@
%define python_libdir %(python -c 'import distutils.sysconfig; print distutils.sysconfig.get_python_lib(1,0,"")')
%if !%{?buildsystem}
BuildRequires: python, python-devel = @PYTHON_VERSION@, swig
%endif
%endif

%if %{?_with_perl:1}%{!?_with_perl:0}
%package perl
Summary: MonetDB perl interface
Group: System
Requires: %{name} = %{version}-%{release}
Requires: perl
%define perl_libdir %(perl -MConfig -e '$x=$Config{installvendorarch}; $x =~ s|$Config{vendorprefix}/||; print $x;')
%if !%{?buildsystem}
BuildRequires: perl, perl-devel, swig
%endif
%endif

%if %{?_with_java:1}%{!?_with_java:0}
%package java
Summary: MonetDB java interface
Group: System
Requires: java
%if !%{?buildsystem}
BuildRequires: ant, java 
%endif
%endif

%description
MonetDB is a database management system that is developed from a
main-memory perspective with use of a fully decomposed storage model,
automatic index management, extensibility of data types and search
accellerators, SQL- and XML- frontends.

%description devel
Add the MonetDB client devel description here

%description odbc
Add the MonetDB SQL odbc description here

%if %{?_with_php:1}%{!?_with_php:0}
%description php
Add the MonetDB php description here
%endif

%if %{?_with_python:1}%{!?_with_python:0}
%description python
Add the MonetDB python description here
%endif

%if %{?_with_perl:1}%{!?_with_perl:0}
%description perl
Add the MonetDB perl description here
%endif

%if %{?_with_java:1}%{!?_with_java:0}
%description java
Add the MonetDB java description here
%endif

%prep
rm -rf $RPM_BUILD_ROOT

%setup -q -n clients-%{version}

%build

./configure \
	--enable-assert=no \
	--enable-optimize \
	--enable-bits=%{bits} \
	CC="%{comp_cc}" \
	--prefix=%{prefix} \
	--libdir=%{_libdir} \
	%{?_with_php} %{?_without_php} \
	%{?_with_python} %{?_without_python} \
	%{?_with_perl} %{?_without_perl} \
	%{?_with_java} %{?_without_java} 

make

%install
rm -rf $RPM_BUILD_ROOT

make install \
	DESTDIR=$RPM_BUILD_ROOT 

find $RPM_BUILD_ROOT -name .incs.in | xargs rm -f

# cleanup stuff we don't want to install
rm -rf $RPM_BUILD_ROOT%{_datadir}/MonetDB/Tests/*
rm -rf $RPM_BUILD_ROOT%{_libdir}/MonetDB/Tests/*
rm -rf $RPM_BUILD_ROOT%{prefix}/bin/monetdb-clients-config.bat
rm -rf $RPM_BUILD_ROOT%{prefix}/bin/mjclient.bat


%clean
rm -fr $RPM_BUILD_ROOT

%files 
%defattr(-,root,root) 
%{prefix}/bin/MapiClient* 
%{prefix}/bin/msqldump* 
%{_libdir}/libMapi.so.*


%files devel
%defattr(-,root,root) 
%{prefix}/bin/monetdb-clients-config
%{_libdir}/libMapi.la
%{_libdir}/libMapi.so
%{prefix}/include/MonetDB/mapilib/Mapi.h

# todo odbc-devel package ?
%files odbc
%defattr(-,root,root) 
%{_libdir}/libMonetODBC.* 
%{_libdir}/libMonetODBCs.* 
%{prefix}/include/MonetDB/odbc/odbcinst.h
%{prefix}/include/MonetDB/odbc/sql.h
%{prefix}/include/MonetDB/odbc/sqlext.h
%{prefix}/include/MonetDB/odbc/sqltypes.h
%{prefix}/include/MonetDB/odbc/sqlucode.h

%if %{?_with_php:1}%{!?_with_php:0}
%files php
%defattr(-,root,root) 
%{php_extensiondir}/*
%{prefix}/share/MonetDB/php/*
%endif

%if %{?_with_python:1}%{!?_with_python:0}
%files python
%defattr(-,root,root) 
%{prefix}/%{python_libdir}/*
%{prefix}/share/MonetDB/python/Mapi.py*
%endif

%if %{?_with_perl:1}%{!?_with_perl:0}
%files perl
%defattr(-,root,root) 
%{prefix}/%{perl_libdir}/*
%{prefix}/share/MonetDB/perl/* 
%endif

%if %{?_with_java:1}%{!?_with_java:0}
%files java
%defattr(-,root,root) 
%{prefix}/bin/mjclient 
%{prefix}/share/MonetDB/lib/*jar
%endif

%changelog
* Mon Jun 25 2007 Sjoerd Mullender <sjoerd@acm.org> - @VERSION@-1
- Built.

