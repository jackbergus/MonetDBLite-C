# "Meta-Makefile[.in]" for buildtools

SRC=@SRC@
BUILD=@BUILD@
PREFIX=@PREFIX@
DESTDIR=

# Run individual "make [all]"s ...
default: all
	@-echo

all:
	cd "$(SRC)"/autogen && python setup.py build \
		--build-base="$(BUILD)"/_autogen
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@

# ... run individual "make install"s ...
install:
	cd "$(SRC)"/autogen && python setup.py install \
		--build-base="$(BUILD)"/_autogen \
		--prefix="$(DESTDIR)$(PREFIX)"
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@
	mkdir -p "$(DESTDIR)$(PREFIX)"/share/MonetDB/conf
	cp "$(SRC)"/conf/conf.bash "$(DESTDIR)$(PREFIX)"/share/MonetDB/conf
	chmod +x "$(DESTDIR)$(PREFIX)"/share/MonetDB/conf/conf.bash
	cp "$(SRC)"/conf/Mbootstrap "$(SRC)"/conf/Mdebootstrap "$(DESTDIR)$(PREFIX)"/bin
	chmod +x "$(DESTDIR)$(PREFIX)"/bin/Mbootstrap "$(DESTDIR)$(PREFIX)"/bin/Mdebootstrap

# ... and individual "make *"s
%:
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@
