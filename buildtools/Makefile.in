# "Meta-Makefile[.in]" for buildtools

SRC=@SRC@
BUILD=@BUILD@
PREFIX=@PREFIX@
DESTDIR=

default: all
	@-echo

# Run individual "make [all]"s ...
all:
	cd "$(BUILD)"/_autogen && python setup.py build
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@

# ... run individual "make install"s ...
install: all
	cd "$(BUILD)"/_autogen && python setup.py $@ \
		--prefix="$(DESTDIR)$(PREFIX)"
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@
	mkdir -p "$(DESTDIR)$(PREFIX)"/share/MonetDB/conf
	cp "$(SRC)"/conf/conf.bash "$(DESTDIR)$(PREFIX)"/share/MonetDB/conf
	chmod +x "$(DESTDIR)$(PREFIX)"/share/MonetDB/conf/conf.bash
	cp "$(SRC)"/conf/Mbootstrap "$(SRC)"/conf/Mdebootstrap "$(DESTDIR)$(PREFIX)"/bin
	chmod +x "$(DESTDIR)$(PREFIX)"/bin/Mbootstrap "$(DESTDIR)$(PREFIX)"/bin/Mdebootstrap

# ... run individual "make uninstall"s ...
uninstall:
	rm -rf "$(DESTDIR)$(PREFIX)"/"`python -c 'import distutils.sysconfig; print distutils.sysconfig.get_python_lib(0,0,"")'`"/autogen \
		"$(DESTDIR)$(PREFIX)"/bin/autogen.py
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@
	rm -f "$(DESTDIR)$(PREFIX)"/share/MonetDB/conf/conf.bash
	rm -f "$(DESTDIR)$(PREFIX)"/bin/Mbootstrap "$(DESTDIR)$(PREFIX)"/bin/Mdebootstrap

# ... run individual "make clean"s ...
clean:
	cd "$(BUILD)"/_autogen && python setup.py $@
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@

# ... and individual "make *"s
%:
	cd _MX && $(MAKE) MAKE=$(MAKE) $@
	cd _MEL && $(MAKE) MAKE=$(MAKE) $@
	cd _BURG && $(MAKE) MAKE=$(MAKE) $@
