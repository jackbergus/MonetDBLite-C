# BUG report:
#
# TCP/IP module causes hangs under Windows
# We have been trying to open a bi-directional connection
# between two MonetDB instances under Windows, however
# the commands from the TCP/IP module cause frequent hangs.
#
# For example, the TCPIP2.* test included with the source
# will hang/block frequently on the "open" command (but
# it works sometimes after you reboot the computer).
# However, the "export" command *always* causes blocking,
# we've never been able to export a variable succesfully.
#
# Has the TCP/IP module been tested under Windows, and is
# it even supported there?
# Will this script work correctly under Linux?
# And note that this problem is not related to the open
# printf bug, because if we remove the printf's then we
# still hang...
#
# I've activated TCP/IP debuging by setting gdk_debug to
# 65536... and the following script *will* cause MonetDB to
# hang on my Windows 2000 PC if you run it multiple times in a
# row (after 2-3 times, typically).
#

module(tcpip);
# 1
fork(listen(23000));
var c:=open("localhost:23000");
var test:=bat(oid,oid);
test.insert(0@0,24@0);
c.export(test,"test");
var test2:=import("test");
close(c);
terminate(23000);
# 2
fork(listen(23000));
var c:=open("localhost:23000");
var test:=bat(oid,oid);
test.insert(0@0,24@0);
c.export(test,"test");
var test2:=import("test");
close(c);
terminate(23000);
# 3
fork(listen(23000));
var c:=open("localhost:23000");
var test:=bat(oid,oid);
test.insert(0@0,24@0);
c.export(test,"test");
var test2:=import("test");
close(c);
terminate(23000);
# 4
fork(listen(23000));
var c:=open("localhost:23000");
var test:=bat(oid,oid);
test.insert(0@0,24@0);
c.export(test,"test");
var test2:=import("test");
close(c);
terminate(23000);

