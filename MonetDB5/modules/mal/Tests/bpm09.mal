# Testing bpm.fold, bpm.new, and bpm.addPartition

function gen(n:sht):bat[:oid,:sht];
	r:=bat.new(:oid,:sht);
	barrier (go,i):=language.newRange(0:sht);
                bat.append(r,i);
                redo (go,i):= language.nextElement(1:sht,n);
        exit (go,i);
	return r;
end gen;

n:=bpm.new(:oid,:sht);

r1:=gen(100:sht);
bpm.addPartition(n,r1);
bpm.dump(n);

r2:=gen(20:sht);
bpm.addPartition(n,r2);
bpm.dump(n);

r3:=gen(300:sht);
bpm.addPartition(n,r3);
bpm.dump(n);

r4:=gen(50:sht);
bpm.addPartition(n,r4);
bpm.dump(n);

g:=bpm.fold(n);
c:=aggr.count(g);
io.print(c);

