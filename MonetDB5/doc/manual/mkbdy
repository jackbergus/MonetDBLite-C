#!/bin/bash

echo "create bdy files"

if [ -z "$1" ] ||  [ -z "$2" ];
then
	echo "usage $0 m5prefix m4prefix" > /dev/stderr
	exit -1
fi

# extract the texi files from the source trees
# leave them behind in a temporary directory

dir=$1
m4dir=$2

mkdir ${dir}/doc/share/tmp
cd ${dir}/src/mal
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
cp *gif *eps *pdf ${dir}/doc/share/tmp

cd ${dir}/src/optimizer
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
cp *gif *eps *pdf ${dir}/doc/share/tmp

cd ${m4dir}/src/gdk
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
cp *gif *eps *pdf ${dir}/doc/share/tmp
cp *pdf ${dir}/doc/share/tmp
cp *feps *pdf ${dir}/doc/share/tmp
sed -i -e "/@t/,/@contents/d" ${dir}/doc/share/tmp/gdk.bdy.texi

cd ${m4dir}/src/mapi/clients/C
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
cp *gif *eps *pdf ${dir}/doc/share/tmp

cd ${dir}/src/modules/mal
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		ex $b.bdy.texi <<!EOF
		/^@example/+1a
@table @code
.
/^@end example/s//@end table/
		g/^command/s//@item
		g/^address/d
		g/^comment "/s///
		g/^comment/s///
		g/";/s///
		/^@example/,/^@end example/d
		/^@example/,/^module/-1d
		/^module/s/.*/ @noindent @code{&}/
		0i
		@page
.
		f
		w!
!EOF
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
cp *gif *eps *pdf ${dir}/doc/share/tmp
cd ${dir}/src/mil
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
cp *gif *eps *pdf ${dir}/doc/share/tmp
cd ${dir}/src/modules/atoms
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
cp *gif *eps *pdf ${dir}/doc/share/tmp
cd ${dir}/src/modules/kernel
for f in  `ls *.mx`
do
	b=`basename $f .mx`
	echo "---->" $f $b.bdy.texi 
        Mx -i -B -H1 $f
		mv $b.bdy.texi  ${dir}/doc/share/tmp
done
