@section The VOC tutorial
Exploring the wealth of functionality offered by MonetDB is best
started using a toy database.  An example of such database is the VOC data
set that provides a peephole view into the administrative
system of a multi-national company, 
the @emph{Vereenigde geoctrooieerde Oostindische
Compagnie} (VOC for short - The (Dutch) East Indian Company).

The VOC was granted a monopoly on the trade in the East Indies on March 20, 1602
by the representatives of the provinces of the Dutch republic.
Attached to this monopoly was the duty to fight the enemies of the Republic and
prevent other European nations to enter the East India trade.
During its history of over 200 years, the VOC became the largest company of its kind,
trading spices like nutmeg, cloves, cinnamon, pepper, and other consumer
products like tea, silk and Chinese porcelain.
Her factories or trade centers were world famous: Desjima in Japan,
Mokha in Yemen, Surat in Persia and of course Batavia,
the Company's headquarters on Java.

The history of the VOC is an active area of research and
a focal point for multi-country heritage projects, 
e.g. @url{http://www.tanap.net/content/voc/organization/organization_intro.htm, TANAP},
which includes a short historic overview of the VOC written by
world expert on the topic F. Gaastra.
The archives of the VOC are spread around the world, but a large
contingent still resides in the @url{ http://www.nationaalarchief.nl/,National Archive},
The Hague.
The archives comprise over 25 million historical records.
Much of which has not (yet) been digitized.

The MonetDB/SQL tutorial is based on the material published in the book
J.R. Bruijn, F.S. Gaastra and I. Schaar, @emph{Dutch-Asiatic Shipping in the 17th
and 18th Centuries}, which gives an account of the trips made to the East
and ships returned safely (or wrecked on the way).  A total of 8000 records
are provided.  They include information about ship name and type, captain,
the arrival/departure of harbors along the route, personnel accounts,
and anecdotal information.

@subsection Acquiring and loading the VOC data set
The VOC data set can be downloaded from
@url{http://monetdb.cwi.nl/Assets/VOC/voc_dump.sql.gz,the MonetDB Assets site}
as a gzipped file with SQL statements.
After the zipfile has been extracted, the file should be loaded into MonetDB
via the @ref{Client Interfaces}.
Alternatively, the URL to the VOC data file can be supplied to the
@code{mjclient} utility, which then directly reads from the URL.

Before you load the VOC data set, it is advised to first add a different user
with its own schema to the MonetDB database.
We illustrate this process using the textual SQL client.
Make sure the MonetDB server has been started, then start the SQL client.
Under Linux you will see something like this:

@example
shell> mjclient --database=voc -umonetdb 
password: ******
Welcome to the MonetDB interactive JDBC terminal!
Database: MonetDB 4.99.19
Driver: MonetDB Native Driver 1.3 (Spur_pre1 20060112)
Type \q to quit, \h for a list of available commands
auto commit mode: on
voc> CREATE USER "voc" WITH PASSWORD 'voc' NAME 'VOC Explorer' SCHEMA "sys";
Operation successful
voc> CREATE SCHEMA "voc" AUTHORIZATION "voc";
Operation successful
voc> ALTER USER "voc" SET SCHEMA "voc";
voc>\q
@end example
In the remainder of the tutorial you can no log onto the server
as user @code{voc}.

The tutorial database can be initialized using either @code{mjclient} and
@code{mclient} as follows, provided the sql-dump file has already been
downloaded:
@example
shell> mjclient --database=voc -uvoc -f voc_dump.sql -Xbatching
password: ***
@end example
Or using a remotely living dump.
@example
shell> mjclient -uvoc -f http://monetdb.cwi.nl/Assets/VOC/voc_dump.sql.gz -Xbatching
password:***
shell>mclient -lsql -uvoc <voc_dump.sql
@end example
The argument @code{Xbatching} instructs the JDBC client to batch instructions
before shipping them to the server. Loading the database takes a few
seconds on a state-of-the-art machine.

@subsection Exploring the VOC data set
The @code{mjclient} contains a @emph{describe} operator, 
denoted by @code{\d} to inspect the
definition of the database schema and its tables.
This functionality is not available in @code{MapiClient}. 
@example
voc-> \d
TABLE   sys.craftsmen
TABLE   sys.impotenten
TABLE   sys.invoices
TABLE   sys.passengers
TABLE   sys.seafarers
TABLE   sys.soldiers
TABLE   sys.total
TABLE   sys.voyages
@end example
The set consists of 8 tables, which are all bound to each other using 
FOREIGN KEY relationships. The voyages table is considered to be the 
main table, which all others reference to. Every table, except invoices 
has a PRIMARY KEY defined over the columns number and number_sup. 
Since the invoices table holds zero or more invoices per voyage 
(identified by number, number_sub) a PRIMARY KEY constraint is 
not possible. Details of the tables are readily available.
@example
voc-> \d sys.soldiers
CREATE TABLE "sys"."soldiers" (
        "number"               int      NOT NULL,
        "number_sup"           char(1)  NOT NULL,
        "trip"                 int ,
        "trip_sup"             char(1),
        "onboard_at_departure" int ,
        "death_at_cape"        int ,
        "left_at_cape"         int ,
        "onboard_at_cape"      int ,
        "death_during_voyage"  int ,
        "onboard_at_arrival"   int ,
        CONSTRAINT "soldiers_number_number_sup_pkey" PRIMARY KEY ("number", "number_sup"),
        CONSTRAINT "soldiers_number_number_sup_fkey" FOREIGN KEY ("number", "number_sup") REFERENCES "sys"."voyages" ("number", "number_sup")
);
voc->
@end example
The tables craftsmen, importenten, passengers, seafarers, and soldiers 
all share the same columns. We can define a VIEW that combines them all 
into one big table, to make them easier to access.
@example
voc-> CREATE VIEW onboard_people AS
voc=> SELECT * FROM (
voc=(    SELECT 'craftsmen' AS type, craftsmen.* FROM craftsmen
voc=(    UNION ALL
voc=(    SELECT 'impotenten' AS type, impotenten.* FROM impotenten
voc=(    UNION ALL
voc=(    SELECT 'passengers' AS type, passengers.* FROM passengers
voc=(    UNION ALL
voc=(    SELECT 'seafarers' AS type, seafarers.* FROM seafarers
voc=(    UNION ALL
voc=(    SELECT 'soldiers' AS type, soldiers.* FROM soldiers
voc=(    UNION ALL
voc=(    SELECT 'total' AS type, total.* FROM total
voc=( ) AS onboard_people_table;
Operation successful
@end example
The new view will show up and we can just use it as a normal table, 
to for instance calculate the number of records for each group of people:
@example
voc-> SELECT type, COUNT(*) AS total FROM onboard_people GROUP BY type ORDER BY type;
+------------+-------+
| type       | total |
+============+=======+
| craftsmen  |  2349 |
| impotenten |   938 |
| passengers |  2813 |
| seafarers  |  4468 |
| soldiers   |  4177 |
| total      |  2454 |
+------------+-------+
6 rows
 
voc-> select count(*) from impotenten;
+--------------+
| count_number |
+==============+
|          938 |
+--------------+
1 row
@end example
It is possible to play with the set in many ways, to find out several 
things that took place during the voyages of the ships, or the money 
that was earned. A few examples are shown below.
@example
voc-> SELECT COUNT(*) FROM voyages WHERE particulars LIKE '%_recked%';
+--------------+
| count_number |
+==============+
|          354 |
+--------------+
1 row
 
voc-> SELECT chamber, CAST(AVG(invoice) AS integer) AS average
voc=> FROM invoices
voc=> WHERE invoice IS NOT NULL
voc=> GROUP BY chamber
voc=> ORDER BY average DESC;
+---------+----------+
| chamber | average  |
+=========+==========+
| A       |  282996 |
| Z       |  259300 |
| H       |  150182 |
| R       |  149628 |
| D       |  149522 |
| E       |  149518 |
| <NULL>  |   83309 |
+---------+----------+
7 rows
 
voc-> CREATE VIEW extended_onboard AS SELECT number, number_sup, trip, trip_sup, onboard_at_departure, death_at_cape, left_at_cape, onboard_at_cape, death_during_voyage, onboard_at_arrival, death_during_voyage - left_at_cape AS death_at_arrival FROM onboard_people;
Operation successful
@end example
@subsection Historical background
Please take the time to experiment with the VOC data. For your convenience,
we give here a short histororical background and interpretation of what
to find in this database.
The introduction given below is an OCR version from the book: J.R. Bruijn, F.S. Gaastra and I. Schaar, Dutch-Asiatic Shipping in the 17th and 18th Centuries

This book presents tables which give a virtually complete survey of the 
direct shipping between the Netherlands and Asia between 1595-1795. 
This period contains, first, the voyages of the so-called Voorcompagnieëand, 
hence, those for and under control of the Vereenigde Oostindische Compagnie 
(VOC). The survey ends in 1795.
That year saw an end of the regular sailings of the VOC between the 
Netherlands and Asia, since, following the Batavian revolution in January, 
the Netherlands became involved in war with England. The last outward voyage 
left on 26 December 1794. After news of the changed situation in the 
Netherlands was received in Asia, the last homeward voyage took place in 
the spring of 1795. The VOC itself was disbanded in 1798.

In total 66 voyages of the voorcompagnieëare listed, one more than the 
traditionally accepted number. The reconnaissance ship, POSTILJON, from the 
fleet of Mahu and De Cordes, that was collected en route is given its 
own number (0022). Since the attempt of the Australische Compagnie to 
circumvent the monopoly of the VOC can be considered as a continuation of 
the voorcompagnieëthe voyage of Schouten and Le Maire is also 
listed (0196-0197).
For the rest, exclusively the outward and homeward voyages of the VOC 
are mentioned in the tables. Of those there were in total 4722 outward and 
3359 homeward. The administration of the company was strictly followed, 
so that, for example, the voyage of Hudson in 1609 (0133) is listed, but 
not that of Roggeveen in 1721-1722.
Voyages of East Indiamen that were driven off course, and arrived for 
instance in Surinam, or those which went no further than the Cape are 
mentioned, as opposed to those of warships of the five Admiralties which, 
from 1783, were sent to Asia to protect the fleets and possessions of the VOC.

The sources of the journeys consist primarily of the archives of the VOC 
in the Algemeen Rijksarchief in The Hague. They are, on the one hand, 
the so-called 'Uitloopboeken' and ship registers, and, on the other, 
the 'Overgekomen Brieven en Papieren' (OBP's). The latter contain the 
regular reports on the arrival and departure of ships in Batavia and other 
Asiatic harbors. In addition, the 'Overgekomen Brieven van de Kaap de 
Goede Hoop' and some other, more dispersed sources must be mentioned.
The data on the voyages of the voorcompagnieëderive above all from 
ources published by the Linschoten Vereeniging.

In volume I, the principal sources are described extensively and the 
origin of the information on each voyage is given. In addition, that 
volume contains an introduction on the organization of the VOC's shipping, 
which also includes an analysis and summary of the data presented in the 
tables. Various other supplementary information, such as the value of the 
export from the Netherlands, only available by year, is also published
there.
The tables follow closely the material presented in the major sources 
('Uitloopboeken' en OBP's). Since these sources are not uniform over a 
period of almost two centuries, the level of completeness of the information 
given for each voyage also varies.

@emph{Homeward voyage}
During the compilation of the tables it became necessary in a few cases to 
add an A to some numbers. This occurred 5 times, in the following places: 
5022, 5980, 5987, 6246 and 6649. Similarly in three cases a number had 
to be left open. The following numbers have not been used: 4605, 5027 and 8215.
The voyage number is followed by a figure which shows whether the ship is 
making its first, second or subsequent voyage. The outward and homeward 
voyages are counted separately. The first voyage from the Netherlands and 
the subsequent homeward voyages are both shown by a `1'. Occasionally a 
ship was built or acquired in Asia. The first outward voyage of such a 
ship is considered as its second voyage.

@emph{Ship's name}
A uniform spelling has been chosen for the numerous variants given in 
the sources. In alphabetical ordering and in the index, the most relevant 
word was chosen. Thus the WAPEN VAN, HOORN (0243) is given under HOORN, 
the HOF NIET ALTIJD ZOMER (2380) under ZOMER and the VROUWE REBECCA 
JACOBA (3668) under REBECCA. It should be noted that especially in the 
seventeenth century ships' names were frequently provided with additions 
which were not used in a consistent fashion. The AMSTERDAM (0431) was 
sometimes called NIEUWAMSTERDAM, the WITTE OLIFANT (0533), the OLIFANT. 
The most frequent name is given in the tables. In the eighteenth century, 
especially, ships' names were frequently changed, or they used each 
other's names. This is always mentioned under the heading Particulars and 
in the index.

@emph{Master's name}
Similarly, a uniform spelling has been chosen for the name of the master, 
generally schipper, but in the eighteenth century also a kapitein or 
kapiteinluitenant. The index is arranged by surname or patronymic.

@emph{Tonnage}
The volume of the ships is given in metric tons. The sources give the 
figures in lasten (1 last = 2 tons). After 1636, however, information in 
lasten is no longer of any value, as, for fiscal reasons, the VOC's 
figures were kept artificially low. From then on the volume has been 
calculated on the basis of the measurements of the ships, according to 
a simple formula (volume in lasten = length x breadth x depth in 
Amsterdam feet, divided by 200; 1 ft. = 28,3 cm). The results of this 
calculation have been doubled and are given in the tables. This method and 
the problems regarding the assessment of the ships' volume is described 
in Volume I. In a number of cases where inconsistent information was found, 
both calculations are given, thus e.g. 600/850.

@emph{Type of ship}
Occasionally, in those cases where this is mentioned in the sources, 
the type of the ship is given in the same column as the tonnage. 
In general, the most frequent type of ship, the retourschip (East Indiaman) 
is not mentioned in the sources. Therefore, where the type of ship is not 
mentioned, it may often be assumed that an East Indiaman is meant. 
The various other types - hoeker, kat, pinas, jacht, fluit, paketboot - 
are given in Dutch.

@emph{Built}
The year given in this column refers to the year in which the ship was built.
If the ship was hired or bought by the VOC, then this is mentioned in the
column, together with the year in which the transaction occurred.

@emph{Yard}
The place is given where the ship was built. The chambers of the VOC had 
their own yard. 'A' refers to Amsterdam, 'Z' to Zeeland, 'D' to Delft, 
'R' to Rotterdam, 'H' to Hoorn, and 'E' to Enkhuizen. 
When a ship was hired or bought by the VOC, the letter indicates the 
chamber that was responsible for the transaction.
The ships of the voorcompagnieëdid not belong to a chamber. In these cases, 
A' indicates that a ship was built at an Amsterdam yard. The chambers also 
had no part in the buying or building of ships by the Hoge Regering in 
Batavia. In these cases the place of building or purchase in Asia is given.

@emph{Chamber}
With the outward voyages, this column gives the chamber which equipped the 
ship; with the homeward, the chamber to which the ship was addressed. 
There is no entry in this column for ships organized by the voorcompagnieë

@emph{Departure}

Under this heading is given the date and place of departure from Europe, 
Asia or the Cape of Good Hope. A date like 03-02-1645 refers to 3 February 1645.
Where sailings from the Republic are concerned, the date given refers to 
the departure from the roads. Amsterdam, Hoorn and Enkhuizen ships generally 
left from Texel roads, Zeeland ships from the Wielingen or the roads of 
Rammekens, and Rotterdam and Delft ships from Goeree. Sometimes, ships were 
forced by storms or damage to return to the roads for a time or they sought 
shelter in one of the estuaries on the coast of Holland or Zeeland. Where 
possible, this is mentioned under the heading Particulars. In general the 
first date of departure is given in the tables, but in some cases, a later 
date has been chosen, in deference to the sources.

As for leaving Batavia, departure from the roads of the town was decisive, 
and not, as is frequently described in the Company papers, the reaching of 
the `open sea' after passing the Sunda Strait. Where departures from other 
Asian ports are concerned in general only the Company establishment from which 
the ship sailed is given. Thus Ceylon is mentioned in the columns, but it 
can be assumed that most ships left from the Bay of Galle, at the southern 
point of the island. China is given for ships which left from Canton, and 
the date refers to departure from the roads at Whampoa. Bengal is given for 
ships which left from the anchorage in the Ganges close to the 
VOC-establishment at Hughly.

@emph{Call at Cape}
The data in this column give the arrival at (above) and the departure (below)
from the Cape of Good Hope. In general no distinction is made between Table 
Bay and False Bay. Mention is made, when given in the sources, of ships 
which put in to the more northerly Saldanha and St. Helena Bays. When a 
ship sailed past the Cape, this is denoted by `no call'. When it is not 
known whether the ship stopped at the Cape at all - especially frequent 
before the foundation of the refreshment station there in 1652 - the column 
is left blank.

@emph{Arrival}
The third column contains the date and place of arrival in Asia, Europe or, 
when that was the destination of the journey, at the Cape of Good Hope.
The place of arrival is given in the same manner as that of departure, though, 
in addition to the estuaries mentioned above, ships sometimes arrived in the 
Netherlands via the Vlie or at Delfzijl. The place of arrival in Asia 
refers to the establishment reached, unless the sources specify the actual 
port.

@emph{On board}
It is possible to differentiate the number of those on board into various 
categories. For the outward journey, these are seafarers, soldiers, craftsmen, 
and passengers. The craftsmen are those who were employed to perform some 
particular service in Asia, and are thus not part of the crew as such.
'Passengers' is in fact a residual category, including high officials of 
the Company, including ministers of religion with their wives and servants,
but also slaves and stowaways. Whenever such a differentiation is not possible,
which is especially the case in the early years, a figure for the total is 
given. Italics are used for this, or when the figures refer to more than one 
category. Only those categories are mentioned which were on board. 
Therefore, when one category is mentioned, this implies that the others 
were not represented on board.

The sources for the return voyages are of a different kind and normally far 
less complete. They are totally absent for the journey between the Cape and 
the Netherlands. However, another category must be mentioned, namely the 
impotenten, who for various reasons were released from active service for 
the VOC and sent back to Europe. With regard to many voyages the sources 
only give the number of passengers and impotenten, and not the number of 
sailors and soldiers. Obviously, the absence of figures under these headings 
does not imply that there were none on board.

Information on the outward voyages is divided into six columns:
@enumerate
@item onboard_at_departure 	
The number on board at departure
@item death_at_cape 	
The number dying between the Netherlands and the Cape. Frequently this figure refers to all the categories together, even when the other information is available per category. In such cases this figure is printed in italics.
@item left_at_cape 	
The number who leave the ship at the Cape.
@item onboard_at_cape 	
The number who come on board at the Cape.
@item death_during_voyage 	
The number dying on the whole voyage. Subtraction of III from V gives the number dying between the Cape and Asia.
@item onboard_at_arrival 	
The number on board on arrival in Asia.
@end enumerate

Three columns are given for the homeward voyages:
@enumerate
@item onboard_at_departure 	
The number on board at departure
@item death_at_cape 	
The number dying en route to the Cape
@item left_at_cape 	
The number who went from board at the Cape
@end enumerate
The figures in the various columns are taken from different sources which are 
not always consistent with each other. Therefore the figures on changes in 
the number of those on board during the voyages do not always tally with 
those on the size of the crew at departure and arrival.

@emph{Invoice value}
For the return voyages, the total value of the ship's cargo, according to the 
invoice made up in Batavia or some other establishment, is given, as is the 
chamber for which the cargo was destined. Generally, this was for the chamber 
under whose jurisdiction the ship sailed, but occasionally a proportion of 
the cargo was for one or more of the other chambers.

@emph{Particulars}
Under the last heading details deriving from the basic sources are given.
They are generally incidental and as such not to be placed in one of the 
preceding columns. Because the sources are not the same across the whole 
period, and at times less complete, the extent and sort of material under 
this heading could not be consistent.

In so far as it is available, information deals with the ports of call on 
the journey, with the details of changes in the composition of the crew 
and with the eventual fate of the ship. For the return voyage, the name of 
the fleet-commander is generally given, and, after his name, the number of 
the ship he was on. Finally, where necessary, differences in data between 
various sources are indicated. Occasionally, particulars from a published 
source are added.

@emph{Corresponding number}
This number, placed at the far right of the tables, denotes the next 
homeward voyage of the ship in volume II (naturally absent when the ship 
remains in Asia), or, in volume III, for homeward voyages, the number of 
the ship's previous outward voyage. In those cases where the ship was 
acquired in Asia, no corresponding number is given for the first homeward 
voyage from Asia.

Due to the long duration of the preparation of these two volumes there 
are some inconsistencies in the text of the particulars and in the use 
of language. 
