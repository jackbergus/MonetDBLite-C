<html lang="en">
<head>
<title>Flow of control - Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="MonetDB-Assembler-Language.html#MonetDB-Assembler-Language" title="MonetDB Assembler Language">
<link rel="prev" href="MAL-instructions.html#MAL-instructions" title="MAL instructions">
<link rel="next" href="Function-definitions.html#Function-definitions" title="Function definitions">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This file documents the MonetDB Version 5.0 Reference Manual

Last updated: April 27, 2006

     Copyright (C) 2000-2006 CWI

     Permission is granted to make and distribute verbatim
     copies of this manual provided the copyright notice and
     this permission notice are preserved on all copies.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body { 
    margin: 0px;
    padding: 0px;
}
a,a:visited {
	color: #336633;
}
a:hover {
	color: #003300;
}

p,body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    text-align: justify;
    font-size: 10pt;
}

h1 {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 14pt;
    font-style: bold;
	text-align: left;
}

td,th {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10pt;
}

div.banner {
	padding: 5px 0px 0px 5px; 
}

div.banner img {
	border: 0px;
	text-decoration: none;
}

div.topmenu {
	margin-top: -20px;
	margin-left: 166px;
	padding: 8px 5px 5px 5px;
	font-size: 8pt;
	background-color: #A9CC99;
}

div.topmenu-bottom {
	margin-top: -4px;
	margin-left: 166px;
	padding: 2px 5px;
	background-color: #BCD2ED; 
}

div.topmenu a {
	padding: 4px 5px 1px 5px;
	text-decoration: none; 
}

div.topmenu a:focus {
	background-color: #6699CC; 
}

div.topmenu a:hover {
	background-color: #5662A0; 
}

/*
span.current {
}
*/

div.topmenu span.current a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.current a:hover {
	color: #336633;
	background-color: #BCD2ED; 
}

/*
span.submenu {
}
*/

div.topmenu span.submenu a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.submenu a:hover {
	background-color: #9FB0DB; 
}

div.topmenu span.button {
	margin: 0px 0px 0px 10px;
}

div.topmenu span.button a {
	padding: 5px 6px 1px 6px;
	color: #333333;
	background-color: #FFAC37;
}

div.topmenu span.button a:hover {
	color: #FFFFFF;
}

div.content {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}

div.header {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}


div.sidebar-a {
	float: left;
	width: 156px;
	padding: 5px;
	font-size: 8pt;
}

div.sidebar-b { 
	float: right;
	width: 146px;
	margin: 0px 0px 0px 5px;
	padding: 5px;
	font-size: 8pt;
}

div.footer-a {
	float: left;
	width: 156px;
	margin: 5px 0px 0px 0px;
	padding: 5px;
	font-size: 7pt;
	background-color: #CBEEBB;
}

div.footer-a a {
	margin: 5px;
	text-decoration: none; 
}

div.footer-b {
	margin: 5px 0px 0px 0px;
	padding: 5px;
	background-color: #A9CC99;
	font-size: 7pt;
}

div.footer-b a {
	margin: 5px;
	padding: 2px 3px;
	text-decoration: none; 
}
div.footer-b a:focus {
	background-color: #6699CC; 
}
div.footer-b a:hover {
	color: #FFFFFF;
	background-color: #5662A0; 
}
div.footer-b img {
	border: 0px;
	vertical-align: bottom;
	text-decoration: none; 
}

div.news {
	border: 1px solid #666699;
	background-color: #E7E7E7; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.news li {
	list-style: square;
}

div.submenu-b {
	border: 1px solid #666699;
	background-color: #CBEEBB;
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu-b a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	color: #000000;
	background-color: #A9CC99;
}

div.submenu-b a:hover {
	background-color: #BCD2ED; 
}

div.submenu-b ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu-b li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu {
	border: 1px solid #666699;
	background-color: #9FB0DB; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	_width: 100%;
}

div.submenu ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu span.submenu a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.submenu a:hover {
	background-color: #A9CC99;
}

div.submenu span.current a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.current a:hover {
	background-color: #CBEEBB;
}

pre.code {
	border: 1px solid Black;
	padding: 4px;
	font-family: monospace;
}
.authors {
	font-size: smaller;
	font-style: italic;
}
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Flow-of-control"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Function-definitions.html#Function-definitions">Function definitions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="MAL-instructions.html#MAL-instructions">MAL instructions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="MonetDB-Assembler-Language.html#MonetDB-Assembler-Language">MonetDB Assembler Language</a>
<hr>
</div>

<h3 class="section">7.2 Flow of control</h3>

<p>The flow of control within a MAL program block can be changed by
tagging an assignment with either <code>return</code>, <code>yield</code>,
<code>barrier</code>, <code>catch</code>, <code>leave</code>, <code>redo</code>, or <code>exit</code>.

   <p>The flow modifiers <code>return</code> and <code>yield</code> mark the end
of a call and return one or more results to the calling environment. 
The <code>return</code> and <code>yield</code> are followed by a target list
or an assignment, which is executed first.

   <p>The <code>barrier</code> (<code>catch</code>) and <code>exit</code> pair mark a
guarded statement block. They may be nested to form a proper
hierarchy identified by their target variables.

   <p>The <code>leave</code> and <code>redo</code> are conditional flow modifiers. 
Their first target variable is also denoted as the control variable. 
It is used after  the assignment statement has been evaluated to decide
on the flow-of-control action to be taken. 
Built-in controls exists for booleans and numeric values. 
The barrier block is opened when the control variable holds
true, when its numeric value &gt;= 0, or when it is a non-empty
string. The <code>nil</code> value blocks entry in all cases.

   <p>Once inside the barrier you have an option to prematurely
<code>leave</code> it at the exit statement
or to <code>redo</code> interpretation just after the corresponding
barrier statement. Much like 'break' and 'continue' statements
in the programming language C. 
The action is taken when the condition is met.

   <p>The <code>exit</code> marks the exit for a block. Its optional assignment
can be used to re-initialize the barrier control variables
or wrap-up any related administration.

   <p>A control block is recognized by its target variable set,
which implies that nesting on the same target set is prohibited.

   <p>The barrier blocks can be properly nested to form
a hierarchy of basic blocks. 
The control flow within and between blocks is
simple enough to deal with during an optimizer stage. 
The <code>redo</code> and <code>leave</code> statements mark
the partial end of a block. Statements within these
blocks can be re-arranged according to the data-flow
dependencies. The order of partial blocks can not
be changed that easily. It depends on the mutual
exclusion of the data flows within each partial block.

   <p>Common guarded blocks in imperative languages are
the for-loop and if-then-else constructs. 
They can be simulated as follows.

   <p>Consider the statement <code>for(i=1;i&lt;10;i++) print(i)</code>. 
The (optimized) MAL block to implement this becomes:
<pre class="example">          i:= 1;
     barrier B:= i&lt;10;
          print(i);
          i:= i+1;
     redo B:= i&lt;10;
     exit B;
</pre>
   <p>Translation of the statement <code>if(i&lt;1) print("ok"); else print("wrong");</code>
becomes:
<pre class="example">         i:=1;
     barrier ifpart:= i&lt;1;
         print("ok");
     exit ifpart;
     barrier elsepart:= i&gt;=1;
         print("wrong");
     exit elsepart;
</pre>
   <p>Note that both guarded blocks can be interchanged without
affecting the outcome. Moreover, neither block would
have been entered if the variable happens to be assigned <code>nil</code>.

   <p>The primitives are sufficient to model a wide variety of iterators,
whose pattern look like:
<pre class="example">     barrier i:= newIterator(T);
         elm:= getElement(T,i);
         ...
         leave i:= noMoreElements(T);
         ...
         redo i:= hasMoreElements(T);
     exit i:= exitIterator(T);
</pre>
   <p>The semantics obeyed by the iterator implementations is as follows. 
The redo expression updates the target variable <em> i</em> and control
proceeds at the first statement after the barrier when the
barrier is opened by <em> i</em>. If the barrier could not be
re-opened, execution proceeds with the first statement after
the redo. 
Likewise, the leave control statement skips to the exit
when the control variable <em> i</em> shows a closed barrier block. 
Otherwise, it continues with the next instruction. 
Note, in both failed cases the control variable is
possibly changed.

   <p>A recurring situation is to iterate over the elements in
a BAT. This is supported by an iterator implementation in
the bbp module as follows:
<pre class="example">     barrier (idx,hd,tl):= newIterator(B);
         ...
         redo (idx,hd,tl):= hasMoreElements(B);
     exit i;
</pre>
   <p>Where idx is an integer to denote the row in the BAT,
hd and tl denote values of the current element. 
This scheme is more efficient
<pre class="example"></pre>
   </body></html>

