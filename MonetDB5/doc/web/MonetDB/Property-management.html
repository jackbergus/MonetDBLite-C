<html lang="en">
<head>
<title>Property management - Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="MonetDB-Assembler-Language.html#MonetDB-Assembler-Language" title="MonetDB Assembler Language">
<link rel="prev" href="Boxed-variables.html#Boxed-variables" title="Boxed variables">
<link rel="next" href="MAL-Modules.html#MAL-Modules" title="MAL Modules">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This file documents the MonetDB Version 5.0 Reference Manual

Last updated: April 27, 2006

     Copyright (C) 2000-2006 CWI

     Permission is granted to make and distribute verbatim
     copies of this manual provided the copyright notice and
     this permission notice are preserved on all copies.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body { 
    margin: 0px;
    padding: 0px;
}
a,a:visited {
	color: #336633;
}
a:hover {
	color: #003300;
}

p,body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    text-align: justify;
    font-size: 10pt;
}

h1 {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 14pt;
    font-style: bold;
	text-align: left;
}

td,th {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10pt;
}

div.banner {
	padding: 5px 0px 0px 5px; 
}

div.banner img {
	border: 0px;
	text-decoration: none;
}

div.topmenu {
	margin-top: -20px;
	margin-left: 166px;
	padding: 8px 5px 5px 5px;
	font-size: 8pt;
	background-color: #A9CC99;
}

div.topmenu-bottom {
	margin-top: -4px;
	margin-left: 166px;
	padding: 2px 5px;
	background-color: #BCD2ED; 
}

div.topmenu a {
	padding: 4px 5px 1px 5px;
	text-decoration: none; 
}

div.topmenu a:focus {
	background-color: #6699CC; 
}

div.topmenu a:hover {
	background-color: #5662A0; 
}

/*
span.current {
}
*/

div.topmenu span.current a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.current a:hover {
	color: #336633;
	background-color: #BCD2ED; 
}

/*
span.submenu {
}
*/

div.topmenu span.submenu a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.submenu a:hover {
	background-color: #9FB0DB; 
}

div.topmenu span.button {
	margin: 0px 0px 0px 10px;
}

div.topmenu span.button a {
	padding: 5px 6px 1px 6px;
	color: #333333;
	background-color: #FFAC37;
}

div.topmenu span.button a:hover {
	color: #FFFFFF;
}

div.content {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}

div.header {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}


div.sidebar-a {
	float: left;
	width: 156px;
	padding: 5px;
	font-size: 8pt;
}

div.sidebar-b { 
	float: right;
	width: 146px;
	margin: 0px 0px 0px 5px;
	padding: 5px;
	font-size: 8pt;
}

div.footer-a {
	float: left;
	width: 156px;
	margin: 5px 0px 0px 0px;
	padding: 5px;
	font-size: 7pt;
	background-color: #CBEEBB;
}

div.footer-a a {
	margin: 5px;
	text-decoration: none; 
}

div.footer-b {
	margin: 5px 0px 0px 0px;
	padding: 5px;
	background-color: #A9CC99;
	font-size: 7pt;
}

div.footer-b a {
	margin: 5px;
	padding: 2px 3px;
	text-decoration: none; 
}
div.footer-b a:focus {
	background-color: #6699CC; 
}
div.footer-b a:hover {
	color: #FFFFFF;
	background-color: #5662A0; 
}
div.footer-b img {
	border: 0px;
	vertical-align: bottom;
	text-decoration: none; 
}

div.news {
	border: 1px solid #666699;
	background-color: #E7E7E7; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.news li {
	list-style: square;
}

div.submenu-b {
	border: 1px solid #666699;
	background-color: #CBEEBB;
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu-b a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	color: #000000;
	background-color: #A9CC99;
}

div.submenu-b a:hover {
	background-color: #BCD2ED; 
}

div.submenu-b ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu-b li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu {
	border: 1px solid #666699;
	background-color: #9FB0DB; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	_width: 100%;
}

div.submenu ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu span.submenu a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.submenu a:hover {
	background-color: #A9CC99;
}

div.submenu span.current a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.current a:hover {
	background-color: #CBEEBB;
}

pre.code {
	border: 1px solid Black;
	padding: 4px;
	font-family: monospace;
}
.authors {
	font-size: smaller;
	font-style: italic;
}
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Property-management"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="MAL-Modules.html#MAL-Modules">MAL Modules</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Boxed-variables.html#Boxed-variables">Boxed variables</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="MonetDB-Assembler-Language.html#MonetDB-Assembler-Language">MonetDB Assembler Language</a>
<hr>
</div>

<h2 class="chapter">10 Property Management</h2>

<p>Properties come in several classes, those linked with the symbol table and
those linked with the runtime environment. The former are determined
once upon parsing or catalogue lookup. The runtime properties have two
major subclasses, i.e. reflective and prescriptive. The reflective properties
merely provide a fast cache to information aggregated from the target. 
Prescriptive properties communicate desirable states, leaving it to other
system components to reach this state at the cheapest cost possible. 
This multifacetted world makes it difficult to come up with a concise model
for dealing with properties. The approach taken here is an experimental step
into this direction.

   <p>This <code>mal_properties</code> module
provides a generic scheme to administer property sets and
a concise API to manage them. 
Its design is geared towards support of MAL optimizers, which
typically make multiple passes over a program to derive an
alternative, better version. Such code-transformations are
aided by keeping track of derived information, e.g. the expected
size of a temporary result or the alignment property between BATs.

   <p>Properties capture part of the state of the system in the form of an
simple term expression <code>(name, operator, constant)</code>. 
The property model assumes a namespace built around Identifiers. 
The operator satisfy the syntax rules for MAL operators. 
Conditional operators are quite common, e.g. the triple (count, &lt;, 1000)
can be used to denote a small table.

<h3 class="section">10.1 Property Associations</h3>

<p>The property bearing objects in the MAL setting are
variables (symbol table entries) and MAL function blocks. 
The direct relationship between instructions and
a target variable, make it possible to keep the instruction properties
in the corresponding target variable.

   <p><em>Variables properties.</em>
The variables can be extended at any time with a property set. 
Properties have a scope identical to the scope of the corresponding variable. 
Ommision of the operator and value turns it into a boolean valued property,
whose default value is <code>true</code>.
<pre class="verbatim">
	b{count=1000,sorted}:= mymodule.action("table");
	name{aligngroup=312} := bbp.take("person_name");
	age{aligngroup=312} := bbp.take("person_age");
</pre>
The example illustrates a mechanism to maintain alignment information. 
Such a property is helpful for optimizers to pick an efficient algorithm.

   <p><em>MAL function signatures.</em>
A function signature contains a description of
the objects it is willing to accept and an indication of the
expected result. The arguments can be tagged with properties
that 'should be obeyed, or implied' by the actual arguments. 
It extends the typing scheme used during compilation/optimization. 
Likewise, the return values can be tagged with properties that 'at least'
exist upon function return.
<pre class="verbatim">
    function test(b:bat[:void,:int]{count&lt;1000}):bat[:void,:int]{sorted}
       #code block
    end test
</pre>

   <p>These properties are informative to optimizers. 
They can be enforced at runtime using the operation
<code>optimizer.enforceRules()</code> which injects calls into
the program to check them. 
An assertion error is raised if the property does not hold. 
The code snippet
<pre class="verbatim">
	z:= user.test(b);
</pre>
is translated into the following code block;
<pre class="verbatim">
	mal.assert(b,"count","&lt;",1000);
	z:= user.test(b);
	mal.assert(z,"sorted");
</pre>

   <p><em>MAL instructions.</em> Properties associated with an instruction are aimed
at the a tactical optimizer and execution engine. It says something about
the context in which the instruction should take place, e.g. a timeout
property.

   <p>The second layer involves tagging structures known to front-ends, such as
SQL and XML. Given that they produce a MAL block, setting properties
becomes an explicit action. This can be handled as a first step in the
optimization phase, which 'executes' all property setting actions first. 
However, 'preferred' properties may have to be dealt with later. For example,
an operation should produce a sorted BAT. This calls for a runtime test and
possible coercion. Alternatively, the desired property leads to a different
selection of an operator implementation.

   <p><em>How to propagate properties?</em>
Property inspection and manipulation is strongly linked with the operators
of interest. Optimizers continuously inspect and update the properties, while
kernel operators should not be bothered with their existence.
<pre class="example"></pre>
   </body></html>

