@section Web Services
@subsection Apache Configuration
Here are the instructions to make @code{.xq} files directly executable from 
the @url{http://www.apache.org,Apache web server}.

@strong{Note}: The code provided below is still in an 
experimental stage and is not intended to be used in a production 
environment.

@subsection httpd.conf

First you must adapt the @code{httpd.conf} configuration file of the Apache 
web server, in order to:

@itemize @bullet
  @item turn on cgi scripts (if not already the case)
  @item add a "handler" for @code{.xq} files:
@end itemize

To do so, I made the following changes:

@verbatim
$ diff -w httpd.conf httpd.conf.default
 858c858
 >     AddHandler cgi-script .cgi
 ---
 >    #AddHandler cgi-script .cgi
 885,890d884
 < # redirect xquery files to our cgi script
 < AddType    text/xml .xq
 < AddHandler xquery-type .xq
 < Action xquery-type /cgi-bin/xquery.cgi
@end verbatim

Don't forget to restart Apache; so it reads @code{httpd.conf}

@subsection xquery.cgi

In the @code{cgi-bin/} directory, you must also place the following 
script (@url{../../files/xquery.cgi,@code{xquery.cgi}}) with executable file permissions:

@verbatim
chmod 755 xquery.cgi
@end verbatim

Beware! You must potentially adapt:
@itemize @bullet
 @item the location of bash
 @item @code{WWWDIR} (the @code{htdocs} directory where Apache stores its 
  content)
 @item @code{MONETDIR} (the installation dir of MonetDB/XQuery)
@end itemize

@verbatim
 #!/bin/bash
 echo 'Content-type: text/xml'
 echo 

 MONETDIR=/path_to_monetdb/
 WWWDIR=/var/www/htdocs

 XQFILE=$WWWDIR/$REDIRECT_URL

 if [ x$QUERY_STRING == x ]
 then
   $MONETDIR/bin/MapiClient --set prefix=$MONETDIR --set exec_prefix=$MONETDIR -sxml -lx $XQFILE
 else
    `echo "sed -e s/%$QUERY_STRING/g $XQFILE" | sed -e "s/&amp;/\/g -e s\/%/g" -e "s/=/%\//g"` &gt; /tmp/$$
   $MONETDIR/bin/MapiClient --set prefix=$MONETDIR --set exec_prefix=$MONETDIR -sxml -lx /tmp/$$
 fi
@end verbatim

@subsection passing parameters
The @code{xquery.cgi} script allows parameter passing.
Suppose we have the following XQuery file (save it as 
@url{../../../../files/cgi_example.xq,@code{example.xq}} 
in the @code{htdocs}-folder):
@verbatim
 for $i in 1 to %max%
 return element { "mult" } {
   $i, " times ", %table%, " is ", $i * %table%
 } 
@end verbatim

The @code{table} and @code{max} have been parametrized. 
Parameters take the form: @code{ %name% }

The parameters can be used in the usual URL convention:
@verbatim
@url{http://localhost/example.xq?table=3&max=10,
http://localhost/example.xq?table=3&max=10}
@end verbatim

@strong{Beware}: parameter substitution in this script is @strong{very simple}; it won't 
work with special characters in it (that get escaped by the web server) or even spaces. For optimal web 
server performance, we may want to do all parameter substitution inside MapiClient; so that we don't need 
to fork a bash shell process on each web request.

