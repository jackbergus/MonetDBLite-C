<html lang="en">
<head>
<title>Query Optimizer Framework - Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Optimizer-landscape.html#Optimizer-landscape" title="Optimizer landscape">
<link rel="prev" href="Optimizer-Building-Blocks.html#Optimizer-Building-Blocks" title="Optimizer Building Blocks">
<link rel="next" href="Optimizer-toolkit.html#Optimizer-toolkit" title="Optimizer toolkit">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This file documents the MonetDB Version 5.0 Reference Manual

Last updated: June 5, 2006

     Copyright (C) 2000-2006 CWI

     Permission is granted to make and distribute verbatim
     copies of this manual provided the copyright notice and
     this permission notice are preserved on all copies.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body { 
    margin: 0px;
    padding: 0px;
}
a,a:visited {
	color: #336633;
}
a:hover {
	color: #003300;
}

p,body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    text-align: justify;
    font-size: 10pt;
}

h1 {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 14pt;
    font-style: bold;
	text-align: left;
}

td,th {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10pt;
}

div.banner {
	padding: 5px 0px 0px 5px; 
}

div.banner img {
	border: 0px;
	text-decoration: none;
}

div.topmenu {
	margin-top: -20px;
	margin-left: 166px;
	padding: 8px 5px 5px 5px;
	font-size: 8pt;
	background-color: #A9CC99;
}

div.topmenu-bottom {
	margin-top: -4px;
	margin-left: 166px;
	padding: 2px 5px;
	background-color: #BCD2ED; 
}

div.topmenu a {
	padding: 4px 5px 1px 5px;
	text-decoration: none; 
}

div.topmenu a:focus {
	background-color: #6699CC; 
}

div.topmenu a:hover {
	background-color: #5662A0; 
}

/*
span.current {
}
*/

div.topmenu span.current a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.current a:hover {
	color: #336633;
	background-color: #BCD2ED; 
}

/*
span.submenu {
}
*/

div.topmenu span.submenu a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.submenu a:hover {
	background-color: #9FB0DB; 
}

div.topmenu span.button {
	margin: 0px 0px 0px 10px;
}

div.topmenu span.button a {
	padding: 5px 6px 1px 6px;
	color: #333333;
	background-color: #FFAC37;
}

div.topmenu span.button a:hover {
	color: #FFFFFF;
}

div.content {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}

div.header {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}


div.sidebar-a {
	float: left;
	width: 156px;
	padding: 5px;
	font-size: 8pt;
}

div.sidebar-b { 
	float: right;
	width: 146px;
	margin: 0px 0px 0px 5px;
	padding: 5px;
	font-size: 8pt;
}

div.footer-a {
	float: left;
	width: 156px;
	margin: 5px 0px 0px 0px;
	padding: 5px;
	font-size: 7pt;
	background-color: #CBEEBB;
}

div.footer-a a {
	margin: 5px;
	text-decoration: none; 
}

div.footer-b {
	margin: 5px 0px 0px 0px;
	padding: 5px;
	background-color: #A9CC99;
	font-size: 7pt;
}

div.footer-b a {
	margin: 5px;
	padding: 2px 3px;
	text-decoration: none; 
}
div.footer-b a:focus {
	background-color: #6699CC; 
}
div.footer-b a:hover {
	color: #FFFFFF;
	background-color: #5662A0; 
}
div.footer-b img {
	border: 0px;
	vertical-align: bottom;
	text-decoration: none; 
}

div.news {
	border: 1px solid #666699;
	background-color: #E7E7E7; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.news li {
	list-style: square;
}

div.submenu-b {
	border: 1px solid #666699;
	background-color: #CBEEBB;
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu-b a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	color: #000000;
	background-color: #A9CC99;
}

div.submenu-b a:hover {
	background-color: #BCD2ED; 
}

div.submenu-b ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu-b li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu {
	border: 1px solid #666699;
	background-color: #9FB0DB; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	_width: 100%;
}

div.submenu ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu span.submenu a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.submenu a:hover {
	background-color: #A9CC99;
}

div.submenu span.current a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.current a:hover {
	background-color: #CBEEBB;
}

pre.code {
	border: 1px solid Black;
	padding: 4px;
	font-family: monospace;
}
.authors {
	font-size: smaller;
	font-style: italic;
}
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Query-Optimizer-Framework"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Optimizer-toolkit.html#Optimizer-toolkit">Optimizer toolkit</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Optimizer-Building-Blocks.html#Optimizer-Building-Blocks">Optimizer Building Blocks</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Optimizer-landscape.html#Optimizer-landscape">Optimizer landscape</a>
<hr>
</div>

<h3 class="section">12.4 Optimizer framework</h3>

<p>The large number of query transformers calls for a flexible scheme for
the deploy them. The approach taken is to make all optimizers visible
at the language level as a MAL pattern. Then (semantic) optimizer merely
inspects a MAL block for their occurrences and activitates it.

   <p>Furthermore, the default optimizer scheme can be associated with
a client record. The strategic optimizer merely prepends each query with
this scheme before it searches/activates the optimizer routines.

   <p>The optimizer routines have access to the client context, the MAL block,
and the program counter where optimizer call was found. Each query
transformer should remove itself from the MAL block;

   <p>The optimizer terminates when no optimizer transformer call remains. 
[Some of the optimizers above should be moved to the tactic level]

   <p>Note, all optimizer instructions are executed only once. This means that the
instruction can be removed from further consideration. However, in the case
that a designated function is selected for optimization (e.g. 
CXoptimizer(user,qry)) the pc is assumed 0. The first instruction always
denotes the signature and can not be removed.

   <p>To safeguard against incomplete optimizer implementations it
is advisable to perform an optimizerCheck at the end. 
It takes as arguments the number of optimizer actions taken
and the total cpu time spent. 
The body performs a full flow and type check and re-initializes
the lifespan administration. In debugging mode also a copy
of the new block is retained for inspection.
<pre class="example"></pre>
   <p>For each function it should be relatively easy to determine its
safety property. This calls for accessing the function MAL block
and to inspect the arguments of the signature.
<pre class="example"></pre>
   <p>Any instruction may block identification of a common
subexpression. It suffices to stumble upon an unsafe function
whose parameter lists has a non-empty intersection with the
targeted instruction. 
To illustrate, consider the sequence
<pre class="example">     L1 := f(A,B,C);
     ...
     G1 := g(D,E,F);
     ...
     l2:= f(A,B,C);
     ...
     L2:= h()
</pre>
   <p>The instruction G1:=g(D,E,F) is blocking if G1 is an alias
for <tt>{</tt>A,B,C<tt>}</tt>. 
Alternatively, function g() may be unsafe and <tt>{</tt>D,E,F<tt>}</tt>
has a non-empty intersection with <tt>{</tt>A,B,C<tt>}</tt>. 
An alias can only be used later on for readonly (and not be used for a function with sideeffects)
<pre class="example"></pre>
   <h4 class="subsection">12.4.1 Flow analysis</h4>

<p>In many optimization rules, the data flow dependency between statements is
of crucial importance. The MAL language encodes a multi-source, multi-sink
dataflow network. Optimizers typically extract part of the workflow and use
the language properties to enumerate semantic equivalent solutions, which
under a given cost model turns out to result in better performance.

   <p>The flow graph plays a crucial role in many optimization steps. 
It is unclear as yet what primitives and what storage structure is
most adequate. For the time being we introduce the operations needed and
evaluate them directly against the program

   <p>The routine flowStep(pca,pcb) checks whether the output of instruction
pca flows directly into pcb, without its parameters being changed inbetween. 
This calls for checking assignments as well as operators that use any of
the targets of pca, but which also change them (e.g. insert/delete bat)
TODO, now more restrictive then needed.
<pre class="example"></pre>
   <p>For each variable we should determine its scope of stability. 
End-points in the flow graph are illustrative as dead-code,
that do not produce persistent data. It can be removed when
you know there are no side-effect.

   <p>Side-effect free evaluation is a property that should be known upfront. 
For the time being, we assume it for all operations known to the system. 
The property `unsafe` is reserved to identify cases where this does not hold. 
Typically, a bun-insert operation is unsafe, as it changes one of the parameters.
<pre class="example"></pre>
   <h4 class="subsection">12.4.2 Basic Algebraic Blocks</h4>

<p>Many code snippets produced by e.g. the SQL compiler is just
a linear representation of an algebra tree/graph. Its detection
makes a number of optimization decisions more easy, because
the operations are known to be side-effect free within the tree/graph. 
This can be used to re-order the plan without concern on impact of the outcome. 
It suffice to respect the flow graph. 
[unclear as what we need]

   </body></html>

