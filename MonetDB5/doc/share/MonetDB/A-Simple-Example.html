<html lang="en">
<head>
<title>A Simple Example - Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Embedded-MonetDB.html#Embedded-MonetDB" title="Embedded MonetDB">
<link rel="prev" href="Embedded-MonetDB.html#Embedded-MonetDB" title="Embedded MonetDB">
<link rel="next" href="Configuration-Parameters.html#Configuration-Parameters" title="Configuration Parameters">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This file documents the MonetDB Version 5.0 Reference Manual

Last updated: June 5, 2006

     Copyright (C) 2000-2006 CWI

     Permission is granted to make and distribute verbatim
     copies of this manual provided the copyright notice and
     this permission notice are preserved on all copies.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body { 
    margin: 0px;
    padding: 0px;
}
a,a:visited {
	color: #336633;
}
a:hover {
	color: #003300;
}

p,body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    text-align: justify;
    font-size: 10pt;
}

h1 {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 14pt;
    font-style: bold;
	text-align: left;
}

td,th {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10pt;
}

div.banner {
	padding: 5px 0px 0px 5px; 
}

div.banner img {
	border: 0px;
	text-decoration: none;
}

div.topmenu {
	margin-top: -20px;
	margin-left: 166px;
	padding: 8px 5px 5px 5px;
	font-size: 8pt;
	background-color: #A9CC99;
}

div.topmenu-bottom {
	margin-top: -4px;
	margin-left: 166px;
	padding: 2px 5px;
	background-color: #BCD2ED; 
}

div.topmenu a {
	padding: 4px 5px 1px 5px;
	text-decoration: none; 
}

div.topmenu a:focus {
	background-color: #6699CC; 
}

div.topmenu a:hover {
	background-color: #5662A0; 
}

/*
span.current {
}
*/

div.topmenu span.current a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.current a:hover {
	color: #336633;
	background-color: #BCD2ED; 
}

/*
span.submenu {
}
*/

div.topmenu span.submenu a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.submenu a:hover {
	background-color: #9FB0DB; 
}

div.topmenu span.button {
	margin: 0px 0px 0px 10px;
}

div.topmenu span.button a {
	padding: 5px 6px 1px 6px;
	color: #333333;
	background-color: #FFAC37;
}

div.topmenu span.button a:hover {
	color: #FFFFFF;
}

div.content {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}

div.header {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}


div.sidebar-a {
	float: left;
	width: 156px;
	padding: 5px;
	font-size: 8pt;
}

div.sidebar-b { 
	float: right;
	width: 146px;
	margin: 0px 0px 0px 5px;
	padding: 5px;
	font-size: 8pt;
}

div.footer-a {
	float: left;
	width: 156px;
	margin: 5px 0px 0px 0px;
	padding: 5px;
	font-size: 7pt;
	background-color: #CBEEBB;
}

div.footer-a a {
	margin: 5px;
	text-decoration: none; 
}

div.footer-b {
	margin: 5px 0px 0px 0px;
	padding: 5px;
	background-color: #A9CC99;
	font-size: 7pt;
}

div.footer-b a {
	margin: 5px;
	padding: 2px 3px;
	text-decoration: none; 
}
div.footer-b a:focus {
	background-color: #6699CC; 
}
div.footer-b a:hover {
	color: #FFFFFF;
	background-color: #5662A0; 
}
div.footer-b img {
	border: 0px;
	vertical-align: bottom;
	text-decoration: none; 
}

div.news {
	border: 1px solid #666699;
	background-color: #E7E7E7; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.news li {
	list-style: square;
}

div.submenu-b {
	border: 1px solid #666699;
	background-color: #CBEEBB;
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu-b a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	color: #000000;
	background-color: #A9CC99;
}

div.submenu-b a:hover {
	background-color: #BCD2ED; 
}

div.submenu-b ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu-b li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu {
	border: 1px solid #666699;
	background-color: #9FB0DB; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	_width: 100%;
}

div.submenu ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu span.submenu a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.submenu a:hover {
	background-color: #A9CC99;
}

div.submenu span.current a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.current a:hover {
	background-color: #CBEEBB;
}

pre.code {
	border: 1px solid Black;
	padding: 4px;
	font-family: monospace;
}
.authors {
	font-size: smaller;
	font-style: italic;
}
--></style>
</head>
<body>
<div class="node">
<p>
<a name="A-Simple-Example"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Configuration-Parameters.html#Configuration-Parameters">Configuration Parameters</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="Embedded-MonetDB.html#Embedded-MonetDB">Embedded MonetDB</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Embedded-MonetDB.html#Embedded-MonetDB">Embedded MonetDB</a>
<hr>
</div>

<h4 class="subsection">6.8.1 Mbedded Example</h4>

<p>A minimalistic embedded application is shown below. It creates
a temporary table in the database, fills it, and retrieves the
records for some statistics gathering.

   <p>The key operation is <code>embedded_sql()</code> which takes an optional
environment argument list. Upon success of this call, there
will be a separate server thread running in the same user space to handle
the database requests. A short-circuit interaction is established
between the application and the kernel using in memory buffers.

   <p>The body of the program consists of the Mapi calls you have
already seen (see <a href="The-Mapi-Library.html#The-Mapi-Library">The Mapi Library</a>). It terminates with a call
to <code>mapi_disconnect()</code> which lets the MonetDB thread
gracefully die.

   <p>The tight coupling of application and kernel code also carries some
dangers. 
Many of the MonetDB data structures can be directly accessed,
or calls to the kernel routines are possible. 
It is highly advised to stick to the Mapi interaction protocol. 
It gives a little more protection against malicious behavior
or unintended side-effects.

<pre class="example"><pre class="verbatim">     
     #include &lt;embeddedclient.h>
     
     #define die(dbh,hdl) (hdl?mapi_explain_result(hdl,stderr):      \
                   dbh?mapi_explain(dbh,stderr):         \
                       fprintf(stderr,"command failed\n"),   \
                   exit(-1))
     
     #define close_handle(X,Y) if (mapi_close_handle(X) != MOK) die(X, Y);
     
     int
     main()
     {
         Mapi dbh;
         MapiHdl hdl = NULL;
         int i;
     
         dbh= embedded_sql(NULL,0);
         if (dbh == NULL || mapi_error(dbh))
             die(dbh, hdl);
     
         /* switch off autocommit */
         if (mapi_setAutocommit(dbh, 0) != MOK || mapi_error(dbh))
             die(dbh,NULL);
     
         if ((hdl = mapi_query(dbh, "create table emp"
     				" (name varchar(20),age int)")) == NULL || mapi_error(dbh))
             die(dbh, hdl);
         close_handle(dbh,hdl);
     
         for(i=0; i&lt; 1000; i++) {
             char query[100];
             snprintf(query, 100, "insert into emp values('user%d', %d)", i, i % 82);
             if ((hdl = mapi_query(dbh, query)) == NULL || mapi_error(dbh))
                 die(dbh, hdl);
             close_handle(dbh,hdl);
         }
     
         if ((hdl = mapi_query(dbh, "select * from emp")) == NULL || mapi_error(dbh))
             die(dbh, hdl);
     
         i=0;
         while (mapi_fetch_row(hdl))  {
             char *age = mapi_fetch_field(hdl, 1);
             i= i+ atoi(age);
         }
         if (mapi_error(dbh))
             die(dbh, hdl);
         close_handle(dbh,hdl);
         printf("The footprint is %d Mb \n",i);
     
         mapi_disconnect(dbh);
         return 0;
     }
</pre>
</pre>
   <p>The embedded MonetDB engine is available as the
library <code>libembedded_sql.a</code> (and <code>libembedded_mal.a</code>)
to be linked with a C-program. 
Provided the programming environment have been initialized properly, it
suffices to prepare the embedded application using
<pre class="example">     gcc myprog.c -o myprog `monetdb5-config --cflags --libs`
</pre>
   <p>You might also write a Makefile to build the program as follows.[todo]
<pre class="example"><pre class="verbatim">     
     CC= gcc
     INCLUDE=`monetdb5-config --cflags`
     LIBS=`monetdb5-config --libs`
     myprog: myprog.o
     	${CC} myprog.o -o myprog ${LIBS}
     myprog.o : myprog.c
     	${CC} -c ${INCLUDE} myprog.c
     
     clean: myprog.o
     	rm -f myprog myprog.o
</pre>
</pre>
   </body></html>

