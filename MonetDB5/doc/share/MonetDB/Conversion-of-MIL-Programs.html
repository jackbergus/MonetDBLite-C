<html lang="en">
<head>
<title>Conversion of MIL Programs - Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="Appendices.html#Appendices" title="Appendices">
<link rel="prev" href="MAL-Syntax.html#MAL-Syntax" title="MAL Syntax">
<link rel="next" href="MAL-Instruction-Overview.html#MAL-Instruction-Overview" title="MAL Instruction Overview">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This file documents the MonetDB Version 5.0 Reference Manual

Last updated: June 5, 2006

     Copyright (C) 2000-2006 CWI

     Permission is granted to make and distribute verbatim
     copies of this manual provided the copyright notice and
     this permission notice are preserved on all copies.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body { 
    margin: 0px;
    padding: 0px;
}
a,a:visited {
	color: #336633;
}
a:hover {
	color: #003300;
}

p,body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    text-align: justify;
    font-size: 10pt;
}

h1 {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 14pt;
    font-style: bold;
	text-align: left;
}

td,th {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10pt;
}

div.banner {
	padding: 5px 0px 0px 5px; 
}

div.banner img {
	border: 0px;
	text-decoration: none;
}

div.topmenu {
	margin-top: -20px;
	margin-left: 166px;
	padding: 8px 5px 5px 5px;
	font-size: 8pt;
	background-color: #A9CC99;
}

div.topmenu-bottom {
	margin-top: -4px;
	margin-left: 166px;
	padding: 2px 5px;
	background-color: #BCD2ED; 
}

div.topmenu a {
	padding: 4px 5px 1px 5px;
	text-decoration: none; 
}

div.topmenu a:focus {
	background-color: #6699CC; 
}

div.topmenu a:hover {
	background-color: #5662A0; 
}

/*
span.current {
}
*/

div.topmenu span.current a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.current a:hover {
	color: #336633;
	background-color: #BCD2ED; 
}

/*
span.submenu {
}
*/

div.topmenu span.submenu a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.submenu a:hover {
	background-color: #9FB0DB; 
}

div.topmenu span.button {
	margin: 0px 0px 0px 10px;
}

div.topmenu span.button a {
	padding: 5px 6px 1px 6px;
	color: #333333;
	background-color: #FFAC37;
}

div.topmenu span.button a:hover {
	color: #FFFFFF;
}

div.content {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}

div.header {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}


div.sidebar-a {
	float: left;
	width: 156px;
	padding: 5px;
	font-size: 8pt;
}

div.sidebar-b { 
	float: right;
	width: 146px;
	margin: 0px 0px 0px 5px;
	padding: 5px;
	font-size: 8pt;
}

div.footer-a {
	float: left;
	width: 156px;
	margin: 5px 0px 0px 0px;
	padding: 5px;
	font-size: 7pt;
	background-color: #CBEEBB;
}

div.footer-a a {
	margin: 5px;
	text-decoration: none; 
}

div.footer-b {
	margin: 5px 0px 0px 0px;
	padding: 5px;
	background-color: #A9CC99;
	font-size: 7pt;
}

div.footer-b a {
	margin: 5px;
	padding: 2px 3px;
	text-decoration: none; 
}
div.footer-b a:focus {
	background-color: #6699CC; 
}
div.footer-b a:hover {
	color: #FFFFFF;
	background-color: #5662A0; 
}
div.footer-b img {
	border: 0px;
	vertical-align: bottom;
	text-decoration: none; 
}

div.news {
	border: 1px solid #666699;
	background-color: #E7E7E7; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.news li {
	list-style: square;
}

div.submenu-b {
	border: 1px solid #666699;
	background-color: #CBEEBB;
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu-b a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	color: #000000;
	background-color: #A9CC99;
}

div.submenu-b a:hover {
	background-color: #BCD2ED; 
}

div.submenu-b ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu-b li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu {
	border: 1px solid #666699;
	background-color: #9FB0DB; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	_width: 100%;
}

div.submenu ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu span.submenu a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.submenu a:hover {
	background-color: #A9CC99;
}

div.submenu span.current a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.current a:hover {
	background-color: #CBEEBB;
}

pre.code {
	border: 1px solid Black;
	padding: 4px;
	font-family: monospace;
}
.authors {
	font-size: smaller;
	font-style: italic;
}
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Conversion-of-MIL-Programs"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="MAL-Instruction-Overview.html#MAL-Instruction-Overview">MAL Instruction Overview</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="MAL-Syntax.html#MAL-Syntax">MAL Syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="Appendices.html#Appendices">Appendices</a>
<hr>
</div>

<h2 class="appendix">Appendix C Conversion of MIL programs</h2>

<h3 class="section">C.1 MIL compilation</h3>

<p>MonetDB comes with its programming language called MIL
(Monet Interface Language). A large collection of MIL programs exists,
which ideally should run without problems on the MonetDB version 5 Kernel. 
Unfortunately, life isn;t that easy. 
MIL was designed as a half-backed scripting language with
dynamic typing, variable re-use with different types,
little support for debugging, and permissive syntax. 
Furthermore, the compiler was intimately coupled with the
runtime system, e.g. an identifier was immediately resolved
against the modules being loaded and variables known within the prevaling
scope. 
This was necessary to resolve their context dependent interpretation.

   <p>In MonetDB Version 4 a cleanup of MIL has already taken place which strikes
a balance between forcing users to migrate to MAL and
to continue using their MIL code base. 
It is realized with a minimalistic compiler, which produces
MAL code for a large fragment of the MIL language. 
There is, however, no information on the runtime status. 
In particular, it means there is no knowledge on pre-existing
variables, type names, procedures, etc..

   <p>With a little care many MIL programs can be compiled
and run against the new kernel. 
The MonetDB test suites and predefined MIL proc's
have been used to define the language boundary to be supported.

   <p>In writing MIL code, the following rules should be kept obeyed:
     <ul>
<li>do not change the type of variables within their scope. 
<li>do not use type identifiers as ordinary variables
<li>properly type a new variable when it is initialized with nil,
e.g.  nil:int
</ul>

   <p>Consider the following old MIL program stored in the file <em>my.mil</em>
<pre class="verbatim">
proc hello(str s):void { s.print(); }
</pre>
The migration step involves loading the <code>mil</code> module,
whereafter the file can be compiled.
<pre class="example">     &gt;include mil;
     &gt;mil.compile("my.mil");
     function hello(s:str):void;
         _3 := io.print(s);
     end hello;
</pre>
   <h3 class="section">C.2 Conversion Pitfalls</h3>

<p>In this section we summarize the pitfalls and limitations encountered
in using the MIL to MAL compiler.

   <p><strong>Name spaces</strong>. 
The naming of functions has undergone a clean up action. Part of this
name re-casting is dealt with in a transparent way for the user.

   <p><strong>Multiplex operations</strong>. 
One of the old key features dropped is the generic multiplex operation. 
Although this language construct was dealt with rather efficiently
in the MIL interpreter, we have opted for a more mundane approach. 
The multiplex operations were mostly used in the context of
arithmetic expressions and coercions over BATs. In particular,
those that have a <code>:void</code> head.

   <p>These operations are now directly supported by C implementations
in the modules <code>batcalc, batstr, batmath, batcolor</code>. 
The generic case is still available in the form of a optimizer
request, i.e. <code>optimizer.multiplex(S,A1,...,An)</code> The first argument should be a string literal that denotes
the element operation over the remaining arguments. 
The optimzier bakes an interator block to produce the required result.

   <p>Beware, in the older version the semantics of the multiplex
was based on join semantics over the head of the argument BATs. 
This has been dropped as well.

   <p><strong>Signature changes</strong>. 
Aside from syntax restrictions imposed, several command
signatures and command names have been changed. 
They have to translated partly by hand or the MIL program
should be prepared for a proper translation.

   <p>For example, the BAT update routines do not return
their target variable. This means you can not cascade a series
of calls, e.g. the statement
<pre class="example">      a.select(1,2).access(BAT_WRITE).rename("C");
      b.insert(0,1).insert(1,2);
</pre>
   <p>should be split into multiple steps as follows:
<pre class="example">      a.select(1,2); a.access(BAT_WRITE); a.rename("C");
      b.insert(0,1); b.insert(1,2);
</pre>
   <p><strong>Runtime dependencies</strong>. 
A major rewrite of the MIL program is required when
it inspects the runtime environment. See the bbp and inspection modules
for information on the operations available.
<pre class="example"></pre>
   </body></html>

