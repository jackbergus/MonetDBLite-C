<html lang="en">
<head>
<title>Sample Application - Untitled</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Untitled">
<meta name="generator" content="makeinfo 4.8">
<link title="Top" rel="start" href="index.html#Top">
<link rel="up" href="The-Mapi-Library.html#The-Mapi-Library" title="The Mapi Library">
<link rel="prev" href="The-Mapi-Library.html#The-Mapi-Library" title="The Mapi Library">
<link rel="next" href="Caveats.html#Caveats" title="Caveats">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
This file documents the MonetDB Version 5.0 Reference Manual

Last updated: June 5, 2006

     Copyright (C) 2000-2006 CWI

     Permission is granted to make and distribute verbatim
     copies of this manual provided the copyright notice and
     this permission notice are preserved on all copies.-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
body { 
    margin: 0px;
    padding: 0px;
}
a,a:visited {
	color: #336633;
}
a:hover {
	color: #003300;
}

p,body {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    text-align: justify;
    font-size: 10pt;
}

h1 {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 14pt;
    font-style: bold;
	text-align: left;
}

td,th {
    font-family: Verdana, Arial, Helvetica, sans-serif;
    font-size: 10pt;
}

div.banner {
	padding: 5px 0px 0px 5px; 
}

div.banner img {
	border: 0px;
	text-decoration: none;
}

div.topmenu {
	margin-top: -20px;
	margin-left: 166px;
	padding: 8px 5px 5px 5px;
	font-size: 8pt;
	background-color: #A9CC99;
}

div.topmenu-bottom {
	margin-top: -4px;
	margin-left: 166px;
	padding: 2px 5px;
	background-color: #BCD2ED; 
}

div.topmenu a {
	padding: 4px 5px 1px 5px;
	text-decoration: none; 
}

div.topmenu a:focus {
	background-color: #6699CC; 
}

div.topmenu a:hover {
	background-color: #5662A0; 
}

/*
span.current {
}
*/

div.topmenu span.current a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.current a:hover {
	color: #336633;
	background-color: #BCD2ED; 
}

/*
span.submenu {
}
*/

div.topmenu span.submenu a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.topmenu span.submenu a:hover {
	background-color: #9FB0DB; 
}

div.topmenu span.button {
	margin: 0px 0px 0px 10px;
}

div.topmenu span.button a {
	padding: 5px 6px 1px 6px;
	color: #333333;
	background-color: #FFAC37;
}

div.topmenu span.button a:hover {
	color: #FFFFFF;
}

div.content {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}

div.header {
	padding: 5px;
	margin-left: 166px;
	margin-right: 12%;
}


div.sidebar-a {
	float: left;
	width: 156px;
	padding: 5px;
	font-size: 8pt;
}

div.sidebar-b { 
	float: right;
	width: 146px;
	margin: 0px 0px 0px 5px;
	padding: 5px;
	font-size: 8pt;
}

div.footer-a {
	float: left;
	width: 156px;
	margin: 5px 0px 0px 0px;
	padding: 5px;
	font-size: 7pt;
	background-color: #CBEEBB;
}

div.footer-a a {
	margin: 5px;
	text-decoration: none; 
}

div.footer-b {
	margin: 5px 0px 0px 0px;
	padding: 5px;
	background-color: #A9CC99;
	font-size: 7pt;
}

div.footer-b a {
	margin: 5px;
	padding: 2px 3px;
	text-decoration: none; 
}
div.footer-b a:focus {
	background-color: #6699CC; 
}
div.footer-b a:hover {
	color: #FFFFFF;
	background-color: #5662A0; 
}
div.footer-b img {
	border: 0px;
	vertical-align: bottom;
	text-decoration: none; 
}

div.news {
	border: 1px solid #666699;
	background-color: #E7E7E7; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.news li {
	list-style: square;
}

div.submenu-b {
	border: 1px solid #666699;
	background-color: #CBEEBB;
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu-b a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	color: #000000;
	background-color: #A9CC99;
}

div.submenu-b a:hover {
	background-color: #BCD2ED; 
}

div.submenu-b ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu-b li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu {
	border: 1px solid #666699;
	background-color: #9FB0DB; 
	margin: 3px 0px;
	padding: 5px 5px 5px 5px;
}

div.submenu a {
	text-decoration: none; 
	display: block;
	padding: 1px 2px;
	_width: 100%;
}

div.submenu ul {
	padding: 1px 0px 1px 0px;
	margin: 0px;
}

div.submenu li {
	list-style: none;
	padding: 1px 0px 0px 6px;
}

div.submenu span.submenu a {
	color: #000000;
	background-color: #BCD2ED; 
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.submenu a:hover {
	background-color: #A9CC99;
}

div.submenu span.current a {
	background-color: #CBEEBB;
}

/* this should be inherited IMHO, but it doesn't so we just redefine it */
div.submenu span.current a:hover {
	background-color: #CBEEBB;
}

pre.code {
	border: 1px solid Black;
	padding: 4px;
	font-family: monospace;
}
.authors {
	font-size: smaller;
	font-style: italic;
}
--></style>
</head>
<body>
<div class="node">
<p>
<a name="Sample-Application"></a>
Next:&nbsp;<a rel="next" accesskey="n" href="Caveats.html#Caveats">Caveats</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="The-Mapi-Library.html#The-Mapi-Library">The Mapi Library</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="The-Mapi-Library.html#The-Mapi-Library">The Mapi Library</a>
<hr>
</div>

<h3 class="section">6.1 Sample MAPI Application</h3>

<p>The database driver implementation given in this document focuses on
developing applications in C/C++. The command collection has been
chosen to align with common practice, i.e. queries follow a prepare,
execute, and fetch_row paradigm. The output is considered a regular
table. An example of a mini application below illustrates the main
operations.

<pre class="example"><pre class="verbatim">     
     #include &lt;Mapi.h>
     #include &lt;stdio.h>
     
     #define die(dbh,hdl) (hdl?mapi_explain_query(hdl,stderr):		\
                               dbh?mapi_explain(dbh,stderr):			\
                                   fprintf(stderr,"command failed\n"),	\
                           exit(-1))
     
     int main(int argc, char **argv)
     {
         Mapi dbh;
         MapiHdl hdl = NULL;
     
         dbh = mapi_connect("localhost", 50000, "monetdb", "monetdb", "sql");
         if (mapi_error(dbh))
             die(dbh, hdl);
     
         if ((hdl = mapi_query(dbh, "create table emp(name varchar(20), age int)")) == NULL
             || mapi_error(dbh) != MOK)
             die(dbh, hdl);
         if (mapi_close_handle(hdl) != MOK)
             die(dbh, hdl);
         if ((hdl = mapi_query(dbh, "insert into emp values('John', 23)")) == NULL
             || mapi_error(dbh) != MOK)
             die(dbh, hdl);
         mapi_close_handle(hdl);
         if (mapi_error(dbh) != MOK)
             die(dbh, hdl);
         if ((hdl = mapi_query(dbh, "insert into emp values('Mary', 22)")) == NULL
             || mapi_error(dbh) != MOK)
             die(dbh, hdl);
         mapi_close_handle(hdl);
         if (mapi_error(dbh) != MOK)
             die(dbh, hdl);
         if ((hdl = mapi_query(dbh, "select * from emp")) == NULL
             || mapi_error(dbh) != MOK)
             die(dbh, hdl);
     
         while (mapi_fetch_row(hdl)) {
             char *nme = mapi_fetch_field(hdl, 0);
             char *age = mapi_fetch_field(hdl, 1);
             printf("%s is %s\n", nme, age);
         }
         if (mapi_error(dbh) != MOK)
             die(dbh, hdl);
         mapi_close_handle(hdl);
         if (mapi_error(dbh) != MOK)
             die(dbh, hdl);
         mapi_disconnect(dbh);
     
         return 0;
     }
</pre>
</pre>
   <p>The <code>mapi_connect()</code> operation establishes a communication channel with
a running server on the local machine. The user name is "monetdb" with
password "monetdb". 
The query language interface is either "sql", "mil" or "xquery".  Future
versions are expected to recognize also "ram" and "mal".

   <p>Errors on the interaction can be captured using <code>mapi_error()</code>,
possibly followed by a request to dump a short error message
explanation on a standard file location. It has been abstracted away
in a macro.

   <p>Provided we can establish a connection, the interaction proceeds as in
many similar application development packages. Queries are shipped for
execution using <code>mapi_query()</code> and an answer table can be consumed one
row at a time. In many cases these functions suffice.

   <p>The Mapi interface provides caching of rows at the client side. 
<code>mapi_query()</code> will load tuples into the cache, after which they can be
read repeatedly using <code>mapi_fetch_row()</code> or directly accessed
(<code>mapi_seek_row()</code>). This facility is particularly handy when small,
but stable query results are repeatedly used in the client program.

   <p>To ease communication between application code and the cache entries,
the user can bind the C-variables both for input and output to the
query parameters, and output columns, respectively.  The query
parameters are indicated by '?' and may appear anywhere in the query
template.

   </body></html>

