@echo off

if not "%1"=="" goto skip
call %0 -r
goto end

:skip

setlocal

set pkg=monetdb5
set builddir=@XMONETDB5_BUILD@
set srcdir=@XMONETDB5_SOURCE@

set MOD_PATH=%builddir%\src\compiler\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\compiler
set MOD_PATH=%MOD_PATH%;%builddir%\src\optimizer\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\optimizer
set MOD_PATH=%MOD_PATH%;%builddir%\src\scheduler\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\scheduler
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\atoms\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\atoms
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\kernel\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\kernel
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\mal\.libs
set MOD_PATH=%MOD_PATH%;%builddir%\src\modules\mal

set PATH=%MOD_PATH%;%PATH%
set PATH=%builddir%\src\mal;%PATH%
set PATH=%builddir%\src\tools;%PATH%

REM execute Mapprove.py in the source directory
pushd %srcdir%

call Mapprove.py --config="%builddir%/conf/monetdb5.conf" --package=%pkg% "--monet_mod_path=%MOD_PATH%" "--dbfarm=%builddir%\dbfarm" "--sql_logdir=%builddir%\sql_logs" "--xquery_logdir=%builddir%\xquery_logs" "--TSTTRGBASE=%builddir%" %*

popd
endlocal

:end
