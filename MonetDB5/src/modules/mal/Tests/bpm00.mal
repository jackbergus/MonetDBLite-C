#testing the BAT partition manager
R := bat.new(:oid,:int);
bat.setSequenceBase(R,0@0);
bat.append(R,1);
bat.append(R,3);
bat.append(R,5);
bat.append(R,7);
bat.append(R,11);

function user.pr(Ra:bat[:any_1,:any_2]):void;
barrier Rp:= bpm.newIterator(Ra);
	io.print(Rp);
	redo Rp:= bpm.hasMoreElements(Ra);
exit Rp;
end pr;

# add the stuff to the BPM and dump it
bpm.deposit("myR",R);
Ra:= bpm.take("myR",:bat[:oid,:int]);
user.pr(Ra);

io.print("Partition it into two value ranges");
bpm.rangePartition(Ra,nil:oid,nil:oid,0,5);
bpm.rangePartition(Ra,nil:oid,nil:oid,6,nil:int);
bpm.dump(Ra);
user.pr(Ra);

io.print("Repartition it further into two oid ranges");
bpm.rangePartition(Ra,nil:oid,1@0,nil:int,nil:int);
bpm.rangePartition(Ra,3@0,nil:oid,nil:int,nil:int);
# we should have 4 partitions
bpm.dump(Ra);
user.pr(Ra);
bpm.discard(Ra);
