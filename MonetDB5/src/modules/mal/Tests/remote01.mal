# for testweb, we need to ask the server itself how it is available, use
# sabaoth for that
include sabaoth;

d := const.take("dbname");
h := sabaoth.getLocalConnectionHost();
p := sabaoth.getLocalConnectionPort();

# create a connecton to ourself
remote.create(d, h, p);
conn := remote.connect(d, "monetdb", "monetdb");
io.print(conn);

# retrieve a value (that for sure won't exist)
x:str := remote.get(conn, "b1_str");
catch MALException:str;
	io.printf("!%s\n",MALException);
exit MALException;

# should raise an exception because making duplicates makes no sense
i := remote.create(d, h, p);
catch MALException:str;
	io.printf("!%s\n",MALException);
exit MALException;

# help testweb a bit, since currently no cleanup is done on server
# shutdown
remote.disconnect(conn);

# this should fail now
remote.disconnect(conn);
catch MALException:str;
	# make it a comment, the connection name is always different
	io.printf("!%s\n",MALException);
exit MALException;
