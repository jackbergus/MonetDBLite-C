include remote;
# for testweb, we need to ask the server itself how it is available, use
# sabaoth for that
include sabaoth;

h := sabaoth.getLocalConnectionHost();
p := sabaoth.getLocalConnectionPort();

# create a connecton to ourself
remote.create("test", h, p, nil:str, "monetdb", "monetdb");


# now do it with a function that returns something (a BAT in this case)
b := remote.exec("test", "inspect", "getAtomNames");
io.print(b);
catch MALException:str;
	io.printf("!first\n");
exit MALException;

# this is invalid, as io.print is an invalid module, and bla will be
# taken as function
io.printf("sent invalid request\n");
f := remote.exec("test", "io.print", "bla");
io.print(f);
catch MALException:str;
	io.printf("!second\n");
exit MALException;

io.printf("sent request\n");
# io.print only outputs things, but returns nothing
a := remote.exec("test", "io", "print", "bla");
catch MALException:str;
	io.printf("!third:\n");
exit MALException;
io.print(a);

# help testweb a bit, since currently no cleanup is done on server
# shutdown
remote.destroy("test");
