stdout of test 'mserver00` in directory 'src/modules/mal` itself:


# 23:07:54 >  
# 23:07:54 >  Mtimeout -timeout 60 mserver5 "--config=/ufs/mk/monet5/src/mal/Tests/All.conf" --debug=10 --set "monet_mod_path=/ufs/mk/monet5/Linux/lib/MonetDB5:/ufs/mk/opensource/MonetDB/Linux/lib/MonetDB" --set "gdk_dbfarm=/ufs/mk/monet5/Linux/var/MonetDB5/dbfarm" --set "sql_logdir=/ufs/mk/monet5/Linux/var/MonetDB5/dblogs" --set mapi_port=37461 --set monet_prompt= --trace --dbname=mTests_src_modules_kernel  mapi00.mal < /dev/null
# 23:07:54 >  

# Monet Database Server V4.99.19
# Copyright (c) 1993-2006, CWI. All rights reserved.
# Compiled for x86_64-redhat-linux-gnu/64bit with 64bit OIDs; dynamically linked.
# config:/ufs/mk/monet5/src/mal/Tests/All.conf
# dbfarm:/ufs/mk/monet5/Linux/var/MonetDB5/dbfarm
# dbname:mTests_src_modules_kernel
# Visit http://monetdb.cwi.nl/ for further information.
## Attempt to establish a client connection to yourself.
#
#z:= inspect.getEnvironment();
#ps:= algebra.find(z,"mapi_port");
#port:= calc.int(ps);
#hs:= algebra.find(z,"host");
#
#u:= clients.getInfo();
#usr:= algebra.find(u,"user");
#pwd:= algebra.find(u,"password");
#lang:= algebra.find(u,"scenario");
#
## setup the session
#i:= mapi.connect(hs,port,usr,pwd,lang);
#io.print(i);
#
function user.main():void;	# 0  (main:void)
# Attempt to establish a client connection to yourself. 	# 1  (_1:str)
    z := inspect.getEnvironment();	# 2 INSPECTgetEnvironment (z:bat[:str,:str])
    ps := algebra.find(z,"mapi_port");	# 3 ALGfind (ps:str)<-(z:bat[:str,:str])(_4:str)
    port := calc.int(ps);	# 4 CALCstr2int (port:int)<-(ps:str)
    hs := algebra.find(z,"host");	# 5 ALGfind (hs:str)<-(z:bat[:str,:str])(_7:str)
# hardcoded, as access control currently works, and client.getInfo # doesn't 	# 6  (_8:str)
#u:= clients.getInfo(); 	# 7  (_9:str)
#usr:= algebra.find(u,"user"); 	# 8  (_10:str)
#pwd:= algebra.find(u,"password"); 	# 9  (_11:str)
#lang:= algebra.find(u,"scenario"); 	# 10  (_12:str)
    usr := "monetdb";	# 11  (usr:str)<-(_14:str)
    pwd := "monetdb";	# 12  (pwd:str)<-(_14:str)
    lang := "mal";	# 13  (lang:str)<-(_17:str)
# setup the session 	# 14  (_18:str)
    mid := mserver.connect(hs,port,usr,pwd,lang);	# 15 SERVERconnect (mid:int)<-(hs:str)(port:int)(usr:str)(pwd:str)(lang:str)
    io.print(mid);	# 16 IOprint_val (_20:int)<-(mid:int)
# retrieve data from the 'remote' site 	# 17  (_21:str)
# testing t:=1+3; 	# 18  (_22:str)
    t0 := alarm.usec();	# 19 ALARMusec (t0:lng)
    mserver.query(mid,"t:= 1+3; io.print(t,\"hello\");");	# 20 SERVERquery (_24:int)<-(mid:int)(_25:str)
    t1 := alarm.usec();	# 21 ALARMusec (t1:lng)
    t1 := calc.-(t1,t0);	# 22 CALCbinarySUBlnglng (t1:lng)<-(t1:lng)(t0:lng)
    io.print(t1);	# 23 IOprint_val (_27:int)<-(t1:lng)
    i := mserver.get_row_count(mid);	# 24 SERVERget_row_count (i:int)<-(mid:int)
    io.printf("rowcount %d\n",i);	# 25 IOprint_formatted_int (_29:int)<-(_30:str)(i:int)
    mserver.fetch_row(mid);	# 26 SERVERfetch_row (_31:int)<-(mid:int)
    i := mserver.get_field_count(mid);	# 27 SERVERget_field_count (i:int)<-(mid:int)
    io.printf("fieldcount %d\n",i);	# 28 IOprint_formatted_int (_32:int)<-(_33:str)(i:int)
    i := mserver.fetch_field(mid,0);	# 29 SERVERfetch_field_int (i:int)<-(mid:int)(_34:int)
    io.printf("field 0 %d\n",i);	# 30 IOprint_formatted_int (_35:int)<-(_36:str)(i:int)
    s:str  := mserver.fetch_field(mid,1);	# 31 SERVERfetch_field_str (s:str)<-(mid:int)(_38:int)
    io.printf("field 1 %s\n",s);	# 32 IOprint_formatted_str (_39:int)<-(_40:str)(s:str)
    t0 := alarm.usec();	# 33 ALARMusec (t0:lng)
    mserver.query(mid,"r:= bat.new(:oid,:int);");	# 34 SERVERquery (_41:int)<-(mid:int)(_42:str)
    mserver.query(mid,"bat.insert(r, 1@0,311);");	# 35 SERVERquery (_43:int)<-(mid:int)(_44:str)
    mserver.query(mid,"bat.insert(r,2@0,433);");	# 36 SERVERquery (_45:int)<-(mid:int)(_46:str)
    b:bat[:oid,:int]  := mserver.rpc(mid,"io.print(r);");	# 37 SERVERmapi_rpc_bat (b:bat[:oid,:int])<-(mid:int)(_48:str)
    t1 := alarm.usec();	# 38 ALARMusec (t1:lng)
    t1 := calc.-(t1,t0);	# 39 CALCbinarySUBlnglng (t1:lng)<-(t1:lng)(t0:lng)
    io.print(b);	# 40 IOprint_val (_49:int)<-(b:bat[:oid,:int])
    io.print(t1);	# 41 IOprint_val (_50:int)<-(t1:lng)
# use the BAT fetch operation 	# 42  (_51:str)
#b:bat[:oid,:int]:= mserver.receive(mid,"remotename"); 	# 43  (_52:str)
    msg:str  := mserver.rpc(mid,"io.print(\"hello world\");");	# 44 SERVERmapi_rpc_single_row (msg:str)<-(mid:int)(_54:str)
    io.print(msg);	# 45 IOprint_val (_55:int)<-(msg:str)
    o:oid  := mserver.rpc(mid,"io.print(34@0);");	# 46 SERVERmapi_rpc_single_row (o:oid)<-(mid:int)(_57:str)
    io.print(o);	# 47 IOprint_val (_58:int)<-(o:oid)
    o:oid  := mserver.rpc(mid,"io.print(nil:oid);");	# 48 SERVERmapi_rpc_single_row (o:oid)<-(mid:int)(_59:str)
    io.print(o);	# 49 IOprint_val (_60:int)<-(o:oid)
#needs type checks 	# 50  (_61:str)
#(k:int,s:str):= mserver.rpc(mid,"io.print(nil:int,\"done\");"); 	# 51  (_62:str)
#io.print(k,s); 	# 52  (_63:str)
# what is the relationship between local/remote namespace 	# 53  (_64:str)
# mserver.send(key,"a",a); 	# 54  (_65:str)
# c:= mserver.join(key,a,b); 	# 55  (_66:str)
# mserver.rpc(key,"z:=algebra.join(a,b);"); 	# 56  (_67:str)
# c:= mserver.receive(key,"c") 	# 57  (_68:str)
#patterns 	# 58  (_69:str)
#pat:= "a:= algebra.select(b,?,?);"); 	# 59  (_70:str)
#qry:=  str.replace(pat,"?",i,j); 	# 60  (_71:str)
#mserver.query(key,pat,i,j); 	# 61  (_72:str)
#how to ship a routine 	# 62  (_73:str)
#fcn:= manual.definition(manual,help); 	# 63  (_74:str)
# how to remote MAL execution 	# 64  (_75:str)
# remotedb:= mserver.connect(...) 	# 65  (_76:str)
# algebra.join@remotedb(a,b) using remote objects 	# 66  (_77:str)
# c:= mserver.rpc(remotedb,algebra,join,a,b) 	# 67  (_78:str)
# the remainder should be tested  	# 68  (_79:str)
catch MapiException;	# 69  (MapiException:str) jump 71
    io.printf("foutje:%s\n",MapiException);	# 70 IOprint_formatted_str (_81:int)<-(_82:str)(MapiException:str)
exit MapiException;	# 71  (MapiException:str)
end main;	# 72  
Succeeded to establish session
[ 1 ]
[ 158 ]
rowcount 1
fieldcount 2
field 0 4
field 1 hello
#-----------------#
# h	t	  # name
# oid	int	  # type
#-----------------#
[ 1@0,	  311	  ]
[ 2@0,	  433	  ]
[ 319 ]
about to sent: io.print("hello world");
Got: hello world
[ "hello world" ]
about to sent: io.print(34@0);
Got: 34@0
[ 34@0 ]
about to sent: io.print(nil:oid);
Got: (null)
[ nil ]

# 23:07:54 >  
# 23:07:54 >  Done.
# 23:07:54 >  

