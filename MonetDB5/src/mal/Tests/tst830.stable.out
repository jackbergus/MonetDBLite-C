stdout of test 'tst830` in directory 'src/mal` itself:


# 20:34:17 >  
# 20:34:17 >  Mtimeout -timeout 60 mserver "--config=/ufs/mk/monet5/src/mal/Tests/All.conf" --debug=10 --set "monet_mod_path=/ufs/mk/monet5/Linux/lib/MonetDB5:/ufs/mk/opensource/MonetDB/Linux/lib/MonetDB" --set "gdk_dbfarm=/ufs/mk/opensource/MonetDB/Linux/var/MonetDB5/dbfarm" --set "sql_logdir=/ufs/mk/opensource/MonetDB/Linux/var/MonetDB5/log" --set mapi_port=36259 --set sql_port=40419 --set xquery_port=52492 --set monet_prompt= --trace "--config=/ufs/mk/monet5/src/mal/Tests/All.conf" --dbname=mTests_src_mal  tst830.mal < /dev/null
# 20:34:17 >  

# MonetDB Server v4.99.19
# Copyright (c) 1993-2006 CWI, all rights reserved
# Compiled for x86_64-redhat-linux-gnu/64bit with 64bit OIDs dynamically linked
# config:/ufs/fabian/scratch/monetdb/five/program-x86_64/etc/MonetDB5.conf
# dbfarm:/net/pegasus.ins.cwi.nl/export/scratch0/fabian/vtmp/mtest-five-monetdb-pegasus.ins.cwi.nl/monetdb/dbfarm
# dbname:mTests_src_mal
# Visit http://monetdb.cwi.nl/ for further information.
## a simple functional test for the access control table
#
#	scens := bat.new(:str, :oid);
#	bat.insert(scens, "sql", nil:oid);
#	bat.insert(scens, "mal", nil:oid);
#
#	# this should fail, the monetdb user is already there
#	id := clients.addUser("monetdb", "Pmonetdb", scens);
#catch MALException:str;
#	io.printf("%s\n",MALException);
#exit MALException;
#
#	# should print 0@1 or something
#	id := clients.addUser("test", "test", scens);
#	io.print(id);
#
#	# this should work also
#	# don't use nil:bat[:str, :oid] here, it results in a crash
#	t := bat.new(:str, :oid);
#	id := clients.addUser("checkpoint", "Pcheckpoint", t);
#	io.print(id);
#
#	# do a simple listing of users known
#	u := clients.getUsers(t);
#	io.print(u);
#	bat.insert(t, "mal", nil:oid);
#	bat.insert(t, "sql", nil:oid);
#	u := clients.getUsers(t);
#	io.print(u);
#
#	# should work, we're the admin here
#	clients.removeUser("checkpoint");
#
#	# do a simple listing of users known
#	u := clients.getUsers(t);
#	io.print(u);
#
#	# just remove the scenarios one by one, should work
#	clients.removeScenario("test", "mal");
#	clients.removeScenario("test", "sql");
#	# this one should fail: it's not there
#	clients.removeScenario("test", "mil");
#catch MALException:str;
#	io.printf("%s\n",MALException);
#	MALException:= nil:str;
#exit MALException;
#
#	# and add a scenario again
#	clients.addScenario("test", "mal");
#	# do it again, see what happens (should fail)
#	clients.addScenario("test", "mal");
#catch MALException:str;
#	io.printf("%s\n",MALException);
#	MALException:= nil:str;
#exit MALException;
#
#	# forcefully set the password of the user test
#	clients.setPassword("test", "newpass");
#	# now try to set the password for ourself, should fail
#	clients.setPassword("monetdb", "badpass");
#catch InvalidCredentialsException:str;
#	io.printf("%s\n", InvalidCredentialsException);
#exit InvalidCredentialsException;
#
#	# change our own password
#	clients.changePassword("monetdb", "newdb");
#	# try it again, should fail...
#	clients.changePassword("monetdb", "newdb");
#catch InvalidCredentialsException:str;
#	io.printf("%s\n",InvalidCredentialsException);
#	InvalidCredentialsException:= nil:str;
#exit InvalidCredentialsException;
#
#	# all should fail
#	clients.checkPermission("monetdb","Pmonetdb","sql");
#catch InvalidCredentialsException:str;
#	io.printf("%s\n",InvalidCredentialsException);
#	InvalidCredentialsException:= nil:str;
#exit InvalidCredentialsException;
#	clients.checkPermission("monetdb","x","sql");
#catch InvalidCredentialsException:str;
#	io.printf("%s\n",InvalidCredentialsException);
#	InvalidCredentialsException:= nil:str;
#exit InvalidCredentialsException;
#	clients.checkPermission("monetdb","Pmonetdb","x");
#catch InvalidCredentialsException:str;
#	io.printf("%s\n",InvalidCredentialsException);
#	InvalidCredentialsException:= nil:str;
#exit InvalidCredentialsException;
#	clients.checkPermission("x","Pmonetdb","sql");
#catch InvalidCredentialsException:str;
#	io.printf("%s\n",InvalidCredentialsException);
#	InvalidCredentialsException:= nil:str;
#exit InvalidCredentialsException;
#
function user.main():void;              #  0 main:void {G}
# a simple functional test for the access control table 
    scens := bat.new(:str,:oid);        #  2 scens:bat[:str,:oid] := CMDBATnew(_3:str, _4:oid) {G}
    bat.insert(scens,"sql",nil:oid);    #  3 _5:void := BKCinsert_bun(scens:bat[:str,:oid], _6:str, _7:oid) 
    bat.insert(scens,"mal",nil:oid);    #  4 _8:void := BKCinsert_bun(scens:bat[:str,:oid], _9:str, _7:oid) 
# this should fail, the monetdb user is already there 
    id := clients.addUser("monetdb","Pmonetdb",scens);#  6 id:oid := CLTaddUser(_12:str, _13:str, scens:bat[:str,:oid]) 
catch MALException:str ;                #  7 MALException:str {J9}
    io.printf("%s\n",MALException);     #  8 _15:void := IOprint_formatted_str(_16:str, MALException:str) 
exit MALException:str ;                 #  9 MALException:str 
# should print 0@1 or something 
    id := clients.addUser("test","test",scens);# 11 id:oid := CLTaddUser(_18:str, _18:str, scens:bat[:str,:oid]) 
    io.print(id);                       # 12 _19:void := IOprint_val(id:oid) 
# this should work also 
# don't use nil:bat[:str, :oid] here, it results in a crash 
    t := bat.new(:str,:oid);            # 15 t:bat[:str,:oid] := CMDBATnew(_23:str, _4:oid) {G}
    id := clients.addUser("checkpoint","Pcheckpoint",t);# 16 id:oid := CLTaddUser(_24:str, _25:str, t:bat[:str,:oid]) 
    io.print(id);                       # 17 _26:void := IOprint_val(id:oid) 
# do a simple listing of users known 
    u := clients.getUsers(t);           # 19 u:bat[:oid,:str] := CLTgetUsers(t:bat[:str,:oid]) {G}
    io.print(u);                        # 20 _29:void := IOprint_val(u:bat[:oid,:str]) 
    bat.insert(t,"mal",nil:oid);        # 21 _30:void := BKCinsert_bun(t:bat[:str,:oid], _9:str, _7:oid) 
    bat.insert(t,"sql",nil:oid);        # 22 _31:void := BKCinsert_bun(t:bat[:str,:oid], _6:str, _7:oid) 
    u := clients.getUsers(t);           # 23 u:bat[:oid,:str] := CLTgetUsers(t:bat[:str,:oid]) {G}
    io.print(u);                        # 24 _32:void := IOprint_val(u:bat[:oid,:str]) 
# should work, we're the admin here 
    clients.removeUser("checkpoint");   # 26 _34:void := CLTremoveUser(_24:str) 
# do a simple listing of users known 
    u := clients.getUsers(t);           # 28 u:bat[:oid,:str] := CLTgetUsers(t:bat[:str,:oid]) {G}
    io.print(u);                        # 29 _36:void := IOprint_val(u:bat[:oid,:str]) 
# just remove the scenarios one by one, should work 
    clients.removeScenario("test","mal");# 31 _38:void := CLTremoveScenario(_18:str, _9:str) 
    clients.removeScenario("test","sql");# 32 _39:void := CLTremoveScenario(_18:str, _40:str) 
# this one should fail: it's not there 
    clients.removeScenario("test","mil");# 34 _42:void := CLTremoveScenario(_18:str, _43:str) 
catch MALException:str ;                # 35 MALException:str {J38}
    io.printf("%s\n",MALException);     # 36 _44:void := IOprint_formatted_str(_16:str, MALException:str) 
    MALException:str  := nil:str;       # 37 MALException:str := _45:str {G}
exit MALException:str ;                 # 38 MALException:str 
# and add a scenario again 
    clients.addScenario("test","mal");  # 40 _47:void := CLTaddScenario(_18:str, _48:str) 
# do it again, see what happens (should fail) 
    clients.addScenario("test","mal");  # 42 _50:void := CLTaddScenario(_51:str, _48:str) 
catch MALException:str ;                # 43 MALException:str {J46}
    io.printf("%s\n",MALException);     # 44 _52:void := IOprint_formatted_str(_53:str, MALException:str) 
    MALException:str  := nil:str;       # 45 MALException:str := _45:str {G}
exit MALException:str ;                 # 46 MALException:str 
# forcefully set the password of the user test 
    clients.setPassword("test","newpass");# 48 _55:void := CLTsetPassword(_51:str, _56:str) 
# now try to set the password for ourself, should fail 
    clients.setPassword("monetdb","badpass");# 50 _58:void := CLTsetPassword(_59:str, _60:str) 
catch InvalidCredentialsException:str ; # 51 InvalidCredentialsException:str {J53}
    io.printf("%s\n",InvalidCredentialsException);# 52 _62:void := IOprint_formatted_str(_53:str, InvalidCredentialsException:str) 
exit InvalidCredentialsException:str ;  # 53 InvalidCredentialsException:str 
# change our own password 
    clients.changePassword("monetdb","newdb");# 55 _64:void := CLTchangePassword(_59:str, _65:str) 
# try it again, should fail... 
    clients.changePassword("monetdb","newdb");# 57 _67:void := CLTchangePassword(_59:str, _65:str) 
catch InvalidCredentialsException:str ; # 58 InvalidCredentialsException:str {J61}
    io.printf("%s\n",InvalidCredentialsException);# 59 _68:void := IOprint_formatted_str(_53:str, InvalidCredentialsException:str) 
    InvalidCredentialsException:str  := nil:str;# 60 InvalidCredentialsException:str := _45:str {G}
exit InvalidCredentialsException:str ;  # 61 InvalidCredentialsException:str 
# all should fail 
    clients.checkPermission("monetdb","Pmonetdb","sql");# 63 _70:void := CLTcheckPermission(_59:str, _71:str, _40:str) 
catch InvalidCredentialsException:str ; # 64 InvalidCredentialsException:str {J67}
    io.printf("%s\n",InvalidCredentialsException);# 65 _72:void := IOprint_formatted_str(_53:str, InvalidCredentialsException:str) 
    InvalidCredentialsException:str  := nil:str;# 66 InvalidCredentialsException:str := _45:str {G}
exit InvalidCredentialsException:str ;  # 67 InvalidCredentialsException:str 
    clients.checkPermission("monetdb","x","sql");# 68 _73:void := CLTcheckPermission(_59:str, _74:str, _75:str) 
catch InvalidCredentialsException:str ; # 69 InvalidCredentialsException:str {J72}
    io.printf("%s\n",InvalidCredentialsException);# 70 _76:void := IOprint_formatted_str(_53:str, InvalidCredentialsException:str) 
    InvalidCredentialsException:str  := nil:str;# 71 InvalidCredentialsException:str := _45:str {G}
exit InvalidCredentialsException:str ;  # 72 InvalidCredentialsException:str 
    clients.checkPermission("monetdb","Pmonetdb","x");# 73 _77:void := CLTcheckPermission(_59:str, _71:str, _74:str) 
catch InvalidCredentialsException:str ; # 74 InvalidCredentialsException:str {J77}
    io.printf("%s\n",InvalidCredentialsException);# 75 _78:void := IOprint_formatted_str(_53:str, InvalidCredentialsException:str) 
    InvalidCredentialsException:str  := nil:str;# 76 InvalidCredentialsException:str := _79:str {G}
exit InvalidCredentialsException:str ;  # 77 InvalidCredentialsException:str 
    clients.checkPermission("x","Pmonetdb","sql");# 78 _80:void := CLTcheckPermission(_74:str, _71:str, _75:str) 
catch InvalidCredentialsException:str ; # 79 InvalidCredentialsException:str {J82}
    io.printf("%s\n",InvalidCredentialsException);# 80 _81:void := IOprint_formatted_str(_53:str, InvalidCredentialsException:str) 
    InvalidCredentialsException:str  := nil:str;# 81 InvalidCredentialsException:str := _79:str {G}
exit InvalidCredentialsException:str ;  # 82 InvalidCredentialsException:str 
end main;	# 83  
MALException:addUser:user 'monetdb' already exists
[ 1@0 ]
[ 2@0 ]
#-------------------------#
# h	t		  # name
# void	str		  # type
#-------------------------#
[ 0@0,	  "monetdb"	  ]
[ 1@0,	  "test"	  ]
[ 2@0,	  "checkpoint"	  ]
#-------------------------#
# h	t		  # name
# oid	str		  # type
#-------------------------#
[ 0@0,	  "monetdb"	  ]
[ 2@0,	  "checkpoint"	  ]
[ 1@0,	  "test"	  ]
#-------------------------#
# h	t		  # name
# oid	str		  # type
#-------------------------#
[ 0@0,	  "monetdb"	  ]
[ 1@0,	  "test"	  ]
MALException:removeScenario:scenario 'mil' not found for user 'test'
MALException:addScenario:scenario 'mal' already exists for user 'test'
InvalidCredentialsException:setPassword:The administrator cannot set its own password, use changePassword instead
InvalidCredentialsException:changePassword:Access denied
InvalidCredentialsException:checkCredentials:Invalid credentials for user 'monetdb'
InvalidCredentialsException:checkCredentials:Invalid credentials for user 'monetdb'
InvalidCredentialsException:checkCredentials:Invalid credentials for user 'monetdb'
InvalidCredentialsException:checkCredentials:Invalid credentials for user 'x'

# 23:18:00 >  
# 23:18:00 >  Done.
# 23:18:00 >  

