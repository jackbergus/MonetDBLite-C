#testing the partition optimizer

a1:= bat.new(:void,:int);
bat.setSequenceBase(a1,0@0);
a2:= bat.new(:void,:int);
bat.setSequenceBase(a2,10@0);
a3:= bat.new(:void,:int);
bat.setSequenceBase(a3,20@0);

barrier (go,i):= language.newRange(0);
	bat.append(a1,i);
	bat.append(a2,i);
	bat.append(a3,i);
	redo (go,i):= language.nextElement(1,10);
exit (go,i);

# add it to the BAT partition table
partitions.deposit(a1);
partitions.deposit(a1,a2);
partitions.deposit(a1,a3);
partitions.dump();

function qry(a:bat[:void,:any_1]);
	io.print("hello");
	io.print(a);
end qry;

optimizer.partitionedQuery("user","qry");
mdb.list("user","qry");
io.print("run experiment");
user.qry(a1);
