#testing the BAT partition manager
# use a fake sql library
module sql;
pattern bind(s:str,t:str,i:str,flag:int):bat[:oid,:int]
address MDBdummy;
pattern rsColumn(b:any...):void
address MDBdummy;
pattern resultSet(b:any...):void
address MDBdummy;
pattern exportResult(b:any...):void
address MDBdummy;

function query(A0:sht):void;
    x1:bat[:oid,:int]{bid=812,rows=1,notnil=true}  := sql.bind("sys","x","i",0);
    x6:bat[:oid,:int]{bid=808,rows=0,notnil=true}  := sql.bind("sys","x","i",1);
    constraints.emptySet(x6);
    x9:bat[:oid,:int]{bid=814,rows=0,notnil=true}  := sql.bind("sys","x","i",2);
    constraints.emptySet(x9);
    x21:bat[:oid,:int]{bid=815,rows=1,notnil=true}  := sql.bind("sys","x","j",1);
    x18{rows=1} := algebra.markT(x1,0@0);
    x19{rows=1} := bat.reverse(x18);
    x20{rows=1} := algebra.join(x19,x1);
    x28{rows=1} := algebra.join(x19,x21);
    x29 := sql.resultSet(2,1,x20);
    sql.rsColumn(x29,"sys.x","i","int",32,0,x20);
    sql.rsColumn(x29,"sys.x","j","int",32,0,x28);
    sql.exportResult(x29,"");
end query;
optimizer.partitions("sql","query");
mdb.list("sql","query");
