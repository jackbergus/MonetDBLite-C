# -*- mode: python -*-
addScheme('normal', '%major.%minor.%release')
addScheme('winrc', '%major,%minor,%release')

main = addModule('MonetDB5')
monetdb = addModule('MonetDB')
clients = addModule('clients')


# %v - unadorned version number
# %q - version number surrounded by single quotes
# %Q - version number surrounded by double quotes

main.setVersionFormat('@normal')
main.addAnchor("VERSION", "%v")
main.addAnchor("configure.ag", "[MonetDB Server], [%v]")
main.addAnchor("NT/rules.msc", "VERSION=%v")
main.addAnchors("NT/MonetDB5-Server/MonetDB5-Server.vdproj",
               	arguments(pattern = "\"ProductVersion\" = \"8:%v\"",
                          format = '@normal'),
                arguments(pattern = '"Value" = "8:%v"',
                          format = '@normal'))
main.addAnchors("NT/MonetDB5-Server/MonetDB5-Server64.vdproj",
               	arguments(pattern = "\"ProductVersion\" = \"8:%v\"",
                          format = '@normal'),
                arguments(pattern = '"Value" = "8:%v"',
                          format = '@normal'))
main.addAnchors("src/tools/libmonetdb5.rc",
                'VALUE "FileVersion", "%v\\0"',
                'VALUE "ProductVersion", "%v\\0"',
                arguments(pattern = 'FILEVERSION %v', format = '@winrc'),
                arguments(pattern = 'PRODUCTVERSION %v', format = '@winrc'))
main.addAnchor("MonetDB-server.spec", "%define version %v")

monetdb.setVersionFormat('@normal')
monetdb.addAnchor("configure.ag", "req_monetdb_ver=%q")
monetdb.addAnchors("MonetDB-server.spec",
                   arguments(pattern = "\nBuildRequires: MonetDB-devel >= %v",
                              format = "%major.%minor"))
monetdb.addAnchors("NT/MonetDB5-Server/MonetDB5-Server.vdproj",
                   arguments(pattern = r'"Condition" = "8:COMMONVERSION >= \"%v\""',
                             format = "@normal"))
monetdb.addAnchors("NT/MonetDB5-Server/MonetDB5-Server64.vdproj",
                   arguments(pattern = r'"Condition" = "8:COMMONVERSION >= \"%v\""',
                             format = "@normal"))

clients.setVersionFormat('@normal')
clients.addAnchor("configure.ag", "req_clients_ver=%q")
clients.addAnchors("MonetDB-server.spec",
                   arguments(pattern = "\nRequires: MonetDB-client >= %v",
                              format = "%major.%minor"),
                   arguments(pattern = "\nBuildRequires: MonetDB-client-devel >= %v",
                              format = "%major.%minor"))
clients.addAnchors("NT/MonetDB5-Server/MonetDB5-Server.vdproj",
                   arguments(pattern = r'"Condition" = "8:CLIENTSVERSION >= \"%v\""',
                             format = "@normal"))
clients.addAnchors("NT/MonetDB5-Server/MonetDB5-Server64.vdproj",
                   arguments(pattern = r'"Condition" = "8:CLIENTSVERSION >= \"%v\""',
                             format = "@normal"))
