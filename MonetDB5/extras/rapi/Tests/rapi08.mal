gv:= bat.new(:oid,:int);
bat.append(gv,1);
bat.append(gv,1);
bat.append(gv,2);
bat.append(gv,2);

dv:= bat.new(:oid,:int);
bat.append(dv,42);
bat.append(dv,84);
bat.append(dv,42);
bat.append(dv,21);

# tuple identifiers
ti:= bat.new(:oid,:oid);
bat.append(ti,0:oid);
bat.append(ti,1:oid);
bat.append(ti,2:oid);
bat.append(ti,3:oid);

X_8 := algebra.leftfetchjoin(ti,gv);
(X_9,r1_9,r2_9) := group.subgroupdone(X_8);
X_12 := algebra.leftfetchjoin(r1_9,X_8);
X_15 := algebra.leftfetchjoin(ti,dv); 
X_16:bat[:any,:dbl] := rapi.subeval("res <- aggregate(arg1, by=list(arg2), FUN=median); return(res$x)",X_15,X_9,r1_9,true);

io.print(X_16);

