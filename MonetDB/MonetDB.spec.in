%define name MonetDB
%define version @VERSION@
%define release 1_@LINUX_DIST@.oid@oids@

%define prefix /usr
%define sysconfdir /etc
%define localstatedir /var/lib

Name: %{name}
Version: %{version}
Release: %{release}
Summary: MonetDB - Monet Database Management System
Group: System
Source: %{name}-%{version}.tar.gz
BuildRoot: /var/tmp/%{name}-root
Packager: Niels Nes <Niels.Nes@cwi.nl>
License:   MPL - http://monetdb.cwi.nl/Legal/MonetDBLicense-1.1.html
BuildRequires: python 

%{!?buildsystem: %define buildsystem 0}
%define comp_cc @CC@

# groups of related archs
%define all_x86 i386 i586 i686

%ifarch %{all_x86}
%define bits 32
%else
%define bits 64
%endif

%package devel
Summary: MonetDB development package 
Group: System 

%description
MonetDB is a database management system that is developed from a
main-memory perspective with use of a fully decomposed storage model,
automatic index management, extensibility of data types and search
accellerators, SQL- and XML- frontends.

%description devel
Add the MonetDB devel description here
Requires: %{name}

%prep
rm -rf $RPM_BUILD_ROOT

%setup -q -n %{name}-%{version}

%build

./configure \
	--enable-assert=no \
	--enable-optimize \
	--enable-bits=%{bits} \
	CC="%{comp_cc}" \
	--prefix=%{prefix} \
	--sysconfdir=%{sysconfdir} \
	--localstatedir=%{localstatedir} \
	--libdir=%{_libdir} \
	%{?_with_php} %{?_without_php} \
	%{?_with_python} %{?_without_python} \
	%{?_with_perl} %{?_without_perl} \
	%{?_with_java} %{?_without_java} 

make

%install
rm -rf $RPM_BUILD_ROOT

make install \
	DESTDIR=$RPM_BUILD_ROOT 

mkdir -p $RPM_BUILD_ROOT/%{localstatedir}/MonetDB/dbfarm
# insert example db here!

find $RPM_BUILD_ROOT -name .incs.in | xargs rm -f

# cleanup stuff we don't want to install
rm -rf $RPM_BUILD_ROOT%{prefix}/bin/epsffit
rm -rf $RPM_BUILD_ROOT%{prefix}/share/%{name}/conf/conf.bash
rm -rf $RPM_BUILD_ROOT%{prefix}/share/%{name}/general.mil
rm -rf $RPM_BUILD_ROOT%{prefix}/share/%{name}/lady.gif
rm -rf $RPM_BUILD_ROOT%{prefix}/share/%{name}/docs/*/*.tex
rm -rf $RPM_BUILD_ROOT%{prefix}/share/%{name}/docs/*/*/*.tex
rm -rf $RPM_BUILD_ROOT%{prefix}/share/%{name}/Tests/sample.class
rm -rf $RPM_BUILD_ROOT%{prefix}/share/%{name}/Mprofile-commands.lst

rm -rf $RPM_BUILD_ROOT%{prefix}/bin/M*
rm -rf $RPM_BUILD_ROOT%{prefix}/bin/prof.py

# Fixes monet config script
#perl -p -i -e "s|$RPM_BUILD_ROOT||" $RPM_BUILD_ROOT%{prefix}/bin/monet_config

%clean
rm -fr $RPM_BUILD_ROOT

%files 
%defattr(-,root,root) 
%{_libdir}/libmutils.*
%{_libdir}/libstream.*
%{_libdir}/libbat.*

%files devel
%defattr(-,root,root) 
%{prefix}/bin/monetdb-config*
%{prefix}/share/%{name}/conf/*
%{prefix}/share/%{name}/python/*

%{prefix}/include/%{name}/*.h
%{prefix}/include/%{name}/*/*.[hcm]

