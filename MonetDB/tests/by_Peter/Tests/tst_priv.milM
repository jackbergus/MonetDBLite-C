# test change of private mmap -> malloced under extends
new(void,str,1000000).persists(true).access(BAT_WRITE).rename("a");
var d := new(void,int,1000);
var i := 0;
while(i < 1000) d.insert(nil,i :+= 1);
d := [str](d).seqbase(0@0);
bat("a").seqbase(0@0).insert(d);

i := 0;
while(i < 100) {
    bat("a").insert(d.seqbase(oid(bat("a").count())));
    i :+= 1;
}

bat("a").mmap(1,1,1);
unload("a");
bat("a").info().reverse().select("theap.storage").reverse().print();

[int](bat("a").mirror());
var e := [str]([int](bat("a").mirror()));
debugmask(49);
bat("a").insert(e);
debugmask(9);

#bat("a").mmap(1,1,1);
bat("a").info().reverse().select("theap.storage").reverse().print();
e := [str]([int](bat("a").mirror()));
debugmask(49);
bat("a").insert(e);
debugmask(9);

bat("a").info().reverse().select("theap.storage").reverse().print();
bat("a").append("make dirty..");
commit();

bat("a").destroy();
commit();

quit();
