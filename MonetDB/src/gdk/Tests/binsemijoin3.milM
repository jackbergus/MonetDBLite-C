# Test provided as bug-report by 
# Maurice van Keulen <keulen@fmi.uni-konstanz.de>
# Torsten Grust <grust@fmi.uni-konstanz.de>

module(alarm);

var dbgmsk := debugmask();
var left:=new(void,oid).seqbase(0@0);
var right:=new(oid,void);

var i:=0;
while (i<12000) { left.append(oid(i)); i:+=1; }
debugmask(and(dbgmsk,xor(INT_MAX,8+8388608)));
i:=0;
while (i<450000) { right.insert(oid(i*2),nil); i:+=1; }
debugmask(dbgmsk);
right.insert(0@0,nil); # make sure right is unordered.

left.count().print();
right.count().print();

right.ordered().print();
var tm0 := time();
var res := left.semijoin(right);
var tm1 := time();

printf("# Done (%d results) ... elapsed time: %d ms\n", res.count(), tm1 - tm0);
res.count().print();
res.slice(0,20).print();

tm0 := time();
right.order();
tm1 := time();

printf("# %d BUNs ordered in %d ms\n", right.count(), tm1 - tm0);
right.count().print();

right.ordered().print();
tm0 := time();
res := left.semijoin(right);
tm1 := time();

printf("# Done (%d results) ... elapsed time: %d ms\n", res.count(), tm1 - tm0);
res.slice(0,20).print();
res.count().print();
